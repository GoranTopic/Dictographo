{"ast":null,"code":"import indexBy from 'index-array-by';\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    if (enumerableOnly) symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    });\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread2(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      ownKeys(Object(source), true).forEach(function (key) {\n        _defineProperty(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(Object(source)).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n\n  return target;\n}\n\nfunction _objectWithoutPropertiesLoose(source, excluded) {\n  if (source == null) return {};\n  var target = {};\n  var sourceKeys = Object.keys(source);\n  var key, i;\n\n  for (i = 0; i < sourceKeys.length; i++) {\n    key = sourceKeys[i];\n    if (excluded.indexOf(key) >= 0) continue;\n    target[key] = source[key];\n  }\n\n  return target;\n}\n\nfunction _objectWithoutProperties(source, excluded) {\n  if (source == null) return {};\n\n  var target = _objectWithoutPropertiesLoose(source, excluded);\n\n  var key, i;\n\n  if (Object.getOwnPropertySymbols) {\n    var sourceSymbolKeys = Object.getOwnPropertySymbols(source);\n\n    for (i = 0; i < sourceSymbolKeys.length; i++) {\n      key = sourceSymbolKeys[i];\n      if (excluded.indexOf(key) >= 0) continue;\n      if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;\n      target[key] = source[key];\n    }\n  }\n\n  return target;\n}\n\nfunction _slicedToArray(arr, i) {\n  return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _nonIterableRest();\n}\n\nfunction _toConsumableArray(arr) {\n  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread();\n}\n\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) {\n    for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) {\n      arr2[i] = arr[i];\n    }\n\n    return arr2;\n  }\n}\n\nfunction _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}\n\nfunction _iterableToArray(iter) {\n  if (Symbol.iterator in Object(iter) || Object.prototype.toString.call(iter) === \"[object Arguments]\") return Array.from(iter);\n}\n\nfunction _iterableToArrayLimit(arr, i) {\n  if (!(Symbol.iterator in Object(arr) || Object.prototype.toString.call(arr) === \"[object Arguments]\")) {\n    return;\n  }\n\n  var _arr = [];\n  var _n = true;\n  var _d = false;\n  var _e = undefined;\n\n  try {\n    for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {\n      _arr.push(_s.value);\n\n      if (i && _arr.length === i) break;\n    }\n  } catch (err) {\n    _d = true;\n    _e = err;\n  } finally {\n    try {\n      if (!_n && _i[\"return\"] != null) _i[\"return\"]();\n    } finally {\n      if (_d) throw _e;\n    }\n  }\n\n  return _arr;\n}\n\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance\");\n}\n\nfunction _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance\");\n}\n\nfunction diffArrays(prev, next, idAccessor) {\n  var result = {\n    enter: [],\n    update: [],\n    exit: []\n  };\n\n  if (!idAccessor) {\n    // use object references for comparison\n    var prevSet = new Set(prev);\n    var nextSet = new Set(next);\n    new Set([].concat(_toConsumableArray(prevSet), _toConsumableArray(nextSet))).forEach(function (item) {\n      var type = !prevSet.has(item) ? 'enter' : !nextSet.has(item) ? 'exit' : 'update';\n      result[type].push(type === 'update' ? [item, item] : item);\n    });\n  } else {\n    // compare by id (duplicate keys are ignored)\n    var prevById = indexBy(prev, idAccessor, false);\n    var nextById = indexBy(next, idAccessor, false);\n    var byId = Object.assign({}, prevById, nextById);\n    Object.entries(byId).forEach(function (_ref) {\n      var _ref2 = _slicedToArray(_ref, 2),\n          id = _ref2[0],\n          item = _ref2[1];\n\n      var type = !prevById.hasOwnProperty(id) ? 'enter' : !nextById.hasOwnProperty(id) ? 'exit' : 'update';\n      result[type].push(type === 'update' ? [prevById[id], nextById[id]] : item);\n    });\n  }\n\n  return result;\n}\n\nfunction dataBindDiff(data, existingObjs, _ref3) {\n  var _ref3$objBindAttr = _ref3.objBindAttr,\n      objBindAttr = _ref3$objBindAttr === void 0 ? '__obj' : _ref3$objBindAttr,\n      _ref3$dataBindAttr = _ref3.dataBindAttr,\n      dataBindAttr = _ref3$dataBindAttr === void 0 ? '__data' : _ref3$dataBindAttr,\n      idAccessor = _ref3.idAccessor,\n      _ref3$purge = _ref3.purge,\n      purge = _ref3$purge === void 0 ? false : _ref3$purge;\n\n  var isObjValid = function isObjValid(obj) {\n    return obj.hasOwnProperty(dataBindAttr);\n  };\n\n  var removeObjs = existingObjs.filter(function (obj) {\n    return !isObjValid(obj);\n  });\n  var prevD = existingObjs.filter(isObjValid).map(function (obj) {\n    return obj[dataBindAttr];\n  });\n  var nextD = data;\n  var diff = purge ? {\n    enter: nextD,\n    exit: prevD,\n    update: []\n  } // don't diff data in purge mode\n  : diffArrays(prevD, nextD, idAccessor);\n  diff.update = diff.update.map(function (_ref4) {\n    var _ref5 = _slicedToArray(_ref4, 2),\n        prevD = _ref5[0],\n        nextD = _ref5[1];\n\n    if (prevD !== nextD) {\n      // transfer obj to new data point (if different)\n      nextD[objBindAttr] = prevD[objBindAttr];\n      nextD[objBindAttr][dataBindAttr] = nextD;\n    }\n\n    return nextD;\n  });\n  diff.exit = diff.exit.concat(removeObjs.map(function (obj) {\n    return _defineProperty({}, objBindAttr, obj);\n  }));\n  return diff;\n}\n\nfunction viewDigest(data, existingObjs, // list\nappendObj, // item => {...} function\nremoveObj, // item => {...} function\n_ref7) {\n  var _ref7$createObj = _ref7.createObj,\n      createObj = _ref7$createObj === void 0 ? function (d) {\n    return {};\n  } : _ref7$createObj,\n      _ref7$updateObj = _ref7.updateObj,\n      updateObj = _ref7$updateObj === void 0 ? function (obj, d) {} : _ref7$updateObj,\n      _ref7$exitObj = _ref7.exitObj,\n      exitObj = _ref7$exitObj === void 0 ? function (obj) {} : _ref7$exitObj,\n      _ref7$objBindAttr = _ref7.objBindAttr,\n      objBindAttr = _ref7$objBindAttr === void 0 ? '__obj' : _ref7$objBindAttr,\n      _ref7$dataBindAttr = _ref7.dataBindAttr,\n      dataBindAttr = _ref7$dataBindAttr === void 0 ? '__data' : _ref7$dataBindAttr,\n      dataDiffOptions = _objectWithoutProperties(_ref7, [\"createObj\", \"updateObj\", \"exitObj\", \"objBindAttr\", \"dataBindAttr\"]);\n\n  var _dataBindDiff = dataBindDiff(data, existingObjs, _objectSpread2({\n    objBindAttr: objBindAttr,\n    dataBindAttr: dataBindAttr\n  }, dataDiffOptions)),\n      enter = _dataBindDiff.enter,\n      update = _dataBindDiff.update,\n      exit = _dataBindDiff.exit; // Remove exiting points\n\n\n  exit.forEach(function (d) {\n    var obj = d[objBindAttr];\n    delete d[objBindAttr]; // unbind obj\n\n    exitObj(obj);\n    removeObj(obj);\n  });\n  var newObjs = createObjs(enter);\n  var pointsData = [].concat(_toConsumableArray(enter), _toConsumableArray(update));\n  updateObjs(pointsData); // Add new points\n\n  newObjs.forEach(appendObj); //\n\n  function createObjs(data) {\n    var newObjs = [];\n    data.forEach(function (d) {\n      var obj = createObj(d);\n\n      if (obj) {\n        obj[dataBindAttr] = d;\n        d[objBindAttr] = obj;\n        newObjs.push(obj);\n      }\n    });\n    return newObjs;\n  }\n\n  function updateObjs(data) {\n    data.forEach(function (d) {\n      var obj = d[objBindAttr];\n\n      if (obj) {\n        obj[dataBindAttr] = d;\n        updateObj(obj, d);\n      }\n    });\n  }\n}\n\nexport default viewDigest;","map":{"version":3,"sources":["/home/telix/dictographo/frontend/node_modules/data-joint/dist/data-joint.module.js"],"names":["indexBy","_defineProperty","obj","key","value","Object","defineProperty","enumerable","configurable","writable","ownKeys","object","enumerableOnly","keys","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","push","apply","_objectSpread2","target","i","arguments","length","source","forEach","getOwnPropertyDescriptors","defineProperties","_objectWithoutPropertiesLoose","excluded","sourceKeys","indexOf","_objectWithoutProperties","sourceSymbolKeys","prototype","propertyIsEnumerable","call","_slicedToArray","arr","_arrayWithHoles","_iterableToArrayLimit","_nonIterableRest","_toConsumableArray","_arrayWithoutHoles","_iterableToArray","_nonIterableSpread","Array","isArray","arr2","iter","Symbol","iterator","toString","from","_arr","_n","_d","_e","undefined","_i","_s","next","done","err","TypeError","diffArrays","prev","idAccessor","result","enter","update","exit","prevSet","Set","nextSet","concat","item","type","has","prevById","nextById","byId","assign","entries","_ref","_ref2","id","hasOwnProperty","dataBindDiff","data","existingObjs","_ref3","_ref3$objBindAttr","objBindAttr","_ref3$dataBindAttr","dataBindAttr","_ref3$purge","purge","isObjValid","removeObjs","prevD","map","nextD","diff","_ref4","_ref5","viewDigest","appendObj","removeObj","_ref7","_ref7$createObj","createObj","d","_ref7$updateObj","updateObj","_ref7$exitObj","exitObj","_ref7$objBindAttr","_ref7$dataBindAttr","dataDiffOptions","_dataBindDiff","newObjs","createObjs","pointsData","updateObjs"],"mappings":"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","sourcesContent":["import indexBy from 'index-array-by';\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    if (enumerableOnly) symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    });\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread2(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      ownKeys(Object(source), true).forEach(function (key) {\n        _defineProperty(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(Object(source)).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n\n  return target;\n}\n\nfunction _objectWithoutPropertiesLoose(source, excluded) {\n  if (source == null) return {};\n  var target = {};\n  var sourceKeys = Object.keys(source);\n  var key, i;\n\n  for (i = 0; i < sourceKeys.length; i++) {\n    key = sourceKeys[i];\n    if (excluded.indexOf(key) >= 0) continue;\n    target[key] = source[key];\n  }\n\n  return target;\n}\n\nfunction _objectWithoutProperties(source, excluded) {\n  if (source == null) return {};\n\n  var target = _objectWithoutPropertiesLoose(source, excluded);\n\n  var key, i;\n\n  if (Object.getOwnPropertySymbols) {\n    var sourceSymbolKeys = Object.getOwnPropertySymbols(source);\n\n    for (i = 0; i < sourceSymbolKeys.length; i++) {\n      key = sourceSymbolKeys[i];\n      if (excluded.indexOf(key) >= 0) continue;\n      if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;\n      target[key] = source[key];\n    }\n  }\n\n  return target;\n}\n\nfunction _slicedToArray(arr, i) {\n  return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _nonIterableRest();\n}\n\nfunction _toConsumableArray(arr) {\n  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread();\n}\n\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) {\n    for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) arr2[i] = arr[i];\n\n    return arr2;\n  }\n}\n\nfunction _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}\n\nfunction _iterableToArray(iter) {\n  if (Symbol.iterator in Object(iter) || Object.prototype.toString.call(iter) === \"[object Arguments]\") return Array.from(iter);\n}\n\nfunction _iterableToArrayLimit(arr, i) {\n  if (!(Symbol.iterator in Object(arr) || Object.prototype.toString.call(arr) === \"[object Arguments]\")) {\n    return;\n  }\n\n  var _arr = [];\n  var _n = true;\n  var _d = false;\n  var _e = undefined;\n\n  try {\n    for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {\n      _arr.push(_s.value);\n\n      if (i && _arr.length === i) break;\n    }\n  } catch (err) {\n    _d = true;\n    _e = err;\n  } finally {\n    try {\n      if (!_n && _i[\"return\"] != null) _i[\"return\"]();\n    } finally {\n      if (_d) throw _e;\n    }\n  }\n\n  return _arr;\n}\n\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance\");\n}\n\nfunction _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance\");\n}\n\nfunction diffArrays(prev, next, idAccessor) {\n  var result = {\n    enter: [],\n    update: [],\n    exit: []\n  };\n\n  if (!idAccessor) {\n    // use object references for comparison\n    var prevSet = new Set(prev);\n    var nextSet = new Set(next);\n    new Set([].concat(_toConsumableArray(prevSet), _toConsumableArray(nextSet))).forEach(function (item) {\n      var type = !prevSet.has(item) ? 'enter' : !nextSet.has(item) ? 'exit' : 'update';\n      result[type].push(type === 'update' ? [item, item] : item);\n    });\n  } else {\n    // compare by id (duplicate keys are ignored)\n    var prevById = indexBy(prev, idAccessor, false);\n    var nextById = indexBy(next, idAccessor, false);\n    var byId = Object.assign({}, prevById, nextById);\n    Object.entries(byId).forEach(function (_ref) {\n      var _ref2 = _slicedToArray(_ref, 2),\n          id = _ref2[0],\n          item = _ref2[1];\n\n      var type = !prevById.hasOwnProperty(id) ? 'enter' : !nextById.hasOwnProperty(id) ? 'exit' : 'update';\n      result[type].push(type === 'update' ? [prevById[id], nextById[id]] : item);\n    });\n  }\n\n  return result;\n}\n\nfunction dataBindDiff(data, existingObjs, _ref3) {\n  var _ref3$objBindAttr = _ref3.objBindAttr,\n      objBindAttr = _ref3$objBindAttr === void 0 ? '__obj' : _ref3$objBindAttr,\n      _ref3$dataBindAttr = _ref3.dataBindAttr,\n      dataBindAttr = _ref3$dataBindAttr === void 0 ? '__data' : _ref3$dataBindAttr,\n      idAccessor = _ref3.idAccessor,\n      _ref3$purge = _ref3.purge,\n      purge = _ref3$purge === void 0 ? false : _ref3$purge;\n\n  var isObjValid = function isObjValid(obj) {\n    return obj.hasOwnProperty(dataBindAttr);\n  };\n\n  var removeObjs = existingObjs.filter(function (obj) {\n    return !isObjValid(obj);\n  });\n  var prevD = existingObjs.filter(isObjValid).map(function (obj) {\n    return obj[dataBindAttr];\n  });\n  var nextD = data;\n  var diff = purge ? {\n    enter: nextD,\n    exit: prevD,\n    update: []\n  } // don't diff data in purge mode\n  : diffArrays(prevD, nextD, idAccessor);\n  diff.update = diff.update.map(function (_ref4) {\n    var _ref5 = _slicedToArray(_ref4, 2),\n        prevD = _ref5[0],\n        nextD = _ref5[1];\n\n    if (prevD !== nextD) {\n      // transfer obj to new data point (if different)\n      nextD[objBindAttr] = prevD[objBindAttr];\n      nextD[objBindAttr][dataBindAttr] = nextD;\n    }\n\n    return nextD;\n  });\n  diff.exit = diff.exit.concat(removeObjs.map(function (obj) {\n    return _defineProperty({}, objBindAttr, obj);\n  }));\n  return diff;\n}\n\nfunction viewDigest(data, existingObjs, // list\nappendObj, // item => {...} function\nremoveObj, // item => {...} function\n_ref7) {\n  var _ref7$createObj = _ref7.createObj,\n      createObj = _ref7$createObj === void 0 ? function (d) {\n    return {};\n  } : _ref7$createObj,\n      _ref7$updateObj = _ref7.updateObj,\n      updateObj = _ref7$updateObj === void 0 ? function (obj, d) {} : _ref7$updateObj,\n      _ref7$exitObj = _ref7.exitObj,\n      exitObj = _ref7$exitObj === void 0 ? function (obj) {} : _ref7$exitObj,\n      _ref7$objBindAttr = _ref7.objBindAttr,\n      objBindAttr = _ref7$objBindAttr === void 0 ? '__obj' : _ref7$objBindAttr,\n      _ref7$dataBindAttr = _ref7.dataBindAttr,\n      dataBindAttr = _ref7$dataBindAttr === void 0 ? '__data' : _ref7$dataBindAttr,\n      dataDiffOptions = _objectWithoutProperties(_ref7, [\"createObj\", \"updateObj\", \"exitObj\", \"objBindAttr\", \"dataBindAttr\"]);\n\n  var _dataBindDiff = dataBindDiff(data, existingObjs, _objectSpread2({\n    objBindAttr: objBindAttr,\n    dataBindAttr: dataBindAttr\n  }, dataDiffOptions)),\n      enter = _dataBindDiff.enter,\n      update = _dataBindDiff.update,\n      exit = _dataBindDiff.exit; // Remove exiting points\n\n\n  exit.forEach(function (d) {\n    var obj = d[objBindAttr];\n    delete d[objBindAttr]; // unbind obj\n\n    exitObj(obj);\n    removeObj(obj);\n  });\n  var newObjs = createObjs(enter);\n  var pointsData = [].concat(_toConsumableArray(enter), _toConsumableArray(update));\n  updateObjs(pointsData); // Add new points\n\n  newObjs.forEach(appendObj); //\n\n  function createObjs(data) {\n    var newObjs = [];\n    data.forEach(function (d) {\n      var obj = createObj(d);\n\n      if (obj) {\n        obj[dataBindAttr] = d;\n        d[objBindAttr] = obj;\n        newObjs.push(obj);\n      }\n    });\n    return newObjs;\n  }\n\n  function updateObjs(data) {\n    data.forEach(function (d) {\n      var obj = d[objBindAttr];\n\n      if (obj) {\n        obj[dataBindAttr] = d;\n        updateObj(obj, d);\n      }\n    });\n  }\n}\n\nexport default viewDigest;\n"]},"metadata":{},"sourceType":"module"}