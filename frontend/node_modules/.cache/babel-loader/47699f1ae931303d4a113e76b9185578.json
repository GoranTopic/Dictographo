{"ast":null,"code":"import { select } from 'd3-selection';\nimport { zoomTransform, zoom } from 'd3-zoom';\nimport { drag } from 'd3-drag';\nimport { min, max } from 'd3-array';\nimport throttle from 'lodash.throttle';\nimport TWEEN from '@tweenjs/tween.js';\nimport Kapsule from 'kapsule';\nimport accessorFn from 'accessor-fn';\nimport ColorTracker from 'canvas-color-tracker';\nimport { forceSimulation, forceLink, forceManyBody, forceCenter, forceRadial } from 'd3-force-3d';\nimport { Bezier } from 'bezier-js';\nimport indexBy from 'index-array-by';\nimport { scaleOrdinal } from 'd3-scale';\nimport { schemePaired } from 'd3-scale-chromatic';\n\nfunction styleInject(css, ref) {\n  if (ref === void 0) ref = {};\n  var insertAt = ref.insertAt;\n\n  if (!css || typeof document === 'undefined') {\n    return;\n  }\n\n  var head = document.head || document.getElementsByTagName('head')[0];\n  var style = document.createElement('style');\n  style.type = 'text/css';\n\n  if (insertAt === 'top') {\n    if (head.firstChild) {\n      head.insertBefore(style, head.firstChild);\n    } else {\n      head.appendChild(style);\n    }\n  } else {\n    head.appendChild(style);\n  }\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = css;\n  } else {\n    style.appendChild(document.createTextNode(css));\n  }\n}\n\nvar css_248z = \".force-graph-container canvas {\\n  display: block;\\n  user-select: none;\\n  outline: none;\\n  -webkit-tap-highlight-color: transparent;\\n}\\n\\n.force-graph-container .graph-tooltip {\\n  position: absolute;\\n  transform: translate(-50%, 25px);\\n  font-family: sans-serif;\\n  font-size: 16px;\\n  padding: 4px;\\n  border-radius: 3px;\\n  color: #eee;\\n  background: rgba(0,0,0,0.65);\\n  visibility: hidden; /* by default */\\n}\\n\\n.force-graph-container .grabbable {\\n  cursor: move;\\n  cursor: grab;\\n  cursor: -moz-grab;\\n  cursor: -webkit-grab;\\n}\\n\\n.force-graph-container .grabbable:active {\\n  cursor: grabbing;\\n  cursor: -moz-grabbing;\\n  cursor: -webkit-grabbing;\\n}\\n\";\nstyleInject(css_248z);\n\nfunction _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") {\n    _typeof = function _typeof(obj) {\n      return typeof obj;\n    };\n  } else {\n    _typeof = function _typeof(obj) {\n      return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n    };\n  }\n\n  return _typeof(obj);\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    if (enumerableOnly) symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    });\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread2(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      ownKeys(Object(source), true).forEach(function (key) {\n        _defineProperty(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(Object(source)).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n\n  return target;\n}\n\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}\n\nfunction _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n\n  try {\n    Date.prototype.toString.call(Reflect.construct(Date, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\nfunction _construct(Parent, args, Class) {\n  if (_isNativeReflectConstruct()) {\n    _construct = Reflect.construct;\n  } else {\n    _construct = function _construct(Parent, args, Class) {\n      var a = [null];\n      a.push.apply(a, args);\n      var Constructor = Function.bind.apply(Parent, a);\n      var instance = new Constructor();\n      if (Class) _setPrototypeOf(instance, Class.prototype);\n      return instance;\n    };\n  }\n\n  return _construct.apply(null, arguments);\n}\n\nfunction _slicedToArray(arr, i) {\n  return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest();\n}\n\nfunction _toConsumableArray(arr) {\n  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread();\n}\n\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) return _arrayLikeToArray(arr);\n}\n\nfunction _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}\n\nfunction _iterableToArray(iter) {\n  if (typeof Symbol !== \"undefined\" && Symbol.iterator in Object(iter)) return Array.from(iter);\n}\n\nfunction _iterableToArrayLimit(arr, i) {\n  if (typeof Symbol === \"undefined\" || !(Symbol.iterator in Object(arr))) return;\n  var _arr = [];\n  var _n = true;\n  var _d = false;\n  var _e = undefined;\n\n  try {\n    for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {\n      _arr.push(_s.value);\n\n      if (i && _arr.length === i) break;\n    }\n  } catch (err) {\n    _d = true;\n    _e = err;\n  } finally {\n    try {\n      if (!_n && _i[\"return\"] != null) _i[\"return\"]();\n    } finally {\n      if (_d) throw _e;\n    }\n  }\n\n  return _arr;\n}\n\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n}\n\nfunction _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n\n  for (var i = 0, arr2 = new Array(len); i < len; i++) {\n    arr2[i] = arr[i];\n  }\n\n  return arr2;\n}\n\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nfunction _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nvar autoColorScale = scaleOrdinal(schemePaired); // Autoset attribute colorField by colorByAccessor property\n// If an object has already a color, don't set it\n// Objects can be nodes or links\n\nfunction autoColorObjects(objects, colorByAccessor, colorField) {\n  if (!colorByAccessor || typeof colorField !== 'string') return;\n  objects.filter(function (obj) {\n    return !obj[colorField];\n  }).forEach(function (obj) {\n    obj[colorField] = autoColorScale(colorByAccessor(obj));\n  });\n}\n\nfunction getDagDepths(_ref, idAccessor) {\n  var nodes = _ref.nodes,\n      links = _ref.links;\n\n  var _ref2 = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {},\n      _ref2$nodeFilter = _ref2.nodeFilter,\n      nodeFilter = _ref2$nodeFilter === void 0 ? function () {\n    return true;\n  } : _ref2$nodeFilter,\n      _ref2$onLoopError = _ref2.onLoopError,\n      onLoopError = _ref2$onLoopError === void 0 ? function (loopIds) {\n    throw \"Invalid DAG structure! Found cycle in node path: \".concat(loopIds.join(' -> '), \".\");\n  } : _ref2$onLoopError; // linked graph\n\n\n  var graph = {};\n  nodes.forEach(function (node) {\n    return graph[idAccessor(node)] = {\n      data: node,\n      out: [],\n      depth: -1,\n      skip: !nodeFilter(node)\n    };\n  });\n  links.forEach(function (_ref3) {\n    var source = _ref3.source,\n        target = _ref3.target;\n    var sourceId = getNodeId(source);\n    var targetId = getNodeId(target);\n    if (!graph.hasOwnProperty(sourceId)) throw \"Missing source node with id: \".concat(sourceId);\n    if (!graph.hasOwnProperty(targetId)) throw \"Missing target node with id: \".concat(targetId);\n    var sourceNode = graph[sourceId];\n    var targetNode = graph[targetId];\n    sourceNode.out.push(targetNode);\n\n    function getNodeId(node) {\n      return _typeof(node) === 'object' ? idAccessor(node) : node;\n    }\n  });\n  var foundLoops = [];\n  traverse(Object.values(graph));\n  var nodeDepths = Object.assign.apply(Object, [{}].concat(_toConsumableArray(Object.entries(graph).filter(function (_ref4) {\n    var _ref5 = _slicedToArray(_ref4, 2),\n        node = _ref5[1];\n\n    return !node.skip;\n  }).map(function (_ref6) {\n    var _ref7 = _slicedToArray(_ref6, 2),\n        id = _ref7[0],\n        node = _ref7[1];\n\n    return _defineProperty({}, id, node.depth);\n  }))));\n  return nodeDepths;\n\n  function traverse(nodes) {\n    var nodeStack = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];\n    var currentDepth = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n\n    for (var i = 0, l = nodes.length; i < l; i++) {\n      var node = nodes[i];\n\n      if (nodeStack.indexOf(node) !== -1) {\n        var _ret = function () {\n          var loop = [].concat(_toConsumableArray(nodeStack.slice(nodeStack.indexOf(node))), [node]).map(function (d) {\n            return idAccessor(d.data);\n          });\n\n          if (!foundLoops.some(function (foundLoop) {\n            return foundLoop.length === loop.length && foundLoop.every(function (id, idx) {\n              return id === loop[idx];\n            });\n          })) {\n            foundLoops.push(loop);\n            onLoopError(loop);\n          }\n\n          return \"continue\";\n        }();\n\n        if (_ret === \"continue\") continue;\n      }\n\n      if (currentDepth > node.depth) {\n        // Don't unnecessarily revisit chunks of the graph\n        node.depth = currentDepth;\n        traverse(node.out, [].concat(_toConsumableArray(nodeStack), [node]), currentDepth + (node.skip ? 0 : 1));\n      }\n    }\n  }\n}\n\nvar DAG_LEVEL_NODE_RATIO = 2;\nvar CanvasForceGraph = Kapsule({\n  props: {\n    graphData: {\n      \"default\": {\n        nodes: [],\n        links: []\n      },\n      onChange: function onChange(_, state) {\n        state.engineRunning = false;\n      } // Pause simulation\n\n    },\n    dagMode: {\n      onChange: function onChange(dagMode, state) {\n        // td, bu, lr, rl, radialin, radialout\n        !dagMode && (state.graphData.nodes || []).forEach(function (n) {\n          return n.fx = n.fy = undefined;\n        }); // unfix nodes when disabling dag mode\n      }\n    },\n    dagLevelDistance: {},\n    dagNodeFilter: {\n      \"default\": function _default(node) {\n        return true;\n      }\n    },\n    onDagError: {\n      triggerUpdate: false\n    },\n    nodeRelSize: {\n      \"default\": 4,\n      triggerUpdate: false\n    },\n    // area per val unit\n    nodeId: {\n      \"default\": 'id'\n    },\n    nodeVal: {\n      \"default\": 'val',\n      triggerUpdate: false\n    },\n    nodeColor: {\n      \"default\": 'color',\n      triggerUpdate: false\n    },\n    nodeAutoColorBy: {},\n    nodeCanvasObject: {\n      triggerUpdate: false\n    },\n    nodeCanvasObjectMode: {\n      \"default\": function _default() {\n        return 'replace';\n      },\n      triggerUpdate: false\n    },\n    nodeVisibility: {\n      \"default\": true,\n      triggerUpdate: false\n    },\n    linkSource: {\n      \"default\": 'source'\n    },\n    linkTarget: {\n      \"default\": 'target'\n    },\n    linkVisibility: {\n      \"default\": true,\n      triggerUpdate: false\n    },\n    linkColor: {\n      \"default\": 'color',\n      triggerUpdate: false\n    },\n    linkAutoColorBy: {},\n    linkLineDash: {\n      triggerUpdate: false\n    },\n    linkWidth: {\n      \"default\": 1,\n      triggerUpdate: false\n    },\n    linkCurvature: {\n      \"default\": 0,\n      triggerUpdate: false\n    },\n    linkCanvasObject: {\n      triggerUpdate: false\n    },\n    linkCanvasObjectMode: {\n      \"default\": function _default() {\n        return 'replace';\n      },\n      triggerUpdate: false\n    },\n    linkDirectionalArrowLength: {\n      \"default\": 0,\n      triggerUpdate: false\n    },\n    linkDirectionalArrowColor: {\n      triggerUpdate: false\n    },\n    linkDirectionalArrowRelPos: {\n      \"default\": 0.5,\n      triggerUpdate: false\n    },\n    // value between 0<>1 indicating the relative pos along the (exposed) line\n    linkDirectionalParticles: {\n      \"default\": 0\n    },\n    // animate photons travelling in the link direction\n    linkDirectionalParticleSpeed: {\n      \"default\": 0.01,\n      triggerUpdate: false\n    },\n    // in link length ratio per frame\n    linkDirectionalParticleWidth: {\n      \"default\": 4,\n      triggerUpdate: false\n    },\n    linkDirectionalParticleColor: {\n      triggerUpdate: false\n    },\n    globalScale: {\n      \"default\": 1,\n      triggerUpdate: false\n    },\n    d3AlphaMin: {\n      \"default\": 0,\n      triggerUpdate: false\n    },\n    d3AlphaDecay: {\n      \"default\": 0.0228,\n      triggerUpdate: false,\n      onChange: function onChange(alphaDecay, state) {\n        state.forceLayout.alphaDecay(alphaDecay);\n      }\n    },\n    d3AlphaTarget: {\n      \"default\": 0,\n      triggerUpdate: false,\n      onChange: function onChange(alphaTarget, state) {\n        state.forceLayout.alphaTarget(alphaTarget);\n      }\n    },\n    d3VelocityDecay: {\n      \"default\": 0.4,\n      triggerUpdate: false,\n      onChange: function onChange(velocityDecay, state) {\n        state.forceLayout.velocityDecay(velocityDecay);\n      }\n    },\n    warmupTicks: {\n      \"default\": 0,\n      triggerUpdate: false\n    },\n    // how many times to tick the force engine at init before starting to render\n    cooldownTicks: {\n      \"default\": Infinity,\n      triggerUpdate: false\n    },\n    cooldownTime: {\n      \"default\": 15000,\n      triggerUpdate: false\n    },\n    // ms\n    onUpdate: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onFinishUpdate: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onEngineTick: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onEngineStop: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    isShadow: {\n      \"default\": false,\n      triggerUpdate: false\n    }\n  },\n  methods: {\n    // Expose d3 forces for external manipulation\n    d3Force: function d3Force(state, forceName, forceFn) {\n      if (forceFn === undefined) {\n        return state.forceLayout.force(forceName); // Force getter\n      }\n\n      state.forceLayout.force(forceName, forceFn); // Force setter\n\n      return this;\n    },\n    d3ReheatSimulation: function d3ReheatSimulation(state) {\n      state.forceLayout.alpha(1);\n      this.resetCountdown();\n      return this;\n    },\n    // reset cooldown state\n    resetCountdown: function resetCountdown(state) {\n      state.cntTicks = 0;\n      state.startTickTime = new Date();\n      state.engineRunning = true;\n      return this;\n    },\n    tickFrame: function tickFrame(state) {\n      !state.isShadow && layoutTick();\n      paintLinks();\n      !state.isShadow && paintArrows();\n      !state.isShadow && paintPhotons();\n      paintNodes();\n      return this; //\n\n      function layoutTick() {\n        if (state.engineRunning) {\n          if (++state.cntTicks > state.cooldownTicks || new Date() - state.startTickTime > state.cooldownTime || state.d3AlphaMin > 0 && state.forceLayout.alpha() < state.d3AlphaMin) {\n            state.engineRunning = false; // Stop ticking graph\n\n            state.onEngineStop();\n          } else {\n            state.forceLayout.tick(); // Tick it\n\n            state.onEngineTick();\n          }\n        }\n      }\n\n      function paintNodes() {\n        var getVisibility = accessorFn(state.nodeVisibility);\n        var getVal = accessorFn(state.nodeVal);\n        var getColor = accessorFn(state.nodeColor);\n        var getNodeCanvasObjectMode = accessorFn(state.nodeCanvasObjectMode);\n        var ctx = state.ctx; // Draw wider nodes by 1px on shadow canvas for more precise hovering (due to boundary anti-aliasing)\n\n        var padAmount = state.isShadow / state.globalScale;\n        var visibleNodes = state.graphData.nodes.filter(getVisibility);\n        ctx.save();\n        visibleNodes.forEach(function (node) {\n          var nodeCanvasObjectMode = getNodeCanvasObjectMode(node);\n\n          if (state.nodeCanvasObject && (nodeCanvasObjectMode === 'before' || nodeCanvasObjectMode === 'replace')) {\n            // Custom node before/replace paint\n            state.nodeCanvasObject(node, ctx, state.globalScale, state.isShadow);\n\n            if (nodeCanvasObjectMode === 'replace') {\n              ctx.restore();\n              return;\n            }\n          } // Draw wider nodes by 1px on shadow canvas for more precise hovering (due to boundary anti-aliasing)\n\n\n          var r = Math.sqrt(Math.max(0, getVal(node) || 1)) * state.nodeRelSize + padAmount;\n          ctx.beginPath();\n          ctx.arc(node.x, node.y, r, 0, 2 * Math.PI, false);\n          ctx.fillStyle = getColor(node) || 'rgba(31, 120, 180, 0.92)';\n          ctx.fill();\n\n          if (state.nodeCanvasObject && nodeCanvasObjectMode === 'after') {\n            // Custom node after paint\n            state.nodeCanvasObject(node, state.ctx, state.globalScale);\n          }\n        });\n        ctx.restore();\n      }\n\n      function paintLinks() {\n        var getVisibility = accessorFn(state.linkVisibility);\n        var getColor = accessorFn(state.linkColor);\n        var getWidth = accessorFn(state.linkWidth);\n        var getLineDash = accessorFn(state.linkLineDash);\n        var getCurvature = accessorFn(state.linkCurvature);\n        var getLinkCanvasObjectMode = accessorFn(state.linkCanvasObjectMode);\n        var ctx = state.ctx; // Draw wider lines by 2px on shadow canvas for more precise hovering (due to boundary anti-aliasing)\n\n        var padAmount = state.isShadow * 2;\n        var visibleLinks = state.graphData.links.filter(getVisibility);\n        visibleLinks.forEach(calcLinkControlPoints); // calculate curvature control points for all visible links\n\n        var beforeCustomLinks = [],\n            afterCustomLinks = [],\n            defaultPaintLinks = visibleLinks;\n\n        if (state.linkCanvasObject) {\n          var replaceCustomLinks = [],\n              otherCustomLinks = [];\n          visibleLinks.forEach(function (d) {\n            return ({\n              before: beforeCustomLinks,\n              after: afterCustomLinks,\n              replace: replaceCustomLinks\n            }[getLinkCanvasObjectMode(d)] || otherCustomLinks).push(d);\n          });\n          defaultPaintLinks = [].concat(_toConsumableArray(beforeCustomLinks), afterCustomLinks, otherCustomLinks);\n          beforeCustomLinks = beforeCustomLinks.concat(replaceCustomLinks);\n        } // Custom link before paints\n\n\n        ctx.save();\n        beforeCustomLinks.forEach(function (link) {\n          return state.linkCanvasObject(link, ctx, state.globalScale);\n        });\n        ctx.restore(); // Bundle strokes per unique color/width/dash for performance optimization\n\n        var linksPerColor = indexBy(defaultPaintLinks, [getColor, getWidth, getLineDash]);\n        ctx.save();\n        Object.entries(linksPerColor).forEach(function (_ref) {\n          var _ref2 = _slicedToArray(_ref, 2),\n              color = _ref2[0],\n              linksPerWidth = _ref2[1];\n\n          var lineColor = !color || color === 'undefined' ? 'rgba(0,0,0,0.15)' : color;\n          Object.entries(linksPerWidth).forEach(function (_ref3) {\n            var _ref4 = _slicedToArray(_ref3, 2),\n                width = _ref4[0],\n                linesPerLineDash = _ref4[1];\n\n            var lineWidth = (width || 1) / state.globalScale + padAmount;\n            Object.entries(linesPerLineDash).forEach(function (_ref5) {\n              var _ref6 = _slicedToArray(_ref5, 2),\n                  dashSegments = _ref6[0],\n                  links = _ref6[1];\n\n              var lineDashSegments = getLineDash(links[0]);\n              ctx.beginPath();\n              links.forEach(function (link) {\n                var start = link.source;\n                var end = link.target;\n                if (!start || !end || !start.hasOwnProperty('x') || !end.hasOwnProperty('x')) return; // skip invalid link\n\n                ctx.moveTo(start.x, start.y);\n                var controlPoints = link.__controlPoints;\n\n                if (!controlPoints) {\n                  // Straight line\n                  ctx.lineTo(end.x, end.y);\n                } else {\n                  // Use quadratic curves for regular lines and bezier for loops\n                  ctx[controlPoints.length === 2 ? 'quadraticCurveTo' : 'bezierCurveTo'].apply(ctx, _toConsumableArray(controlPoints).concat([end.x, end.y]));\n                }\n              });\n              ctx.strokeStyle = lineColor;\n              ctx.lineWidth = lineWidth;\n              ctx.setLineDash(lineDashSegments || []);\n              ctx.stroke();\n            });\n          });\n        });\n        ctx.restore(); // Custom link after paints\n\n        ctx.save();\n        afterCustomLinks.forEach(function (link) {\n          return state.linkCanvasObject(link, ctx, state.globalScale);\n        });\n        ctx.restore(); //\n\n        function calcLinkControlPoints(link) {\n          var curvature = getCurvature(link);\n\n          if (!curvature) {\n            // straight line\n            link.__controlPoints = null;\n            return;\n          }\n\n          var start = link.source;\n          var end = link.target;\n          if (!start || !end || !start.hasOwnProperty('x') || !end.hasOwnProperty('x')) return; // skip invalid link\n\n          var l = Math.sqrt(Math.pow(end.x - start.x, 2) + Math.pow(end.y - start.y, 2)); // line length\n\n          if (l > 0) {\n            var a = Math.atan2(end.y - start.y, end.x - start.x); // line angle\n\n            var d = l * curvature; // control point distance\n\n            var cp = {\n              // control point\n              x: (start.x + end.x) / 2 + d * Math.cos(a - Math.PI / 2),\n              y: (start.y + end.y) / 2 + d * Math.sin(a - Math.PI / 2)\n            };\n            link.__controlPoints = [cp.x, cp.y];\n          } else {\n            // Same point, draw a loop\n            var _d = curvature * 70;\n\n            link.__controlPoints = [end.x, end.y - _d, end.x + _d, end.y];\n          }\n        }\n      }\n\n      function paintArrows() {\n        var ARROW_WH_RATIO = 1.6;\n        var ARROW_VLEN_RATIO = 0.2;\n        var getLength = accessorFn(state.linkDirectionalArrowLength);\n        var getRelPos = accessorFn(state.linkDirectionalArrowRelPos);\n        var getVisibility = accessorFn(state.linkVisibility);\n        var getColor = accessorFn(state.linkDirectionalArrowColor || state.linkColor);\n        var getNodeVal = accessorFn(state.nodeVal);\n        var ctx = state.ctx;\n        ctx.save();\n        state.graphData.links.filter(getVisibility).forEach(function (link) {\n          var arrowLength = getLength(link);\n          if (!arrowLength || arrowLength < 0) return;\n          var start = link.source;\n          var end = link.target;\n          if (!start || !end || !start.hasOwnProperty('x') || !end.hasOwnProperty('x')) return; // skip invalid link\n\n          var startR = Math.sqrt(Math.max(0, getNodeVal(start) || 1)) * state.nodeRelSize;\n          var endR = Math.sqrt(Math.max(0, getNodeVal(end) || 1)) * state.nodeRelSize;\n          var arrowRelPos = Math.min(1, Math.max(0, getRelPos(link)));\n          var arrowColor = getColor(link) || 'rgba(0,0,0,0.28)';\n          var arrowHalfWidth = arrowLength / ARROW_WH_RATIO / 2; // Construct bezier for curved lines\n\n          var bzLine = link.__controlPoints && _construct(Bezier, [start.x, start.y].concat(_toConsumableArray(link.__controlPoints), [end.x, end.y]));\n\n          var getCoordsAlongLine = bzLine ? function (t) {\n            return bzLine.get(t);\n          } // get position along bezier line\n          : function (t) {\n            return {\n              // straight line: interpolate linearly\n              x: start.x + (end.x - start.x) * t || 0,\n              y: start.y + (end.y - start.y) * t || 0\n            };\n          };\n          var lineLen = bzLine ? bzLine.length() : Math.sqrt(Math.pow(end.x - start.x, 2) + Math.pow(end.y - start.y, 2));\n          var posAlongLine = startR + arrowLength + (lineLen - startR - endR - arrowLength) * arrowRelPos;\n          var arrowHead = getCoordsAlongLine(posAlongLine / lineLen);\n          var arrowTail = getCoordsAlongLine((posAlongLine - arrowLength) / lineLen);\n          var arrowTailVertex = getCoordsAlongLine((posAlongLine - arrowLength * (1 - ARROW_VLEN_RATIO)) / lineLen);\n          var arrowTailAngle = Math.atan2(arrowHead.y - arrowTail.y, arrowHead.x - arrowTail.x) - Math.PI / 2;\n          ctx.beginPath();\n          ctx.moveTo(arrowHead.x, arrowHead.y);\n          ctx.lineTo(arrowTail.x + arrowHalfWidth * Math.cos(arrowTailAngle), arrowTail.y + arrowHalfWidth * Math.sin(arrowTailAngle));\n          ctx.lineTo(arrowTailVertex.x, arrowTailVertex.y);\n          ctx.lineTo(arrowTail.x - arrowHalfWidth * Math.cos(arrowTailAngle), arrowTail.y - arrowHalfWidth * Math.sin(arrowTailAngle));\n          ctx.fillStyle = arrowColor;\n          ctx.fill();\n        });\n        ctx.restore();\n      }\n\n      function paintPhotons() {\n        var getNumPhotons = accessorFn(state.linkDirectionalParticles);\n        var getSpeed = accessorFn(state.linkDirectionalParticleSpeed);\n        var getDiameter = accessorFn(state.linkDirectionalParticleWidth);\n        var getVisibility = accessorFn(state.linkVisibility);\n        var getColor = accessorFn(state.linkDirectionalParticleColor || state.linkColor);\n        var ctx = state.ctx;\n        ctx.save();\n        state.graphData.links.filter(getVisibility).forEach(function (link) {\n          var numCyclePhotons = getNumPhotons(link);\n          if (!link.hasOwnProperty('__photons') || !link.__photons.length) return;\n          var start = link.source;\n          var end = link.target;\n          if (!start || !end || !start.hasOwnProperty('x') || !end.hasOwnProperty('x')) return; // skip invalid link\n\n          var particleSpeed = getSpeed(link);\n          var photons = link.__photons || [];\n          var photonR = Math.max(0, getDiameter(link) / 2) / Math.sqrt(state.globalScale);\n          var photonColor = getColor(link) || 'rgba(0,0,0,0.28)';\n          ctx.fillStyle = photonColor; // Construct bezier for curved lines\n\n          var bzLine = link.__controlPoints ? _construct(Bezier, [start.x, start.y].concat(_toConsumableArray(link.__controlPoints), [end.x, end.y])) : null;\n          var cyclePhotonIdx = 0;\n          var needsCleanup = false; // whether some photons need to be removed from list\n\n          photons.forEach(function (photon) {\n            var singleHop = !!photon.__singleHop;\n\n            if (!photon.hasOwnProperty('__progressRatio')) {\n              photon.__progressRatio = singleHop ? 0 : cyclePhotonIdx / numCyclePhotons;\n            }\n\n            !singleHop && cyclePhotonIdx++; // increase regular photon index\n\n            photon.__progressRatio += particleSpeed;\n\n            if (photon.__progressRatio >= 1) {\n              if (!singleHop) {\n                photon.__progressRatio = photon.__progressRatio % 1;\n              } else {\n                needsCleanup = true;\n                return;\n              }\n            }\n\n            var photonPosRatio = photon.__progressRatio;\n            var coords = bzLine ? bzLine.get(photonPosRatio) // get position along bezier line\n            : {\n              // straight line: interpolate linearly\n              x: start.x + (end.x - start.x) * photonPosRatio || 0,\n              y: start.y + (end.y - start.y) * photonPosRatio || 0\n            };\n            ctx.beginPath();\n            ctx.arc(coords.x, coords.y, photonR, 0, 2 * Math.PI, false);\n            ctx.fill();\n          });\n\n          if (needsCleanup) {\n            // remove expired single hop photons\n            link.__photons = link.__photons.filter(function (photon) {\n              return !photon.__singleHop || photon.__progressRatio <= 1;\n            });\n          }\n        });\n        ctx.restore();\n      }\n    },\n    emitParticle: function emitParticle(state, link) {\n      if (link) {\n        !link.__photons && (link.__photons = []);\n\n        link.__photons.push({\n          __singleHop: true\n        }); // add a single hop particle\n\n      }\n\n      return this;\n    }\n  },\n  stateInit: function stateInit() {\n    return {\n      forceLayout: forceSimulation().force('link', forceLink()).force('charge', forceManyBody()).force('center', forceCenter()).force('dagRadial', null).stop(),\n      engineRunning: false\n    };\n  },\n  init: function init(canvasCtx, state) {\n    // Main canvas object to manipulate\n    state.ctx = canvasCtx;\n  },\n  update: function update(state) {\n    state.engineRunning = false; // Pause simulation\n\n    state.onUpdate();\n\n    if (state.nodeAutoColorBy !== null) {\n      // Auto add color to uncolored nodes\n      autoColorObjects(state.graphData.nodes, accessorFn(state.nodeAutoColorBy), state.nodeColor);\n    }\n\n    if (state.linkAutoColorBy !== null) {\n      // Auto add color to uncolored links\n      autoColorObjects(state.graphData.links, accessorFn(state.linkAutoColorBy), state.linkColor);\n    } // parse links\n\n\n    state.graphData.links.forEach(function (link) {\n      link.source = link[state.linkSource];\n      link.target = link[state.linkTarget];\n    });\n\n    if (!state.isShadow) {\n      // Add photon particles\n      var linkParticlesAccessor = accessorFn(state.linkDirectionalParticles);\n      state.graphData.links.forEach(function (link) {\n        var numPhotons = Math.round(Math.abs(linkParticlesAccessor(link)));\n\n        if (numPhotons) {\n          link.__photons = _toConsumableArray(Array(numPhotons)).map(function () {\n            return {};\n          });\n        } else {\n          delete link.__photons;\n        }\n      });\n    } // Feed data to force-directed layout\n\n\n    state.forceLayout.stop().alpha(1) // re-heat the simulation\n    .nodes(state.graphData.nodes); // add links (if link force is still active)\n\n    var linkForce = state.forceLayout.force('link');\n\n    if (linkForce) {\n      linkForce.id(function (d) {\n        return d[state.nodeId];\n      }).links(state.graphData.links);\n    } // setup dag force constraints\n\n\n    var nodeDepths = state.dagMode && getDagDepths(state.graphData, function (node) {\n      return node[state.nodeId];\n    }, {\n      nodeFilter: state.dagNodeFilter,\n      onLoopError: state.onDagError || undefined\n    });\n    var maxDepth = Math.max.apply(Math, _toConsumableArray(Object.values(nodeDepths || [])));\n    var dagLevelDistance = state.dagLevelDistance || state.graphData.nodes.length / (maxDepth || 1) * DAG_LEVEL_NODE_RATIO * (['radialin', 'radialout'].indexOf(state.dagMode) !== -1 ? 0.7 : 1); // Fix nodes to x,y for dag mode\n\n    if (state.dagMode) {\n      var getFFn = function getFFn(fix, invert) {\n        return function (node) {\n          return !fix ? undefined : (nodeDepths[node[state.nodeId]] - maxDepth / 2) * dagLevelDistance * (invert ? -1 : 1);\n        };\n      };\n\n      var fxFn = getFFn(['lr', 'rl'].indexOf(state.dagMode) !== -1, state.dagMode === 'rl');\n      var fyFn = getFFn(['td', 'bu'].indexOf(state.dagMode) !== -1, state.dagMode === 'bu');\n      state.graphData.nodes.filter(state.dagNodeFilter).forEach(function (node) {\n        node.fx = fxFn(node);\n        node.fy = fyFn(node);\n      });\n    } // Use radial force for radial dags\n\n\n    state.forceLayout.force('dagRadial', ['radialin', 'radialout'].indexOf(state.dagMode) !== -1 ? forceRadial(function (node) {\n      var nodeDepth = nodeDepths[node[state.nodeId]] || -1;\n      return (state.dagMode === 'radialin' ? maxDepth - nodeDepth : nodeDepth) * dagLevelDistance;\n    }).strength(function (node) {\n      return state.dagNodeFilter(node) ? 1 : 0;\n    }) : null);\n\n    for (var i = 0; i < state.warmupTicks && !(state.d3AlphaMin > 0 && state.forceLayout.alpha() < state.d3AlphaMin); i++) {\n      state.forceLayout.tick();\n    } // Initial ticks before starting to render\n\n\n    this.resetCountdown();\n    state.onFinishUpdate();\n  }\n});\n\nfunction linkKapsule(kapsulePropNames, kapsuleType) {\n  var propNames = kapsulePropNames instanceof Array ? kapsulePropNames : [kapsulePropNames];\n  var dummyK = new kapsuleType(); // To extract defaults\n\n  return {\n    linkProp: function linkProp(prop) {\n      // link property config\n      return {\n        \"default\": dummyK[prop](),\n        onChange: function onChange(v, state) {\n          propNames.forEach(function (propName) {\n            return state[propName][prop](v);\n          });\n        },\n        triggerUpdate: false\n      };\n    },\n    linkMethod: function linkMethod(method) {\n      // link method pass-through\n      return function (state) {\n        for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n          args[_key - 1] = arguments[_key];\n        }\n\n        var returnVals = [];\n        propNames.forEach(function (propName) {\n          var kapsuleInstance = state[propName];\n          var returnVal = kapsuleInstance[method].apply(kapsuleInstance, args);\n\n          if (returnVal !== kapsuleInstance) {\n            returnVals.push(returnVal);\n          }\n        });\n        return returnVals.length ? returnVals[0] : this; // chain based on the parent object, not the inner kapsule\n      };\n    }\n  };\n}\n\nvar HOVER_CANVAS_THROTTLE_DELAY = 800; // ms to throttle shadow canvas updates for perf improvement\n\nvar ZOOM2NODES_FACTOR = 4; // Expose config from forceGraph\n\nvar bindFG = linkKapsule('forceGraph', CanvasForceGraph);\nvar bindBoth = linkKapsule(['forceGraph', 'shadowGraph'], CanvasForceGraph);\nvar linkedProps = Object.assign.apply(Object, _toConsumableArray(['nodeColor', 'nodeAutoColorBy', 'nodeCanvasObject', 'nodeCanvasObjectMode', 'linkColor', 'linkAutoColorBy', 'linkLineDash', 'linkWidth', 'linkCanvasObject', 'linkCanvasObjectMode', 'linkDirectionalArrowLength', 'linkDirectionalArrowColor', 'linkDirectionalArrowRelPos', 'linkDirectionalParticles', 'linkDirectionalParticleSpeed', 'linkDirectionalParticleWidth', 'linkDirectionalParticleColor', 'dagMode', 'dagLevelDistance', 'dagNodeFilter', 'onDagError', 'd3AlphaMin', 'd3AlphaDecay', 'd3VelocityDecay', 'warmupTicks', 'cooldownTicks', 'cooldownTime', 'onEngineTick', 'onEngineStop'].map(function (p) {\n  return _defineProperty({}, p, bindFG.linkProp(p));\n})).concat(_toConsumableArray(['nodeRelSize', 'nodeId', 'nodeVal', 'nodeVisibility', 'linkSource', 'linkTarget', 'linkVisibility', 'linkCurvature'].map(function (p) {\n  return _defineProperty({}, p, bindBoth.linkProp(p));\n}))));\nvar linkedMethods = Object.assign.apply(Object, _toConsumableArray(['d3Force', 'd3ReheatSimulation', 'emitParticle'].map(function (p) {\n  return _defineProperty({}, p, bindFG.linkMethod(p));\n})));\n\nfunction adjustCanvasSize(state) {\n  if (state.canvas) {\n    var curWidth = state.canvas.width;\n    var curHeight = state.canvas.height;\n\n    if (curWidth === 300 && curHeight === 150) {\n      // Default canvas dimensions\n      curWidth = curHeight = 0;\n    }\n\n    var pxScale = window.devicePixelRatio; // 2 on retina displays\n\n    curWidth /= pxScale;\n    curHeight /= pxScale; // Resize canvases\n\n    [state.canvas, state.shadowCanvas].forEach(function (canvas) {\n      // Element size\n      canvas.style.width = \"\".concat(state.width, \"px\");\n      canvas.style.height = \"\".concat(state.height, \"px\"); // Memory size (scaled to avoid blurriness)\n\n      canvas.width = state.width * pxScale;\n      canvas.height = state.height * pxScale; // Normalize coordinate system to use css pixels (on init only)\n\n      if (!curWidth && !curHeight) {\n        canvas.getContext('2d').scale(pxScale, pxScale);\n      }\n    }); // Relative center panning based on 0,0\n\n    var k = zoomTransform(state.canvas).k;\n    state.zoom.translateBy(state.zoom.__baseElem, (state.width - curWidth) / 2 / k, (state.height - curHeight) / 2 / k);\n  }\n}\n\nfunction resetTransform(ctx) {\n  var pxRatio = window.devicePixelRatio;\n  ctx.setTransform(pxRatio, 0, 0, pxRatio, 0, 0);\n}\n\nfunction clearCanvas(ctx, width, height) {\n  ctx.save();\n  resetTransform(ctx); // reset transform\n\n  ctx.clearRect(0, 0, width, height);\n  ctx.restore(); //restore transforms\n} //\n\n\nvar forceGraph = Kapsule({\n  props: _objectSpread2({\n    width: {\n      \"default\": window.innerWidth,\n      onChange: function onChange(_, state) {\n        return adjustCanvasSize(state);\n      },\n      triggerUpdate: false\n    },\n    height: {\n      \"default\": window.innerHeight,\n      onChange: function onChange(_, state) {\n        return adjustCanvasSize(state);\n      },\n      triggerUpdate: false\n    },\n    graphData: {\n      \"default\": {\n        nodes: [],\n        links: []\n      },\n      onChange: function onChange(d, state) {\n        if (d.nodes.length || d.links.length) {\n          console.info('force-graph loading', d.nodes.length + ' nodes', d.links.length + ' links');\n        }\n\n        [{\n          type: 'Node',\n          objs: d.nodes\n        }, {\n          type: 'Link',\n          objs: d.links\n        }].forEach(hexIndex);\n        state.forceGraph.graphData(d);\n        state.shadowGraph.graphData(d);\n\n        function hexIndex(_ref4) {\n          var type = _ref4.type,\n              objs = _ref4.objs;\n          objs.filter(function (d) {\n            if (!d.hasOwnProperty('__indexColor')) return true;\n            var cur = state.colorTracker.lookup(d.__indexColor);\n            return !cur || !cur.hasOwnProperty('d') || cur.d !== d;\n          }).forEach(function (d) {\n            // store object lookup color\n            d.__indexColor = state.colorTracker.register({\n              type: type,\n              d: d\n            });\n          });\n        }\n      },\n      triggerUpdate: false\n    },\n    backgroundColor: {\n      onChange: function onChange(color, state) {\n        state.canvas && color && (state.canvas.style.background = color);\n      },\n      triggerUpdate: false\n    },\n    nodeLabel: {\n      \"default\": 'name',\n      triggerUpdate: false\n    },\n    linkLabel: {\n      \"default\": 'name',\n      triggerUpdate: false\n    },\n    linkHoverPrecision: {\n      \"default\": 4,\n      triggerUpdate: false\n    },\n    enableNodeDrag: {\n      \"default\": true,\n      triggerUpdate: false\n    },\n    enableZoomPanInteraction: {\n      \"default\": true,\n      triggerUpdate: false\n    },\n    enablePointerInteraction: {\n      \"default\": true,\n      onChange: function onChange(_, state) {\n        state.hoverObj = null;\n      },\n      triggerUpdate: false\n    },\n    onNodeDrag: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onNodeDragEnd: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onNodeClick: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onNodeRightClick: {\n      triggerUpdate: false\n    },\n    onNodeHover: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onLinkClick: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onLinkRightClick: {\n      triggerUpdate: false\n    },\n    onLinkHover: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onBackgroundClick: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onBackgroundRightClick: {\n      triggerUpdate: false\n    },\n    onZoom: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onZoomEnd: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onRenderFramePre: {\n      triggerUpdate: false\n    },\n    onRenderFramePost: {\n      triggerUpdate: false\n    }\n  }, linkedProps),\n  aliases: {\n    // Prop names supported for backwards compatibility\n    stopAnimation: 'pauseAnimation'\n  },\n  methods: _objectSpread2({\n    graph2ScreenCoords: function graph2ScreenCoords(state, x, y) {\n      var t = zoomTransform(state.canvas);\n      return {\n        x: x * t.k + t.x,\n        y: y * t.k + t.y\n      };\n    },\n    screen2GraphCoords: function screen2GraphCoords(state, x, y) {\n      var t = zoomTransform(state.canvas);\n      return {\n        x: (x - t.x) / t.k,\n        y: (y - t.y) / t.k\n      };\n    },\n    centerAt: function centerAt(state, x, y, transitionDuration) {\n      if (!state.canvas) return null; // no canvas yet\n      // setter\n\n      if (x !== undefined || y !== undefined) {\n        var finalPos = Object.assign({}, x !== undefined ? {\n          x: x\n        } : {}, y !== undefined ? {\n          y: y\n        } : {});\n\n        if (!transitionDuration) {\n          // no animation\n          setCenter(finalPos);\n        } else {\n          new TWEEN.Tween(getCenter()).to(finalPos, transitionDuration).easing(TWEEN.Easing.Quadratic.Out).onUpdate(setCenter).start();\n        }\n\n        return this;\n      } // getter\n\n\n      return getCenter(); //\n\n      function getCenter() {\n        var t = zoomTransform(state.canvas);\n        return {\n          x: (state.width / 2 - t.x) / t.k,\n          y: (state.height / 2 - t.y) / t.k\n        };\n      }\n\n      function setCenter(_ref5) {\n        var x = _ref5.x,\n            y = _ref5.y;\n        state.zoom.translateTo(state.zoom.__baseElem, x === undefined ? getCenter().x : x, y === undefined ? getCenter().y : y);\n      }\n    },\n    zoom: function zoom(state, k, transitionDuration) {\n      if (!state.canvas) return null; // no canvas yet\n      // setter\n\n      if (k !== undefined) {\n        if (!transitionDuration) {\n          // no animation\n          setZoom(k);\n        } else {\n          new TWEEN.Tween({\n            k: getZoom()\n          }).to({\n            k: k\n          }, transitionDuration).easing(TWEEN.Easing.Quadratic.Out).onUpdate(function (_ref6) {\n            var k = _ref6.k;\n            return setZoom(k);\n          }).start();\n        }\n\n        return this;\n      } // getter\n\n\n      return getZoom(); //\n\n      function getZoom() {\n        return zoomTransform(state.canvas).k;\n      }\n\n      function setZoom(k) {\n        state.zoom.scaleTo(state.zoom.__baseElem, k);\n      }\n    },\n    zoomToFit: function zoomToFit(state) {\n      var transitionDuration = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n      var padding = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 10;\n\n      for (var _len = arguments.length, bboxArgs = new Array(_len > 3 ? _len - 3 : 0), _key = 3; _key < _len; _key++) {\n        bboxArgs[_key - 3] = arguments[_key];\n      }\n\n      var bbox = this.getGraphBbox.apply(this, bboxArgs);\n\n      if (bbox) {\n        var center = {\n          x: (bbox.x[0] + bbox.x[1]) / 2,\n          y: (bbox.y[0] + bbox.y[1]) / 2\n        };\n        var zoomK = Math.max(1e-12, Math.min(1e12, (state.width - padding * 2) / (bbox.x[1] - bbox.x[0]), (state.height - padding * 2) / (bbox.y[1] - bbox.y[0])));\n        this.centerAt(center.x, center.y, transitionDuration);\n        this.zoom(zoomK, transitionDuration);\n      }\n\n      return this;\n    },\n    getGraphBbox: function getGraphBbox(state) {\n      var nodeFilter = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : function () {\n        return true;\n      };\n      var getVal = accessorFn(state.nodeVal);\n\n      var getR = function getR(node) {\n        return Math.sqrt(Math.max(0, getVal(node) || 1)) * state.nodeRelSize;\n      };\n\n      var nodesPos = state.graphData.nodes.filter(nodeFilter).map(function (node) {\n        return {\n          x: node.x,\n          y: node.y,\n          r: getR(node)\n        };\n      });\n      return !nodesPos.length ? null : {\n        x: [min(nodesPos, function (node) {\n          return node.x - node.r;\n        }), max(nodesPos, function (node) {\n          return node.x + node.r;\n        })],\n        y: [min(nodesPos, function (node) {\n          return node.y - node.r;\n        }), max(nodesPos, function (node) {\n          return node.y + node.r;\n        })]\n      };\n    },\n    pauseAnimation: function pauseAnimation(state) {\n      if (state.animationFrameRequestId) {\n        cancelAnimationFrame(state.animationFrameRequestId);\n        state.animationFrameRequestId = null;\n      }\n\n      return this;\n    },\n    resumeAnimation: function resumeAnimation(state) {\n      if (!state.animationFrameRequestId) {\n        this._animationCycle();\n      }\n\n      return this;\n    },\n    _destructor: function _destructor() {\n      this.pauseAnimation();\n      this.graphData({\n        nodes: [],\n        links: []\n      });\n    }\n  }, linkedMethods),\n  stateInit: function stateInit() {\n    return {\n      lastSetZoom: 1,\n      forceGraph: new CanvasForceGraph(),\n      shadowGraph: new CanvasForceGraph().cooldownTicks(0).nodeColor('__indexColor').linkColor('__indexColor').isShadow(true),\n      colorTracker: new ColorTracker() // indexed objects for rgb lookup\n\n    };\n  },\n  init: function init(domNode, state) {\n    // Wipe DOM\n    domNode.innerHTML = ''; // Container anchor for canvas and tooltip\n\n    var container = document.createElement('div');\n    container.classList.add('force-graph-container');\n    container.style.position = 'relative';\n    domNode.appendChild(container);\n    state.canvas = document.createElement('canvas');\n    if (state.backgroundColor) state.canvas.style.background = state.backgroundColor;\n    container.appendChild(state.canvas);\n    state.shadowCanvas = document.createElement('canvas'); // Show shadow canvas\n    //state.shadowCanvas.style.position = 'absolute';\n    //state.shadowCanvas.style.top = '0';\n    //state.shadowCanvas.style.left = '0';\n    //container.appendChild(state.shadowCanvas);\n\n    var ctx = state.canvas.getContext('2d');\n    var shadowCtx = state.shadowCanvas.getContext('2d'); // Setup node drag interaction\n\n    select(state.canvas).call(drag().subject(function () {\n      if (!state.enableNodeDrag) {\n        return null;\n      }\n\n      var obj = state.hoverObj;\n      return obj && obj.type === 'Node' ? obj.d : null; // Only drag nodes\n    }).on('start', function (ev) {\n      var obj = ev.subject;\n      obj.__initialDragPos = {\n        x: obj.x,\n        y: obj.y,\n        fx: obj.fx,\n        fy: obj.fy\n      }; // keep engine running at low intensity throughout drag\n\n      if (!ev.active) {\n        obj.fx = obj.x;\n        obj.fy = obj.y; // Fix points\n      } // drag cursor\n\n\n      state.canvas.classList.add('grabbable');\n    }).on('drag', function (ev) {\n      var obj = ev.subject;\n      var initPos = obj.__initialDragPos;\n      var dragPos = ev;\n      var k = zoomTransform(state.canvas).k;\n      var translate = {\n        x: initPos.x + (dragPos.x - initPos.x) / k - obj.x,\n        y: initPos.y + (dragPos.y - initPos.y) / k - obj.y\n      }; // Move fx/fy (and x/y) of nodes based on the scaled drag distance since the drag start\n\n      ['x', 'y'].forEach(function (c) {\n        return obj[\"f\".concat(c)] = obj[c] = initPos[c] + (dragPos[c] - initPos[c]) / k;\n      }); // prevent freeze while dragging\n\n      state.forceGraph.d3AlphaTarget(0.3) // keep engine running at low intensity throughout drag\n      .resetCountdown(); // prevent freeze while dragging\n\n      obj.__dragged = true;\n      state.onNodeDrag(obj, translate);\n    }).on('end', function (ev) {\n      var obj = ev.subject;\n      var initPos = obj.__initialDragPos;\n      var translate = {\n        x: obj.x - initPos.x,\n        y: obj.y - initPos.y\n      };\n\n      if (initPos.fx === undefined) {\n        obj.fx = undefined;\n      }\n\n      if (initPos.fy === undefined) {\n        obj.fy = undefined;\n      }\n\n      delete obj.__initialDragPos;\n      state.forceGraph.d3AlphaTarget(0) // release engine low intensity\n      .resetCountdown(); // let the engine readjust after releasing fixed nodes\n      // drag cursor\n\n      state.canvas.classList.remove('grabbable');\n\n      if (obj.__dragged) {\n        delete obj.__dragged;\n        state.onNodeDragEnd(obj, translate);\n      }\n    })); // Setup zoom / pan interaction\n\n    state.zoom = zoom();\n    state.zoom(state.zoom.__baseElem = select(state.canvas)); // Attach controlling elem for easy access\n\n    state.zoom.__baseElem.on('dblclick.zoom', null); // Disable double-click to zoom\n\n\n    state.zoom.filter(function (ev) {\n      return state.enableZoomPanInteraction ? !ev.button : false;\n    }) // disable zoom interaction\n    .scaleExtent([0.01, 1000]).on('zoom', function () {\n      var t = zoomTransform(this); // Same as d3.event.transform\n\n      [ctx, shadowCtx].forEach(function (c) {\n        resetTransform(c);\n        c.translate(t.x, t.y);\n        c.scale(t.k, t.k);\n      });\n      state.onZoom(_objectSpread2({}, t));\n    }).on('end', function () {\n      var t = zoomTransform(this); // Same as d3.event.transform\n\n      state.onZoomEnd(_objectSpread2({}, t));\n    });\n    adjustCanvasSize(state);\n    state.forceGraph.onFinishUpdate(function () {\n      // re-zoom, if still in default position (not user modified)\n      if (zoomTransform(state.canvas).k === state.lastSetZoom && state.graphData.nodes.length) {\n        state.zoom.scaleTo(state.zoom.__baseElem, state.lastSetZoom = ZOOM2NODES_FACTOR / Math.cbrt(state.graphData.nodes.length));\n      }\n    }); // Setup tooltip\n\n    var toolTipElem = document.createElement('div');\n    toolTipElem.classList.add('graph-tooltip');\n    container.appendChild(toolTipElem); // Capture pointer coords on move or touchstart\n\n    var pointerPos = {\n      x: -1e12,\n      y: -1e12\n    };\n    ['pointermove', 'pointerdown'].forEach(function (evType) {\n      return container.addEventListener(evType, function (ev) {\n        // detect point drag\n        !state.isPointerDragging && ev.type === 'pointermove' && ev.pressure > 0 && [ev.movementX, ev.movementY].some(function (m) {\n          return Math.abs(m) > (ev.pointerType === 'touch' ? 1 : 0);\n        }) // relax drag trigger sensitivity on touch events\n        && (state.isPointerDragging = true); // update the pointer pos\n\n        var offset = getOffset(container);\n        pointerPos.x = ev.pageX - offset.left;\n        pointerPos.y = ev.pageY - offset.top; // Move tooltip\n\n        toolTipElem.style.top = \"\".concat(pointerPos.y, \"px\");\n        toolTipElem.style.left = \"\".concat(pointerPos.x, \"px\"); //\n\n        function getOffset(el) {\n          var rect = el.getBoundingClientRect(),\n              scrollLeft = window.pageXOffset || document.documentElement.scrollLeft,\n              scrollTop = window.pageYOffset || document.documentElement.scrollTop;\n          return {\n            top: rect.top + scrollTop,\n            left: rect.left + scrollLeft\n          };\n        }\n      }, {\n        passive: true\n      });\n    }); // Handle click/touch events on nodes/links\n\n    container.addEventListener('pointerup', function (ev) {\n      if (state.isPointerDragging) {\n        state.isPointerDragging = false;\n        return; // don't trigger click events after pointer drag (pan / node drag functionality)\n      }\n\n      requestAnimationFrame(function () {\n        // trigger click events asynchronously, to allow hoverObj to be set (on frame)\n        if (ev.button === 0) {\n          // mouse left-click or touch\n          if (state.hoverObj) {\n            state[\"on\".concat(state.hoverObj.type, \"Click\")](state.hoverObj.d, ev);\n          } else {\n            state.onBackgroundClick(ev);\n          }\n        }\n\n        if (ev.button === 2) {\n          // mouse right-click\n          if (state.hoverObj) {\n            var fn = state[\"on\".concat(state.hoverObj.type, \"RightClick\")];\n            fn && fn(state.hoverObj.d, ev);\n          } else {\n            state.onBackgroundRightClick && state.onBackgroundRightClick(ev);\n          }\n        }\n      });\n    }, {\n      passive: true\n    });\n    container.addEventListener('contextmenu', function (ev) {\n      if (!state.onBackgroundRightClick && !state.onNodeRightClick && !state.onLinkRightClick) return true; // default contextmenu behavior\n\n      ev.preventDefault();\n      return false;\n    });\n    state.forceGraph(ctx);\n    state.shadowGraph(shadowCtx); //\n\n    var refreshShadowCanvas = throttle(function () {\n      // wipe canvas\n      clearCanvas(shadowCtx, state.width, state.height); // Adjust link hover area\n\n      state.shadowGraph.linkWidth(function (l) {\n        return accessorFn(state.linkWidth)(l) + state.linkHoverPrecision;\n      }); // redraw\n\n      var t = zoomTransform(state.canvas);\n      state.shadowGraph.globalScale(t.k).tickFrame();\n    }, HOVER_CANVAS_THROTTLE_DELAY); // Kick-off renderer\n\n    (this._animationCycle = function animate() {\n      // IIFE\n      if (state.enablePointerInteraction) {\n        // Update tooltip and trigger onHover events\n        var obj = null;\n\n        if (!state.isPointerDragging) {\n          // don't hover during drag\n          // Lookup object per pixel color\n          var pxScale = window.devicePixelRatio;\n          var px = pointerPos.x > 0 && pointerPos.y > 0 ? shadowCtx.getImageData(pointerPos.x * pxScale, pointerPos.y * pxScale, 1, 1) : null;\n          px && (obj = state.colorTracker.lookup(px.data));\n        }\n\n        if (obj !== state.hoverObj) {\n          var prevObj = state.hoverObj;\n          var prevObjType = prevObj ? prevObj.type : null;\n          var objType = obj ? obj.type : null;\n\n          if (prevObjType && prevObjType !== objType) {\n            // Hover out\n            state[\"on\".concat(prevObjType, \"Hover\")](null, prevObj.d);\n          }\n\n          if (objType) {\n            // Hover in\n            state[\"on\".concat(objType, \"Hover\")](obj.d, prevObjType === objType ? prevObj.d : null);\n          }\n\n          var tooltipContent = obj ? accessorFn(state[\"\".concat(obj.type.toLowerCase(), \"Label\")])(obj.d) || '' : '';\n          toolTipElem.style.visibility = tooltipContent ? 'visible' : 'hidden';\n          toolTipElem.innerHTML = tooltipContent;\n          state.hoverObj = obj;\n        }\n\n        refreshShadowCanvas();\n      } // Wipe canvas\n\n\n      clearCanvas(ctx, state.width, state.height); // Frame cycle\n\n      var globalScale = zoomTransform(state.canvas).k;\n      state.onRenderFramePre && state.onRenderFramePre(ctx, globalScale);\n      state.forceGraph.globalScale(globalScale).tickFrame();\n      state.onRenderFramePost && state.onRenderFramePost(ctx, globalScale);\n      TWEEN.update(); // update canvas animation tweens\n\n      state.animationFrameRequestId = requestAnimationFrame(animate);\n    })();\n  },\n  update: function updateFn(state) {}\n});\nexport default forceGraph;","map":{"version":3,"sources":["/home/telix/dictographo/frontend/node_modules/force-graph/dist/force-graph.module.js"],"names":["select","zoomTransform","zoom","drag","min","max","throttle","TWEEN","Kapsule","accessorFn","ColorTracker","forceSimulation","forceLink","forceManyBody","forceCenter","forceRadial","Bezier","indexBy","scaleOrdinal","schemePaired","styleInject","css","ref","insertAt","document","head","getElementsByTagName","style","createElement","type","firstChild","insertBefore","appendChild","styleSheet","cssText","createTextNode","css_248z","_typeof","obj","Symbol","iterator","constructor","prototype","_defineProperty","key","value","Object","defineProperty","enumerable","configurable","writable","ownKeys","object","enumerableOnly","keys","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","push","apply","_objectSpread2","target","i","arguments","length","source","forEach","getOwnPropertyDescriptors","defineProperties","_setPrototypeOf","o","p","setPrototypeOf","__proto__","_isNativeReflectConstruct","Reflect","construct","sham","Proxy","Date","toString","call","e","_construct","Parent","args","Class","a","Constructor","Function","bind","instance","_slicedToArray","arr","_arrayWithHoles","_iterableToArrayLimit","_unsupportedIterableToArray","_nonIterableRest","_toConsumableArray","_arrayWithoutHoles","_iterableToArray","_nonIterableSpread","Array","isArray","_arrayLikeToArray","iter","from","_arr","_n","_d","_e","undefined","_i","_s","next","done","err","minLen","n","slice","name","test","len","arr2","TypeError","autoColorScale","autoColorObjects","objects","colorByAccessor","colorField","getDagDepths","_ref","idAccessor","nodes","links","_ref2","_ref2$nodeFilter","nodeFilter","_ref2$onLoopError","onLoopError","loopIds","concat","join","graph","node","data","out","depth","skip","_ref3","sourceId","getNodeId","targetId","hasOwnProperty","sourceNode","targetNode","foundLoops","traverse","values","nodeDepths","assign","entries","_ref4","_ref5","map","_ref6","_ref7","id","nodeStack","currentDepth","l","indexOf","_ret","loop","d","some","foundLoop","every","idx","DAG_LEVEL_NODE_RATIO","CanvasForceGraph","props","graphData","onChange","_","state","engineRunning","dagMode","fx","fy","dagLevelDistance","dagNodeFilter","_default","onDagError","triggerUpdate","nodeRelSize","nodeId","nodeVal","nodeColor","nodeAutoColorBy","nodeCanvasObject","nodeCanvasObjectMode","nodeVisibility","linkSource","linkTarget","linkVisibility","linkColor","linkAutoColorBy","linkLineDash","linkWidth","linkCurvature","linkCanvasObject","linkCanvasObjectMode","linkDirectionalArrowLength","linkDirectionalArrowColor","linkDirectionalArrowRelPos","linkDirectionalParticles","linkDirectionalParticleSpeed","linkDirectionalParticleWidth","linkDirectionalParticleColor","globalScale","d3AlphaMin","d3AlphaDecay","alphaDecay","forceLayout","d3AlphaTarget","alphaTarget","d3VelocityDecay","velocityDecay","warmupTicks","cooldownTicks","Infinity","cooldownTime","onUpdate","onFinishUpdate","onEngineTick","onEngineStop","isShadow","methods","d3Force","forceName","forceFn","force","d3ReheatSimulation","alpha","resetCountdown","cntTicks","startTickTime","tickFrame","layoutTick","paintLinks","paintArrows","paintPhotons","paintNodes","tick","getVisibility","getVal","getColor","getNodeCanvasObjectMode","ctx","padAmount","visibleNodes","save","restore","r","Math","sqrt","beginPath","arc","x","y","PI","fillStyle","fill","getWidth","getLineDash","getCurvature","getLinkCanvasObjectMode","visibleLinks","calcLinkControlPoints","beforeCustomLinks","afterCustomLinks","defaultPaintLinks","replaceCustomLinks","otherCustomLinks","before","after","replace","link","linksPerColor","color","linksPerWidth","lineColor","width","linesPerLineDash","lineWidth","dashSegments","lineDashSegments","start","end","moveTo","controlPoints","__controlPoints","lineTo","strokeStyle","setLineDash","stroke","curvature","pow","atan2","cp","cos","sin","ARROW_WH_RATIO","ARROW_VLEN_RATIO","getLength","getRelPos","getNodeVal","arrowLength","startR","endR","arrowRelPos","arrowColor","arrowHalfWidth","bzLine","getCoordsAlongLine","t","get","lineLen","posAlongLine","arrowHead","arrowTail","arrowTailVertex","arrowTailAngle","getNumPhotons","getSpeed","getDiameter","numCyclePhotons","__photons","particleSpeed","photons","photonR","photonColor","cyclePhotonIdx","needsCleanup","photon","singleHop","__singleHop","__progressRatio","photonPosRatio","coords","emitParticle","stateInit","stop","init","canvasCtx","update","linkParticlesAccessor","numPhotons","round","abs","linkForce","maxDepth","getFFn","fix","invert","fxFn","fyFn","nodeDepth","strength","linkKapsule","kapsulePropNames","kapsuleType","propNames","dummyK","linkProp","prop","v","propName","linkMethod","method","_len","_key","returnVals","kapsuleInstance","returnVal","HOVER_CANVAS_THROTTLE_DELAY","ZOOM2NODES_FACTOR","bindFG","bindBoth","linkedProps","linkedMethods","adjustCanvasSize","canvas","curWidth","curHeight","height","pxScale","window","devicePixelRatio","shadowCanvas","getContext","scale","k","translateBy","__baseElem","resetTransform","pxRatio","setTransform","clearCanvas","clearRect","forceGraph","innerWidth","innerHeight","console","info","objs","hexIndex","shadowGraph","cur","colorTracker","lookup","__indexColor","register","backgroundColor","background","nodeLabel","linkLabel","linkHoverPrecision","enableNodeDrag","enableZoomPanInteraction","enablePointerInteraction","hoverObj","onNodeDrag","onNodeDragEnd","onNodeClick","onNodeRightClick","onNodeHover","onLinkClick","onLinkRightClick","onLinkHover","onBackgroundClick","onBackgroundRightClick","onZoom","onZoomEnd","onRenderFramePre","onRenderFramePost","aliases","stopAnimation","graph2ScreenCoords","screen2GraphCoords","centerAt","transitionDuration","finalPos","setCenter","Tween","getCenter","to","easing","Easing","Quadratic","Out","translateTo","setZoom","getZoom","scaleTo","zoomToFit","padding","bboxArgs","bbox","getGraphBbox","center","zoomK","getR","nodesPos","pauseAnimation","animationFrameRequestId","cancelAnimationFrame","resumeAnimation","_animationCycle","_destructor","lastSetZoom","domNode","innerHTML","container","classList","add","position","shadowCtx","subject","on","ev","__initialDragPos","active","initPos","dragPos","translate","c","__dragged","remove","button","scaleExtent","cbrt","toolTipElem","pointerPos","evType","addEventListener","isPointerDragging","pressure","movementX","movementY","m","pointerType","offset","getOffset","pageX","left","pageY","top","el","rect","getBoundingClientRect","scrollLeft","pageXOffset","documentElement","scrollTop","pageYOffset","passive","requestAnimationFrame","fn","preventDefault","refreshShadowCanvas","animate","px","getImageData","prevObj","prevObjType","objType","tooltipContent","toLowerCase","visibility","updateFn"],"mappings":"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","sourcesContent":["import { select } from 'd3-selection';\nimport { zoomTransform, zoom } from 'd3-zoom';\nimport { drag } from 'd3-drag';\nimport { min, max } from 'd3-array';\nimport throttle from 'lodash.throttle';\nimport TWEEN from '@tweenjs/tween.js';\nimport Kapsule from 'kapsule';\nimport accessorFn from 'accessor-fn';\nimport ColorTracker from 'canvas-color-tracker';\nimport { forceSimulation, forceLink, forceManyBody, forceCenter, forceRadial } from 'd3-force-3d';\nimport { Bezier } from 'bezier-js';\nimport indexBy from 'index-array-by';\nimport { scaleOrdinal } from 'd3-scale';\nimport { schemePaired } from 'd3-scale-chromatic';\n\nfunction styleInject(css, ref) {\n  if (ref === void 0) ref = {};\n  var insertAt = ref.insertAt;\n\n  if (!css || typeof document === 'undefined') {\n    return;\n  }\n\n  var head = document.head || document.getElementsByTagName('head')[0];\n  var style = document.createElement('style');\n  style.type = 'text/css';\n\n  if (insertAt === 'top') {\n    if (head.firstChild) {\n      head.insertBefore(style, head.firstChild);\n    } else {\n      head.appendChild(style);\n    }\n  } else {\n    head.appendChild(style);\n  }\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = css;\n  } else {\n    style.appendChild(document.createTextNode(css));\n  }\n}\n\nvar css_248z = \".force-graph-container canvas {\\n  display: block;\\n  user-select: none;\\n  outline: none;\\n  -webkit-tap-highlight-color: transparent;\\n}\\n\\n.force-graph-container .graph-tooltip {\\n  position: absolute;\\n  transform: translate(-50%, 25px);\\n  font-family: sans-serif;\\n  font-size: 16px;\\n  padding: 4px;\\n  border-radius: 3px;\\n  color: #eee;\\n  background: rgba(0,0,0,0.65);\\n  visibility: hidden; /* by default */\\n}\\n\\n.force-graph-container .grabbable {\\n  cursor: move;\\n  cursor: grab;\\n  cursor: -moz-grab;\\n  cursor: -webkit-grab;\\n}\\n\\n.force-graph-container .grabbable:active {\\n  cursor: grabbing;\\n  cursor: -moz-grabbing;\\n  cursor: -webkit-grabbing;\\n}\\n\";\nstyleInject(css_248z);\n\nfunction _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") {\n    _typeof = function (obj) {\n      return typeof obj;\n    };\n  } else {\n    _typeof = function (obj) {\n      return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n    };\n  }\n\n  return _typeof(obj);\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    if (enumerableOnly) symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    });\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread2(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      ownKeys(Object(source), true).forEach(function (key) {\n        _defineProperty(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(Object(source)).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n\n  return target;\n}\n\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}\n\nfunction _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n\n  try {\n    Date.prototype.toString.call(Reflect.construct(Date, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\nfunction _construct(Parent, args, Class) {\n  if (_isNativeReflectConstruct()) {\n    _construct = Reflect.construct;\n  } else {\n    _construct = function _construct(Parent, args, Class) {\n      var a = [null];\n      a.push.apply(a, args);\n      var Constructor = Function.bind.apply(Parent, a);\n      var instance = new Constructor();\n      if (Class) _setPrototypeOf(instance, Class.prototype);\n      return instance;\n    };\n  }\n\n  return _construct.apply(null, arguments);\n}\n\nfunction _slicedToArray(arr, i) {\n  return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest();\n}\n\nfunction _toConsumableArray(arr) {\n  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread();\n}\n\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) return _arrayLikeToArray(arr);\n}\n\nfunction _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}\n\nfunction _iterableToArray(iter) {\n  if (typeof Symbol !== \"undefined\" && Symbol.iterator in Object(iter)) return Array.from(iter);\n}\n\nfunction _iterableToArrayLimit(arr, i) {\n  if (typeof Symbol === \"undefined\" || !(Symbol.iterator in Object(arr))) return;\n  var _arr = [];\n  var _n = true;\n  var _d = false;\n  var _e = undefined;\n\n  try {\n    for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {\n      _arr.push(_s.value);\n\n      if (i && _arr.length === i) break;\n    }\n  } catch (err) {\n    _d = true;\n    _e = err;\n  } finally {\n    try {\n      if (!_n && _i[\"return\"] != null) _i[\"return\"]();\n    } finally {\n      if (_d) throw _e;\n    }\n  }\n\n  return _arr;\n}\n\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n}\n\nfunction _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n\n  for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];\n\n  return arr2;\n}\n\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nfunction _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nvar autoColorScale = scaleOrdinal(schemePaired); // Autoset attribute colorField by colorByAccessor property\n// If an object has already a color, don't set it\n// Objects can be nodes or links\n\nfunction autoColorObjects(objects, colorByAccessor, colorField) {\n  if (!colorByAccessor || typeof colorField !== 'string') return;\n  objects.filter(function (obj) {\n    return !obj[colorField];\n  }).forEach(function (obj) {\n    obj[colorField] = autoColorScale(colorByAccessor(obj));\n  });\n}\n\nfunction getDagDepths (_ref, idAccessor) {\n  var nodes = _ref.nodes,\n      links = _ref.links;\n\n  var _ref2 = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {},\n      _ref2$nodeFilter = _ref2.nodeFilter,\n      nodeFilter = _ref2$nodeFilter === void 0 ? function () {\n    return true;\n  } : _ref2$nodeFilter,\n      _ref2$onLoopError = _ref2.onLoopError,\n      onLoopError = _ref2$onLoopError === void 0 ? function (loopIds) {\n    throw \"Invalid DAG structure! Found cycle in node path: \".concat(loopIds.join(' -> '), \".\");\n  } : _ref2$onLoopError;\n\n  // linked graph\n  var graph = {};\n  nodes.forEach(function (node) {\n    return graph[idAccessor(node)] = {\n      data: node,\n      out: [],\n      depth: -1,\n      skip: !nodeFilter(node)\n    };\n  });\n  links.forEach(function (_ref3) {\n    var source = _ref3.source,\n        target = _ref3.target;\n    var sourceId = getNodeId(source);\n    var targetId = getNodeId(target);\n    if (!graph.hasOwnProperty(sourceId)) throw \"Missing source node with id: \".concat(sourceId);\n    if (!graph.hasOwnProperty(targetId)) throw \"Missing target node with id: \".concat(targetId);\n    var sourceNode = graph[sourceId];\n    var targetNode = graph[targetId];\n    sourceNode.out.push(targetNode);\n\n    function getNodeId(node) {\n      return _typeof(node) === 'object' ? idAccessor(node) : node;\n    }\n  });\n  var foundLoops = [];\n  traverse(Object.values(graph));\n  var nodeDepths = Object.assign.apply(Object, [{}].concat(_toConsumableArray(Object.entries(graph).filter(function (_ref4) {\n    var _ref5 = _slicedToArray(_ref4, 2),\n        node = _ref5[1];\n\n    return !node.skip;\n  }).map(function (_ref6) {\n    var _ref7 = _slicedToArray(_ref6, 2),\n        id = _ref7[0],\n        node = _ref7[1];\n\n    return _defineProperty({}, id, node.depth);\n  }))));\n  return nodeDepths;\n\n  function traverse(nodes) {\n    var nodeStack = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];\n    var currentDepth = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n\n    for (var i = 0, l = nodes.length; i < l; i++) {\n      var node = nodes[i];\n\n      if (nodeStack.indexOf(node) !== -1) {\n        var _ret = function () {\n          var loop = [].concat(_toConsumableArray(nodeStack.slice(nodeStack.indexOf(node))), [node]).map(function (d) {\n            return idAccessor(d.data);\n          });\n\n          if (!foundLoops.some(function (foundLoop) {\n            return foundLoop.length === loop.length && foundLoop.every(function (id, idx) {\n              return id === loop[idx];\n            });\n          })) {\n            foundLoops.push(loop);\n            onLoopError(loop);\n          }\n\n          return \"continue\";\n        }();\n\n        if (_ret === \"continue\") continue;\n      }\n\n      if (currentDepth > node.depth) {\n        // Don't unnecessarily revisit chunks of the graph\n        node.depth = currentDepth;\n        traverse(node.out, [].concat(_toConsumableArray(nodeStack), [node]), currentDepth + (node.skip ? 0 : 1));\n      }\n    }\n  }\n}\n\nvar DAG_LEVEL_NODE_RATIO = 2;\nvar CanvasForceGraph = Kapsule({\n  props: {\n    graphData: {\n      \"default\": {\n        nodes: [],\n        links: []\n      },\n      onChange: function onChange(_, state) {\n        state.engineRunning = false;\n      } // Pause simulation\n\n    },\n    dagMode: {\n      onChange: function onChange(dagMode, state) {\n        // td, bu, lr, rl, radialin, radialout\n        !dagMode && (state.graphData.nodes || []).forEach(function (n) {\n          return n.fx = n.fy = undefined;\n        }); // unfix nodes when disabling dag mode\n      }\n    },\n    dagLevelDistance: {},\n    dagNodeFilter: {\n      \"default\": function _default(node) {\n        return true;\n      }\n    },\n    onDagError: {\n      triggerUpdate: false\n    },\n    nodeRelSize: {\n      \"default\": 4,\n      triggerUpdate: false\n    },\n    // area per val unit\n    nodeId: {\n      \"default\": 'id'\n    },\n    nodeVal: {\n      \"default\": 'val',\n      triggerUpdate: false\n    },\n    nodeColor: {\n      \"default\": 'color',\n      triggerUpdate: false\n    },\n    nodeAutoColorBy: {},\n    nodeCanvasObject: {\n      triggerUpdate: false\n    },\n    nodeCanvasObjectMode: {\n      \"default\": function _default() {\n        return 'replace';\n      },\n      triggerUpdate: false\n    },\n    nodeVisibility: {\n      \"default\": true,\n      triggerUpdate: false\n    },\n    linkSource: {\n      \"default\": 'source'\n    },\n    linkTarget: {\n      \"default\": 'target'\n    },\n    linkVisibility: {\n      \"default\": true,\n      triggerUpdate: false\n    },\n    linkColor: {\n      \"default\": 'color',\n      triggerUpdate: false\n    },\n    linkAutoColorBy: {},\n    linkLineDash: {\n      triggerUpdate: false\n    },\n    linkWidth: {\n      \"default\": 1,\n      triggerUpdate: false\n    },\n    linkCurvature: {\n      \"default\": 0,\n      triggerUpdate: false\n    },\n    linkCanvasObject: {\n      triggerUpdate: false\n    },\n    linkCanvasObjectMode: {\n      \"default\": function _default() {\n        return 'replace';\n      },\n      triggerUpdate: false\n    },\n    linkDirectionalArrowLength: {\n      \"default\": 0,\n      triggerUpdate: false\n    },\n    linkDirectionalArrowColor: {\n      triggerUpdate: false\n    },\n    linkDirectionalArrowRelPos: {\n      \"default\": 0.5,\n      triggerUpdate: false\n    },\n    // value between 0<>1 indicating the relative pos along the (exposed) line\n    linkDirectionalParticles: {\n      \"default\": 0\n    },\n    // animate photons travelling in the link direction\n    linkDirectionalParticleSpeed: {\n      \"default\": 0.01,\n      triggerUpdate: false\n    },\n    // in link length ratio per frame\n    linkDirectionalParticleWidth: {\n      \"default\": 4,\n      triggerUpdate: false\n    },\n    linkDirectionalParticleColor: {\n      triggerUpdate: false\n    },\n    globalScale: {\n      \"default\": 1,\n      triggerUpdate: false\n    },\n    d3AlphaMin: {\n      \"default\": 0,\n      triggerUpdate: false\n    },\n    d3AlphaDecay: {\n      \"default\": 0.0228,\n      triggerUpdate: false,\n      onChange: function onChange(alphaDecay, state) {\n        state.forceLayout.alphaDecay(alphaDecay);\n      }\n    },\n    d3AlphaTarget: {\n      \"default\": 0,\n      triggerUpdate: false,\n      onChange: function onChange(alphaTarget, state) {\n        state.forceLayout.alphaTarget(alphaTarget);\n      }\n    },\n    d3VelocityDecay: {\n      \"default\": 0.4,\n      triggerUpdate: false,\n      onChange: function onChange(velocityDecay, state) {\n        state.forceLayout.velocityDecay(velocityDecay);\n      }\n    },\n    warmupTicks: {\n      \"default\": 0,\n      triggerUpdate: false\n    },\n    // how many times to tick the force engine at init before starting to render\n    cooldownTicks: {\n      \"default\": Infinity,\n      triggerUpdate: false\n    },\n    cooldownTime: {\n      \"default\": 15000,\n      triggerUpdate: false\n    },\n    // ms\n    onUpdate: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onFinishUpdate: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onEngineTick: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onEngineStop: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    isShadow: {\n      \"default\": false,\n      triggerUpdate: false\n    }\n  },\n  methods: {\n    // Expose d3 forces for external manipulation\n    d3Force: function d3Force(state, forceName, forceFn) {\n      if (forceFn === undefined) {\n        return state.forceLayout.force(forceName); // Force getter\n      }\n\n      state.forceLayout.force(forceName, forceFn); // Force setter\n\n      return this;\n    },\n    d3ReheatSimulation: function d3ReheatSimulation(state) {\n      state.forceLayout.alpha(1);\n      this.resetCountdown();\n      return this;\n    },\n    // reset cooldown state\n    resetCountdown: function resetCountdown(state) {\n      state.cntTicks = 0;\n      state.startTickTime = new Date();\n      state.engineRunning = true;\n      return this;\n    },\n    tickFrame: function tickFrame(state) {\n      !state.isShadow && layoutTick();\n      paintLinks();\n      !state.isShadow && paintArrows();\n      !state.isShadow && paintPhotons();\n      paintNodes();\n      return this; //\n\n      function layoutTick() {\n        if (state.engineRunning) {\n          if (++state.cntTicks > state.cooldownTicks || new Date() - state.startTickTime > state.cooldownTime || state.d3AlphaMin > 0 && state.forceLayout.alpha() < state.d3AlphaMin) {\n            state.engineRunning = false; // Stop ticking graph\n\n            state.onEngineStop();\n          } else {\n            state.forceLayout.tick(); // Tick it\n\n            state.onEngineTick();\n          }\n        }\n      }\n\n      function paintNodes() {\n        var getVisibility = accessorFn(state.nodeVisibility);\n        var getVal = accessorFn(state.nodeVal);\n        var getColor = accessorFn(state.nodeColor);\n        var getNodeCanvasObjectMode = accessorFn(state.nodeCanvasObjectMode);\n        var ctx = state.ctx; // Draw wider nodes by 1px on shadow canvas for more precise hovering (due to boundary anti-aliasing)\n\n        var padAmount = state.isShadow / state.globalScale;\n        var visibleNodes = state.graphData.nodes.filter(getVisibility);\n        ctx.save();\n        visibleNodes.forEach(function (node) {\n          var nodeCanvasObjectMode = getNodeCanvasObjectMode(node);\n\n          if (state.nodeCanvasObject && (nodeCanvasObjectMode === 'before' || nodeCanvasObjectMode === 'replace')) {\n            // Custom node before/replace paint\n            state.nodeCanvasObject(node, ctx, state.globalScale, state.isShadow);\n\n            if (nodeCanvasObjectMode === 'replace') {\n              ctx.restore();\n              return;\n            }\n          } // Draw wider nodes by 1px on shadow canvas for more precise hovering (due to boundary anti-aliasing)\n\n\n          var r = Math.sqrt(Math.max(0, getVal(node) || 1)) * state.nodeRelSize + padAmount;\n          ctx.beginPath();\n          ctx.arc(node.x, node.y, r, 0, 2 * Math.PI, false);\n          ctx.fillStyle = getColor(node) || 'rgba(31, 120, 180, 0.92)';\n          ctx.fill();\n\n          if (state.nodeCanvasObject && nodeCanvasObjectMode === 'after') {\n            // Custom node after paint\n            state.nodeCanvasObject(node, state.ctx, state.globalScale);\n          }\n        });\n        ctx.restore();\n      }\n\n      function paintLinks() {\n        var getVisibility = accessorFn(state.linkVisibility);\n        var getColor = accessorFn(state.linkColor);\n        var getWidth = accessorFn(state.linkWidth);\n        var getLineDash = accessorFn(state.linkLineDash);\n        var getCurvature = accessorFn(state.linkCurvature);\n        var getLinkCanvasObjectMode = accessorFn(state.linkCanvasObjectMode);\n        var ctx = state.ctx; // Draw wider lines by 2px on shadow canvas for more precise hovering (due to boundary anti-aliasing)\n\n        var padAmount = state.isShadow * 2;\n        var visibleLinks = state.graphData.links.filter(getVisibility);\n        visibleLinks.forEach(calcLinkControlPoints); // calculate curvature control points for all visible links\n\n        var beforeCustomLinks = [],\n            afterCustomLinks = [],\n            defaultPaintLinks = visibleLinks;\n\n        if (state.linkCanvasObject) {\n          var replaceCustomLinks = [],\n              otherCustomLinks = [];\n          visibleLinks.forEach(function (d) {\n            return ({\n              before: beforeCustomLinks,\n              after: afterCustomLinks,\n              replace: replaceCustomLinks\n            }[getLinkCanvasObjectMode(d)] || otherCustomLinks).push(d);\n          });\n          defaultPaintLinks = [].concat(_toConsumableArray(beforeCustomLinks), afterCustomLinks, otherCustomLinks);\n          beforeCustomLinks = beforeCustomLinks.concat(replaceCustomLinks);\n        } // Custom link before paints\n\n\n        ctx.save();\n        beforeCustomLinks.forEach(function (link) {\n          return state.linkCanvasObject(link, ctx, state.globalScale);\n        });\n        ctx.restore(); // Bundle strokes per unique color/width/dash for performance optimization\n\n        var linksPerColor = indexBy(defaultPaintLinks, [getColor, getWidth, getLineDash]);\n        ctx.save();\n        Object.entries(linksPerColor).forEach(function (_ref) {\n          var _ref2 = _slicedToArray(_ref, 2),\n              color = _ref2[0],\n              linksPerWidth = _ref2[1];\n\n          var lineColor = !color || color === 'undefined' ? 'rgba(0,0,0,0.15)' : color;\n          Object.entries(linksPerWidth).forEach(function (_ref3) {\n            var _ref4 = _slicedToArray(_ref3, 2),\n                width = _ref4[0],\n                linesPerLineDash = _ref4[1];\n\n            var lineWidth = (width || 1) / state.globalScale + padAmount;\n            Object.entries(linesPerLineDash).forEach(function (_ref5) {\n              var _ref6 = _slicedToArray(_ref5, 2),\n                  dashSegments = _ref6[0],\n                  links = _ref6[1];\n\n              var lineDashSegments = getLineDash(links[0]);\n              ctx.beginPath();\n              links.forEach(function (link) {\n                var start = link.source;\n                var end = link.target;\n                if (!start || !end || !start.hasOwnProperty('x') || !end.hasOwnProperty('x')) return; // skip invalid link\n\n                ctx.moveTo(start.x, start.y);\n                var controlPoints = link.__controlPoints;\n\n                if (!controlPoints) {\n                  // Straight line\n                  ctx.lineTo(end.x, end.y);\n                } else {\n                  // Use quadratic curves for regular lines and bezier for loops\n                  ctx[controlPoints.length === 2 ? 'quadraticCurveTo' : 'bezierCurveTo'].apply(ctx, _toConsumableArray(controlPoints).concat([end.x, end.y]));\n                }\n              });\n              ctx.strokeStyle = lineColor;\n              ctx.lineWidth = lineWidth;\n              ctx.setLineDash(lineDashSegments || []);\n              ctx.stroke();\n            });\n          });\n        });\n        ctx.restore(); // Custom link after paints\n\n        ctx.save();\n        afterCustomLinks.forEach(function (link) {\n          return state.linkCanvasObject(link, ctx, state.globalScale);\n        });\n        ctx.restore(); //\n\n        function calcLinkControlPoints(link) {\n          var curvature = getCurvature(link);\n\n          if (!curvature) {\n            // straight line\n            link.__controlPoints = null;\n            return;\n          }\n\n          var start = link.source;\n          var end = link.target;\n          if (!start || !end || !start.hasOwnProperty('x') || !end.hasOwnProperty('x')) return; // skip invalid link\n\n          var l = Math.sqrt(Math.pow(end.x - start.x, 2) + Math.pow(end.y - start.y, 2)); // line length\n\n          if (l > 0) {\n            var a = Math.atan2(end.y - start.y, end.x - start.x); // line angle\n\n            var d = l * curvature; // control point distance\n\n            var cp = {\n              // control point\n              x: (start.x + end.x) / 2 + d * Math.cos(a - Math.PI / 2),\n              y: (start.y + end.y) / 2 + d * Math.sin(a - Math.PI / 2)\n            };\n            link.__controlPoints = [cp.x, cp.y];\n          } else {\n            // Same point, draw a loop\n            var _d = curvature * 70;\n\n            link.__controlPoints = [end.x, end.y - _d, end.x + _d, end.y];\n          }\n        }\n      }\n\n      function paintArrows() {\n        var ARROW_WH_RATIO = 1.6;\n        var ARROW_VLEN_RATIO = 0.2;\n        var getLength = accessorFn(state.linkDirectionalArrowLength);\n        var getRelPos = accessorFn(state.linkDirectionalArrowRelPos);\n        var getVisibility = accessorFn(state.linkVisibility);\n        var getColor = accessorFn(state.linkDirectionalArrowColor || state.linkColor);\n        var getNodeVal = accessorFn(state.nodeVal);\n        var ctx = state.ctx;\n        ctx.save();\n        state.graphData.links.filter(getVisibility).forEach(function (link) {\n          var arrowLength = getLength(link);\n          if (!arrowLength || arrowLength < 0) return;\n          var start = link.source;\n          var end = link.target;\n          if (!start || !end || !start.hasOwnProperty('x') || !end.hasOwnProperty('x')) return; // skip invalid link\n\n          var startR = Math.sqrt(Math.max(0, getNodeVal(start) || 1)) * state.nodeRelSize;\n          var endR = Math.sqrt(Math.max(0, getNodeVal(end) || 1)) * state.nodeRelSize;\n          var arrowRelPos = Math.min(1, Math.max(0, getRelPos(link)));\n          var arrowColor = getColor(link) || 'rgba(0,0,0,0.28)';\n          var arrowHalfWidth = arrowLength / ARROW_WH_RATIO / 2; // Construct bezier for curved lines\n\n          var bzLine = link.__controlPoints && _construct(Bezier, [start.x, start.y].concat(_toConsumableArray(link.__controlPoints), [end.x, end.y]));\n\n          var getCoordsAlongLine = bzLine ? function (t) {\n            return bzLine.get(t);\n          } // get position along bezier line\n          : function (t) {\n            return {\n              // straight line: interpolate linearly\n              x: start.x + (end.x - start.x) * t || 0,\n              y: start.y + (end.y - start.y) * t || 0\n            };\n          };\n          var lineLen = bzLine ? bzLine.length() : Math.sqrt(Math.pow(end.x - start.x, 2) + Math.pow(end.y - start.y, 2));\n          var posAlongLine = startR + arrowLength + (lineLen - startR - endR - arrowLength) * arrowRelPos;\n          var arrowHead = getCoordsAlongLine(posAlongLine / lineLen);\n          var arrowTail = getCoordsAlongLine((posAlongLine - arrowLength) / lineLen);\n          var arrowTailVertex = getCoordsAlongLine((posAlongLine - arrowLength * (1 - ARROW_VLEN_RATIO)) / lineLen);\n          var arrowTailAngle = Math.atan2(arrowHead.y - arrowTail.y, arrowHead.x - arrowTail.x) - Math.PI / 2;\n          ctx.beginPath();\n          ctx.moveTo(arrowHead.x, arrowHead.y);\n          ctx.lineTo(arrowTail.x + arrowHalfWidth * Math.cos(arrowTailAngle), arrowTail.y + arrowHalfWidth * Math.sin(arrowTailAngle));\n          ctx.lineTo(arrowTailVertex.x, arrowTailVertex.y);\n          ctx.lineTo(arrowTail.x - arrowHalfWidth * Math.cos(arrowTailAngle), arrowTail.y - arrowHalfWidth * Math.sin(arrowTailAngle));\n          ctx.fillStyle = arrowColor;\n          ctx.fill();\n        });\n        ctx.restore();\n      }\n\n      function paintPhotons() {\n        var getNumPhotons = accessorFn(state.linkDirectionalParticles);\n        var getSpeed = accessorFn(state.linkDirectionalParticleSpeed);\n        var getDiameter = accessorFn(state.linkDirectionalParticleWidth);\n        var getVisibility = accessorFn(state.linkVisibility);\n        var getColor = accessorFn(state.linkDirectionalParticleColor || state.linkColor);\n        var ctx = state.ctx;\n        ctx.save();\n        state.graphData.links.filter(getVisibility).forEach(function (link) {\n          var numCyclePhotons = getNumPhotons(link);\n          if (!link.hasOwnProperty('__photons') || !link.__photons.length) return;\n          var start = link.source;\n          var end = link.target;\n          if (!start || !end || !start.hasOwnProperty('x') || !end.hasOwnProperty('x')) return; // skip invalid link\n\n          var particleSpeed = getSpeed(link);\n          var photons = link.__photons || [];\n          var photonR = Math.max(0, getDiameter(link) / 2) / Math.sqrt(state.globalScale);\n          var photonColor = getColor(link) || 'rgba(0,0,0,0.28)';\n          ctx.fillStyle = photonColor; // Construct bezier for curved lines\n\n          var bzLine = link.__controlPoints ? _construct(Bezier, [start.x, start.y].concat(_toConsumableArray(link.__controlPoints), [end.x, end.y])) : null;\n          var cyclePhotonIdx = 0;\n          var needsCleanup = false; // whether some photons need to be removed from list\n\n          photons.forEach(function (photon) {\n            var singleHop = !!photon.__singleHop;\n\n            if (!photon.hasOwnProperty('__progressRatio')) {\n              photon.__progressRatio = singleHop ? 0 : cyclePhotonIdx / numCyclePhotons;\n            }\n\n            !singleHop && cyclePhotonIdx++; // increase regular photon index\n\n            photon.__progressRatio += particleSpeed;\n\n            if (photon.__progressRatio >= 1) {\n              if (!singleHop) {\n                photon.__progressRatio = photon.__progressRatio % 1;\n              } else {\n                needsCleanup = true;\n                return;\n              }\n            }\n\n            var photonPosRatio = photon.__progressRatio;\n            var coords = bzLine ? bzLine.get(photonPosRatio) // get position along bezier line\n            : {\n              // straight line: interpolate linearly\n              x: start.x + (end.x - start.x) * photonPosRatio || 0,\n              y: start.y + (end.y - start.y) * photonPosRatio || 0\n            };\n            ctx.beginPath();\n            ctx.arc(coords.x, coords.y, photonR, 0, 2 * Math.PI, false);\n            ctx.fill();\n          });\n\n          if (needsCleanup) {\n            // remove expired single hop photons\n            link.__photons = link.__photons.filter(function (photon) {\n              return !photon.__singleHop || photon.__progressRatio <= 1;\n            });\n          }\n        });\n        ctx.restore();\n      }\n    },\n    emitParticle: function emitParticle(state, link) {\n      if (link) {\n        !link.__photons && (link.__photons = []);\n\n        link.__photons.push({\n          __singleHop: true\n        }); // add a single hop particle\n\n      }\n\n      return this;\n    }\n  },\n  stateInit: function stateInit() {\n    return {\n      forceLayout: forceSimulation().force('link', forceLink()).force('charge', forceManyBody()).force('center', forceCenter()).force('dagRadial', null).stop(),\n      engineRunning: false\n    };\n  },\n  init: function init(canvasCtx, state) {\n    // Main canvas object to manipulate\n    state.ctx = canvasCtx;\n  },\n  update: function update(state) {\n    state.engineRunning = false; // Pause simulation\n\n    state.onUpdate();\n\n    if (state.nodeAutoColorBy !== null) {\n      // Auto add color to uncolored nodes\n      autoColorObjects(state.graphData.nodes, accessorFn(state.nodeAutoColorBy), state.nodeColor);\n    }\n\n    if (state.linkAutoColorBy !== null) {\n      // Auto add color to uncolored links\n      autoColorObjects(state.graphData.links, accessorFn(state.linkAutoColorBy), state.linkColor);\n    } // parse links\n\n\n    state.graphData.links.forEach(function (link) {\n      link.source = link[state.linkSource];\n      link.target = link[state.linkTarget];\n    });\n\n    if (!state.isShadow) {\n      // Add photon particles\n      var linkParticlesAccessor = accessorFn(state.linkDirectionalParticles);\n      state.graphData.links.forEach(function (link) {\n        var numPhotons = Math.round(Math.abs(linkParticlesAccessor(link)));\n\n        if (numPhotons) {\n          link.__photons = _toConsumableArray(Array(numPhotons)).map(function () {\n            return {};\n          });\n        } else {\n          delete link.__photons;\n        }\n      });\n    } // Feed data to force-directed layout\n\n\n    state.forceLayout.stop().alpha(1) // re-heat the simulation\n    .nodes(state.graphData.nodes); // add links (if link force is still active)\n\n    var linkForce = state.forceLayout.force('link');\n\n    if (linkForce) {\n      linkForce.id(function (d) {\n        return d[state.nodeId];\n      }).links(state.graphData.links);\n    } // setup dag force constraints\n\n\n    var nodeDepths = state.dagMode && getDagDepths(state.graphData, function (node) {\n      return node[state.nodeId];\n    }, {\n      nodeFilter: state.dagNodeFilter,\n      onLoopError: state.onDagError || undefined\n    });\n    var maxDepth = Math.max.apply(Math, _toConsumableArray(Object.values(nodeDepths || [])));\n    var dagLevelDistance = state.dagLevelDistance || state.graphData.nodes.length / (maxDepth || 1) * DAG_LEVEL_NODE_RATIO * (['radialin', 'radialout'].indexOf(state.dagMode) !== -1 ? 0.7 : 1); // Fix nodes to x,y for dag mode\n\n    if (state.dagMode) {\n      var getFFn = function getFFn(fix, invert) {\n        return function (node) {\n          return !fix ? undefined : (nodeDepths[node[state.nodeId]] - maxDepth / 2) * dagLevelDistance * (invert ? -1 : 1);\n        };\n      };\n\n      var fxFn = getFFn(['lr', 'rl'].indexOf(state.dagMode) !== -1, state.dagMode === 'rl');\n      var fyFn = getFFn(['td', 'bu'].indexOf(state.dagMode) !== -1, state.dagMode === 'bu');\n      state.graphData.nodes.filter(state.dagNodeFilter).forEach(function (node) {\n        node.fx = fxFn(node);\n        node.fy = fyFn(node);\n      });\n    } // Use radial force for radial dags\n\n\n    state.forceLayout.force('dagRadial', ['radialin', 'radialout'].indexOf(state.dagMode) !== -1 ? forceRadial(function (node) {\n      var nodeDepth = nodeDepths[node[state.nodeId]] || -1;\n      return (state.dagMode === 'radialin' ? maxDepth - nodeDepth : nodeDepth) * dagLevelDistance;\n    }).strength(function (node) {\n      return state.dagNodeFilter(node) ? 1 : 0;\n    }) : null);\n\n    for (var i = 0; i < state.warmupTicks && !(state.d3AlphaMin > 0 && state.forceLayout.alpha() < state.d3AlphaMin); i++) {\n      state.forceLayout.tick();\n    } // Initial ticks before starting to render\n\n\n    this.resetCountdown();\n    state.onFinishUpdate();\n  }\n});\n\nfunction linkKapsule (kapsulePropNames, kapsuleType) {\n  var propNames = kapsulePropNames instanceof Array ? kapsulePropNames : [kapsulePropNames];\n  var dummyK = new kapsuleType(); // To extract defaults\n\n  return {\n    linkProp: function linkProp(prop) {\n      // link property config\n      return {\n        \"default\": dummyK[prop](),\n        onChange: function onChange(v, state) {\n          propNames.forEach(function (propName) {\n            return state[propName][prop](v);\n          });\n        },\n        triggerUpdate: false\n      };\n    },\n    linkMethod: function linkMethod(method) {\n      // link method pass-through\n      return function (state) {\n        for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n          args[_key - 1] = arguments[_key];\n        }\n\n        var returnVals = [];\n        propNames.forEach(function (propName) {\n          var kapsuleInstance = state[propName];\n          var returnVal = kapsuleInstance[method].apply(kapsuleInstance, args);\n\n          if (returnVal !== kapsuleInstance) {\n            returnVals.push(returnVal);\n          }\n        });\n        return returnVals.length ? returnVals[0] : this; // chain based on the parent object, not the inner kapsule\n      };\n    }\n  };\n}\n\nvar HOVER_CANVAS_THROTTLE_DELAY = 800; // ms to throttle shadow canvas updates for perf improvement\n\nvar ZOOM2NODES_FACTOR = 4; // Expose config from forceGraph\n\nvar bindFG = linkKapsule('forceGraph', CanvasForceGraph);\nvar bindBoth = linkKapsule(['forceGraph', 'shadowGraph'], CanvasForceGraph);\nvar linkedProps = Object.assign.apply(Object, _toConsumableArray(['nodeColor', 'nodeAutoColorBy', 'nodeCanvasObject', 'nodeCanvasObjectMode', 'linkColor', 'linkAutoColorBy', 'linkLineDash', 'linkWidth', 'linkCanvasObject', 'linkCanvasObjectMode', 'linkDirectionalArrowLength', 'linkDirectionalArrowColor', 'linkDirectionalArrowRelPos', 'linkDirectionalParticles', 'linkDirectionalParticleSpeed', 'linkDirectionalParticleWidth', 'linkDirectionalParticleColor', 'dagMode', 'dagLevelDistance', 'dagNodeFilter', 'onDagError', 'd3AlphaMin', 'd3AlphaDecay', 'd3VelocityDecay', 'warmupTicks', 'cooldownTicks', 'cooldownTime', 'onEngineTick', 'onEngineStop'].map(function (p) {\n  return _defineProperty({}, p, bindFG.linkProp(p));\n})).concat(_toConsumableArray(['nodeRelSize', 'nodeId', 'nodeVal', 'nodeVisibility', 'linkSource', 'linkTarget', 'linkVisibility', 'linkCurvature'].map(function (p) {\n  return _defineProperty({}, p, bindBoth.linkProp(p));\n}))));\nvar linkedMethods = Object.assign.apply(Object, _toConsumableArray(['d3Force', 'd3ReheatSimulation', 'emitParticle'].map(function (p) {\n  return _defineProperty({}, p, bindFG.linkMethod(p));\n})));\n\nfunction adjustCanvasSize(state) {\n  if (state.canvas) {\n    var curWidth = state.canvas.width;\n    var curHeight = state.canvas.height;\n\n    if (curWidth === 300 && curHeight === 150) {\n      // Default canvas dimensions\n      curWidth = curHeight = 0;\n    }\n\n    var pxScale = window.devicePixelRatio; // 2 on retina displays\n\n    curWidth /= pxScale;\n    curHeight /= pxScale; // Resize canvases\n\n    [state.canvas, state.shadowCanvas].forEach(function (canvas) {\n      // Element size\n      canvas.style.width = \"\".concat(state.width, \"px\");\n      canvas.style.height = \"\".concat(state.height, \"px\"); // Memory size (scaled to avoid blurriness)\n\n      canvas.width = state.width * pxScale;\n      canvas.height = state.height * pxScale; // Normalize coordinate system to use css pixels (on init only)\n\n      if (!curWidth && !curHeight) {\n        canvas.getContext('2d').scale(pxScale, pxScale);\n      }\n    }); // Relative center panning based on 0,0\n\n    var k = zoomTransform(state.canvas).k;\n    state.zoom.translateBy(state.zoom.__baseElem, (state.width - curWidth) / 2 / k, (state.height - curHeight) / 2 / k);\n  }\n}\n\nfunction resetTransform(ctx) {\n  var pxRatio = window.devicePixelRatio;\n  ctx.setTransform(pxRatio, 0, 0, pxRatio, 0, 0);\n}\n\nfunction clearCanvas(ctx, width, height) {\n  ctx.save();\n  resetTransform(ctx); // reset transform\n\n  ctx.clearRect(0, 0, width, height);\n  ctx.restore(); //restore transforms\n} //\n\n\nvar forceGraph = Kapsule({\n  props: _objectSpread2({\n    width: {\n      \"default\": window.innerWidth,\n      onChange: function onChange(_, state) {\n        return adjustCanvasSize(state);\n      },\n      triggerUpdate: false\n    },\n    height: {\n      \"default\": window.innerHeight,\n      onChange: function onChange(_, state) {\n        return adjustCanvasSize(state);\n      },\n      triggerUpdate: false\n    },\n    graphData: {\n      \"default\": {\n        nodes: [],\n        links: []\n      },\n      onChange: function onChange(d, state) {\n        if (d.nodes.length || d.links.length) {\n          console.info('force-graph loading', d.nodes.length + ' nodes', d.links.length + ' links');\n        }\n\n        [{\n          type: 'Node',\n          objs: d.nodes\n        }, {\n          type: 'Link',\n          objs: d.links\n        }].forEach(hexIndex);\n        state.forceGraph.graphData(d);\n        state.shadowGraph.graphData(d);\n\n        function hexIndex(_ref4) {\n          var type = _ref4.type,\n              objs = _ref4.objs;\n          objs.filter(function (d) {\n            if (!d.hasOwnProperty('__indexColor')) return true;\n            var cur = state.colorTracker.lookup(d.__indexColor);\n            return !cur || !cur.hasOwnProperty('d') || cur.d !== d;\n          }).forEach(function (d) {\n            // store object lookup color\n            d.__indexColor = state.colorTracker.register({\n              type: type,\n              d: d\n            });\n          });\n        }\n      },\n      triggerUpdate: false\n    },\n    backgroundColor: {\n      onChange: function onChange(color, state) {\n        state.canvas && color && (state.canvas.style.background = color);\n      },\n      triggerUpdate: false\n    },\n    nodeLabel: {\n      \"default\": 'name',\n      triggerUpdate: false\n    },\n    linkLabel: {\n      \"default\": 'name',\n      triggerUpdate: false\n    },\n    linkHoverPrecision: {\n      \"default\": 4,\n      triggerUpdate: false\n    },\n    enableNodeDrag: {\n      \"default\": true,\n      triggerUpdate: false\n    },\n    enableZoomPanInteraction: {\n      \"default\": true,\n      triggerUpdate: false\n    },\n    enablePointerInteraction: {\n      \"default\": true,\n      onChange: function onChange(_, state) {\n        state.hoverObj = null;\n      },\n      triggerUpdate: false\n    },\n    onNodeDrag: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onNodeDragEnd: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onNodeClick: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onNodeRightClick: {\n      triggerUpdate: false\n    },\n    onNodeHover: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onLinkClick: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onLinkRightClick: {\n      triggerUpdate: false\n    },\n    onLinkHover: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onBackgroundClick: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onBackgroundRightClick: {\n      triggerUpdate: false\n    },\n    onZoom: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onZoomEnd: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onRenderFramePre: {\n      triggerUpdate: false\n    },\n    onRenderFramePost: {\n      triggerUpdate: false\n    }\n  }, linkedProps),\n  aliases: {\n    // Prop names supported for backwards compatibility\n    stopAnimation: 'pauseAnimation'\n  },\n  methods: _objectSpread2({\n    graph2ScreenCoords: function graph2ScreenCoords(state, x, y) {\n      var t = zoomTransform(state.canvas);\n      return {\n        x: x * t.k + t.x,\n        y: y * t.k + t.y\n      };\n    },\n    screen2GraphCoords: function screen2GraphCoords(state, x, y) {\n      var t = zoomTransform(state.canvas);\n      return {\n        x: (x - t.x) / t.k,\n        y: (y - t.y) / t.k\n      };\n    },\n    centerAt: function centerAt(state, x, y, transitionDuration) {\n      if (!state.canvas) return null; // no canvas yet\n      // setter\n\n      if (x !== undefined || y !== undefined) {\n        var finalPos = Object.assign({}, x !== undefined ? {\n          x: x\n        } : {}, y !== undefined ? {\n          y: y\n        } : {});\n\n        if (!transitionDuration) {\n          // no animation\n          setCenter(finalPos);\n        } else {\n          new TWEEN.Tween(getCenter()).to(finalPos, transitionDuration).easing(TWEEN.Easing.Quadratic.Out).onUpdate(setCenter).start();\n        }\n\n        return this;\n      } // getter\n\n\n      return getCenter(); //\n\n      function getCenter() {\n        var t = zoomTransform(state.canvas);\n        return {\n          x: (state.width / 2 - t.x) / t.k,\n          y: (state.height / 2 - t.y) / t.k\n        };\n      }\n\n      function setCenter(_ref5) {\n        var x = _ref5.x,\n            y = _ref5.y;\n        state.zoom.translateTo(state.zoom.__baseElem, x === undefined ? getCenter().x : x, y === undefined ? getCenter().y : y);\n      }\n    },\n    zoom: function zoom(state, k, transitionDuration) {\n      if (!state.canvas) return null; // no canvas yet\n      // setter\n\n      if (k !== undefined) {\n        if (!transitionDuration) {\n          // no animation\n          setZoom(k);\n        } else {\n          new TWEEN.Tween({\n            k: getZoom()\n          }).to({\n            k: k\n          }, transitionDuration).easing(TWEEN.Easing.Quadratic.Out).onUpdate(function (_ref6) {\n            var k = _ref6.k;\n            return setZoom(k);\n          }).start();\n        }\n\n        return this;\n      } // getter\n\n\n      return getZoom(); //\n\n      function getZoom() {\n        return zoomTransform(state.canvas).k;\n      }\n\n      function setZoom(k) {\n        state.zoom.scaleTo(state.zoom.__baseElem, k);\n      }\n    },\n    zoomToFit: function zoomToFit(state) {\n      var transitionDuration = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n      var padding = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 10;\n\n      for (var _len = arguments.length, bboxArgs = new Array(_len > 3 ? _len - 3 : 0), _key = 3; _key < _len; _key++) {\n        bboxArgs[_key - 3] = arguments[_key];\n      }\n\n      var bbox = this.getGraphBbox.apply(this, bboxArgs);\n\n      if (bbox) {\n        var center = {\n          x: (bbox.x[0] + bbox.x[1]) / 2,\n          y: (bbox.y[0] + bbox.y[1]) / 2\n        };\n        var zoomK = Math.max(1e-12, Math.min(1e12, (state.width - padding * 2) / (bbox.x[1] - bbox.x[0]), (state.height - padding * 2) / (bbox.y[1] - bbox.y[0])));\n        this.centerAt(center.x, center.y, transitionDuration);\n        this.zoom(zoomK, transitionDuration);\n      }\n\n      return this;\n    },\n    getGraphBbox: function getGraphBbox(state) {\n      var nodeFilter = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : function () {\n        return true;\n      };\n      var getVal = accessorFn(state.nodeVal);\n\n      var getR = function getR(node) {\n        return Math.sqrt(Math.max(0, getVal(node) || 1)) * state.nodeRelSize;\n      };\n\n      var nodesPos = state.graphData.nodes.filter(nodeFilter).map(function (node) {\n        return {\n          x: node.x,\n          y: node.y,\n          r: getR(node)\n        };\n      });\n      return !nodesPos.length ? null : {\n        x: [min(nodesPos, function (node) {\n          return node.x - node.r;\n        }), max(nodesPos, function (node) {\n          return node.x + node.r;\n        })],\n        y: [min(nodesPos, function (node) {\n          return node.y - node.r;\n        }), max(nodesPos, function (node) {\n          return node.y + node.r;\n        })]\n      };\n    },\n    pauseAnimation: function pauseAnimation(state) {\n      if (state.animationFrameRequestId) {\n        cancelAnimationFrame(state.animationFrameRequestId);\n        state.animationFrameRequestId = null;\n      }\n\n      return this;\n    },\n    resumeAnimation: function resumeAnimation(state) {\n      if (!state.animationFrameRequestId) {\n        this._animationCycle();\n      }\n\n      return this;\n    },\n    _destructor: function _destructor() {\n      this.pauseAnimation();\n      this.graphData({\n        nodes: [],\n        links: []\n      });\n    }\n  }, linkedMethods),\n  stateInit: function stateInit() {\n    return {\n      lastSetZoom: 1,\n      forceGraph: new CanvasForceGraph(),\n      shadowGraph: new CanvasForceGraph().cooldownTicks(0).nodeColor('__indexColor').linkColor('__indexColor').isShadow(true),\n      colorTracker: new ColorTracker() // indexed objects for rgb lookup\n\n    };\n  },\n  init: function init(domNode, state) {\n    // Wipe DOM\n    domNode.innerHTML = ''; // Container anchor for canvas and tooltip\n\n    var container = document.createElement('div');\n    container.classList.add('force-graph-container');\n    container.style.position = 'relative';\n    domNode.appendChild(container);\n    state.canvas = document.createElement('canvas');\n    if (state.backgroundColor) state.canvas.style.background = state.backgroundColor;\n    container.appendChild(state.canvas);\n    state.shadowCanvas = document.createElement('canvas'); // Show shadow canvas\n    //state.shadowCanvas.style.position = 'absolute';\n    //state.shadowCanvas.style.top = '0';\n    //state.shadowCanvas.style.left = '0';\n    //container.appendChild(state.shadowCanvas);\n\n    var ctx = state.canvas.getContext('2d');\n    var shadowCtx = state.shadowCanvas.getContext('2d'); // Setup node drag interaction\n\n    select(state.canvas).call(drag().subject(function () {\n      if (!state.enableNodeDrag) {\n        return null;\n      }\n\n      var obj = state.hoverObj;\n      return obj && obj.type === 'Node' ? obj.d : null; // Only drag nodes\n    }).on('start', function (ev) {\n      var obj = ev.subject;\n      obj.__initialDragPos = {\n        x: obj.x,\n        y: obj.y,\n        fx: obj.fx,\n        fy: obj.fy\n      }; // keep engine running at low intensity throughout drag\n\n      if (!ev.active) {\n        obj.fx = obj.x;\n        obj.fy = obj.y; // Fix points\n      } // drag cursor\n\n\n      state.canvas.classList.add('grabbable');\n    }).on('drag', function (ev) {\n      var obj = ev.subject;\n      var initPos = obj.__initialDragPos;\n      var dragPos = ev;\n      var k = zoomTransform(state.canvas).k;\n      var translate = {\n        x: initPos.x + (dragPos.x - initPos.x) / k - obj.x,\n        y: initPos.y + (dragPos.y - initPos.y) / k - obj.y\n      }; // Move fx/fy (and x/y) of nodes based on the scaled drag distance since the drag start\n\n      ['x', 'y'].forEach(function (c) {\n        return obj[\"f\".concat(c)] = obj[c] = initPos[c] + (dragPos[c] - initPos[c]) / k;\n      }); // prevent freeze while dragging\n\n      state.forceGraph.d3AlphaTarget(0.3) // keep engine running at low intensity throughout drag\n      .resetCountdown(); // prevent freeze while dragging\n\n      obj.__dragged = true;\n      state.onNodeDrag(obj, translate);\n    }).on('end', function (ev) {\n      var obj = ev.subject;\n      var initPos = obj.__initialDragPos;\n      var translate = {\n        x: obj.x - initPos.x,\n        y: obj.y - initPos.y\n      };\n\n      if (initPos.fx === undefined) {\n        obj.fx = undefined;\n      }\n\n      if (initPos.fy === undefined) {\n        obj.fy = undefined;\n      }\n\n      delete obj.__initialDragPos;\n      state.forceGraph.d3AlphaTarget(0) // release engine low intensity\n      .resetCountdown(); // let the engine readjust after releasing fixed nodes\n      // drag cursor\n\n      state.canvas.classList.remove('grabbable');\n\n      if (obj.__dragged) {\n        delete obj.__dragged;\n        state.onNodeDragEnd(obj, translate);\n      }\n    })); // Setup zoom / pan interaction\n\n    state.zoom = zoom();\n    state.zoom(state.zoom.__baseElem = select(state.canvas)); // Attach controlling elem for easy access\n\n    state.zoom.__baseElem.on('dblclick.zoom', null); // Disable double-click to zoom\n\n\n    state.zoom.filter(function (ev) {\n      return state.enableZoomPanInteraction ? !ev.button : false;\n    }) // disable zoom interaction\n    .scaleExtent([0.01, 1000]).on('zoom', function () {\n      var t = zoomTransform(this); // Same as d3.event.transform\n\n      [ctx, shadowCtx].forEach(function (c) {\n        resetTransform(c);\n        c.translate(t.x, t.y);\n        c.scale(t.k, t.k);\n      });\n      state.onZoom(_objectSpread2({}, t));\n    }).on('end', function () {\n      var t = zoomTransform(this); // Same as d3.event.transform\n\n      state.onZoomEnd(_objectSpread2({}, t));\n    });\n    adjustCanvasSize(state);\n    state.forceGraph.onFinishUpdate(function () {\n      // re-zoom, if still in default position (not user modified)\n      if (zoomTransform(state.canvas).k === state.lastSetZoom && state.graphData.nodes.length) {\n        state.zoom.scaleTo(state.zoom.__baseElem, state.lastSetZoom = ZOOM2NODES_FACTOR / Math.cbrt(state.graphData.nodes.length));\n      }\n    }); // Setup tooltip\n\n    var toolTipElem = document.createElement('div');\n    toolTipElem.classList.add('graph-tooltip');\n    container.appendChild(toolTipElem); // Capture pointer coords on move or touchstart\n\n    var pointerPos = {\n      x: -1e12,\n      y: -1e12\n    };\n    ['pointermove', 'pointerdown'].forEach(function (evType) {\n      return container.addEventListener(evType, function (ev) {\n        // detect point drag\n        !state.isPointerDragging && ev.type === 'pointermove' && ev.pressure > 0 && [ev.movementX, ev.movementY].some(function (m) {\n          return Math.abs(m) > (ev.pointerType === 'touch' ? 1 : 0);\n        }) // relax drag trigger sensitivity on touch events\n        && (state.isPointerDragging = true); // update the pointer pos\n\n        var offset = getOffset(container);\n        pointerPos.x = ev.pageX - offset.left;\n        pointerPos.y = ev.pageY - offset.top; // Move tooltip\n\n        toolTipElem.style.top = \"\".concat(pointerPos.y, \"px\");\n        toolTipElem.style.left = \"\".concat(pointerPos.x, \"px\"); //\n\n        function getOffset(el) {\n          var rect = el.getBoundingClientRect(),\n              scrollLeft = window.pageXOffset || document.documentElement.scrollLeft,\n              scrollTop = window.pageYOffset || document.documentElement.scrollTop;\n          return {\n            top: rect.top + scrollTop,\n            left: rect.left + scrollLeft\n          };\n        }\n      }, {\n        passive: true\n      });\n    }); // Handle click/touch events on nodes/links\n\n    container.addEventListener('pointerup', function (ev) {\n      if (state.isPointerDragging) {\n        state.isPointerDragging = false;\n        return; // don't trigger click events after pointer drag (pan / node drag functionality)\n      }\n\n      requestAnimationFrame(function () {\n        // trigger click events asynchronously, to allow hoverObj to be set (on frame)\n        if (ev.button === 0) {\n          // mouse left-click or touch\n          if (state.hoverObj) {\n            state[\"on\".concat(state.hoverObj.type, \"Click\")](state.hoverObj.d, ev);\n          } else {\n            state.onBackgroundClick(ev);\n          }\n        }\n\n        if (ev.button === 2) {\n          // mouse right-click\n          if (state.hoverObj) {\n            var fn = state[\"on\".concat(state.hoverObj.type, \"RightClick\")];\n            fn && fn(state.hoverObj.d, ev);\n          } else {\n            state.onBackgroundRightClick && state.onBackgroundRightClick(ev);\n          }\n        }\n      });\n    }, {\n      passive: true\n    });\n    container.addEventListener('contextmenu', function (ev) {\n      if (!state.onBackgroundRightClick && !state.onNodeRightClick && !state.onLinkRightClick) return true; // default contextmenu behavior\n\n      ev.preventDefault();\n      return false;\n    });\n    state.forceGraph(ctx);\n    state.shadowGraph(shadowCtx); //\n\n    var refreshShadowCanvas = throttle(function () {\n      // wipe canvas\n      clearCanvas(shadowCtx, state.width, state.height); // Adjust link hover area\n\n      state.shadowGraph.linkWidth(function (l) {\n        return accessorFn(state.linkWidth)(l) + state.linkHoverPrecision;\n      }); // redraw\n\n      var t = zoomTransform(state.canvas);\n      state.shadowGraph.globalScale(t.k).tickFrame();\n    }, HOVER_CANVAS_THROTTLE_DELAY); // Kick-off renderer\n\n    (this._animationCycle = function animate() {\n      // IIFE\n      if (state.enablePointerInteraction) {\n        // Update tooltip and trigger onHover events\n        var obj = null;\n\n        if (!state.isPointerDragging) {\n          // don't hover during drag\n          // Lookup object per pixel color\n          var pxScale = window.devicePixelRatio;\n          var px = pointerPos.x > 0 && pointerPos.y > 0 ? shadowCtx.getImageData(pointerPos.x * pxScale, pointerPos.y * pxScale, 1, 1) : null;\n          px && (obj = state.colorTracker.lookup(px.data));\n        }\n\n        if (obj !== state.hoverObj) {\n          var prevObj = state.hoverObj;\n          var prevObjType = prevObj ? prevObj.type : null;\n          var objType = obj ? obj.type : null;\n\n          if (prevObjType && prevObjType !== objType) {\n            // Hover out\n            state[\"on\".concat(prevObjType, \"Hover\")](null, prevObj.d);\n          }\n\n          if (objType) {\n            // Hover in\n            state[\"on\".concat(objType, \"Hover\")](obj.d, prevObjType === objType ? prevObj.d : null);\n          }\n\n          var tooltipContent = obj ? accessorFn(state[\"\".concat(obj.type.toLowerCase(), \"Label\")])(obj.d) || '' : '';\n          toolTipElem.style.visibility = tooltipContent ? 'visible' : 'hidden';\n          toolTipElem.innerHTML = tooltipContent;\n          state.hoverObj = obj;\n        }\n\n        refreshShadowCanvas();\n      } // Wipe canvas\n\n\n      clearCanvas(ctx, state.width, state.height); // Frame cycle\n\n      var globalScale = zoomTransform(state.canvas).k;\n      state.onRenderFramePre && state.onRenderFramePre(ctx, globalScale);\n      state.forceGraph.globalScale(globalScale).tickFrame();\n      state.onRenderFramePost && state.onRenderFramePost(ctx, globalScale);\n      TWEEN.update(); // update canvas animation tweens\n\n      state.animationFrameRequestId = requestAnimationFrame(animate);\n    })();\n  },\n  update: function updateFn(state) {}\n});\n\nexport default forceGraph;\n"]},"metadata":{},"sourceType":"module"}