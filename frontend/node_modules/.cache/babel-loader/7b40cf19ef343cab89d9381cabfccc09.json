{"ast":null,"code":"import { Group, Mesh, MeshLambertMaterial, Color, BufferGeometry, BufferAttribute, Matrix4, Vector3, SphereBufferGeometry, CylinderBufferGeometry, TubeBufferGeometry, ConeBufferGeometry, Line, LineBasicMaterial, QuadraticBezierCurve3, CubicBezierCurve3, Box3 } from 'three';\nimport { forceSimulation, forceLink, forceManyBody, forceCenter, forceRadial } from 'd3-force-3d';\nimport graph from 'ngraph.graph';\nimport forcelayout from 'ngraph.forcelayout';\nimport Kapsule from 'kapsule';\nimport accessorFn from 'accessor-fn';\nimport { min, max } from 'd3-array';\nimport dataJoint from 'data-joint';\nimport { scaleOrdinal } from 'd3-scale';\nimport { schemePaired } from 'd3-scale-chromatic';\nimport tinyColor from 'tinycolor2';\n\nfunction _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") {\n    _typeof = function (obj) {\n      return typeof obj;\n    };\n  } else {\n    _typeof = function (obj) {\n      return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n    };\n  }\n\n  return _typeof(obj);\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    if (enumerableOnly) symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    });\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread2(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      ownKeys(Object(source), true).forEach(function (key) {\n        _defineProperty(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(Object(source)).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n\n  return target;\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) _setPrototypeOf(subClass, superClass);\n}\n\nfunction _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}\n\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}\n\nfunction _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n\n  try {\n    Date.prototype.toString.call(Reflect.construct(Date, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\nfunction _construct(Parent, args, Class) {\n  if (_isNativeReflectConstruct()) {\n    _construct = Reflect.construct;\n  } else {\n    _construct = function _construct(Parent, args, Class) {\n      var a = [null];\n      a.push.apply(a, args);\n      var Constructor = Function.bind.apply(Parent, a);\n      var instance = new Constructor();\n      if (Class) _setPrototypeOf(instance, Class.prototype);\n      return instance;\n    };\n  }\n\n  return _construct.apply(null, arguments);\n}\n\nfunction _objectWithoutPropertiesLoose(source, excluded) {\n  if (source == null) return {};\n  var target = {};\n  var sourceKeys = Object.keys(source);\n  var key, i;\n\n  for (i = 0; i < sourceKeys.length; i++) {\n    key = sourceKeys[i];\n    if (excluded.indexOf(key) >= 0) continue;\n    target[key] = source[key];\n  }\n\n  return target;\n}\n\nfunction _objectWithoutProperties(source, excluded) {\n  if (source == null) return {};\n\n  var target = _objectWithoutPropertiesLoose(source, excluded);\n\n  var key, i;\n\n  if (Object.getOwnPropertySymbols) {\n    var sourceSymbolKeys = Object.getOwnPropertySymbols(source);\n\n    for (i = 0; i < sourceSymbolKeys.length; i++) {\n      key = sourceSymbolKeys[i];\n      if (excluded.indexOf(key) >= 0) continue;\n      if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;\n      target[key] = source[key];\n    }\n  }\n\n  return target;\n}\n\nfunction _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (call && (typeof call === \"object\" || typeof call === \"function\")) {\n    return call;\n  }\n\n  return _assertThisInitialized(self);\n}\n\nfunction _createSuper(Derived) {\n  var hasNativeReflectConstruct = _isNativeReflectConstruct();\n\n  return function _createSuperInternal() {\n    var Super = _getPrototypeOf(Derived),\n        result;\n\n    if (hasNativeReflectConstruct) {\n      var NewTarget = _getPrototypeOf(this).constructor;\n\n      result = Reflect.construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n\n    return _possibleConstructorReturn(this, result);\n  };\n}\n\nfunction _slicedToArray(arr, i) {\n  return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest();\n}\n\nfunction _toConsumableArray(arr) {\n  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread();\n}\n\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) return _arrayLikeToArray(arr);\n}\n\nfunction _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}\n\nfunction _iterableToArray(iter) {\n  if (typeof Symbol !== \"undefined\" && Symbol.iterator in Object(iter)) return Array.from(iter);\n}\n\nfunction _iterableToArrayLimit(arr, i) {\n  if (typeof Symbol === \"undefined\" || !(Symbol.iterator in Object(arr))) return;\n  var _arr = [];\n  var _n = true;\n  var _d = false;\n  var _e = undefined;\n\n  try {\n    for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {\n      _arr.push(_s.value);\n\n      if (i && _arr.length === i) break;\n    }\n  } catch (err) {\n    _d = true;\n    _e = err;\n  } finally {\n    try {\n      if (!_n && _i[\"return\"] != null) _i[\"return\"]();\n    } finally {\n      if (_d) throw _e;\n    }\n  }\n\n  return _arr;\n}\n\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n}\n\nfunction _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n\n  for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];\n\n  return arr2;\n}\n\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nfunction _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nvar materialDispose = function materialDispose(material) {\n  if (material instanceof Array) {\n    material.forEach(materialDispose);\n  } else {\n    if (material.map) {\n      material.map.dispose();\n    }\n\n    material.dispose();\n  }\n};\n\nvar deallocate = function deallocate(obj) {\n  if (obj.geometry) {\n    obj.geometry.dispose();\n  }\n\n  if (obj.material) {\n    materialDispose(obj.material);\n  }\n\n  if (obj.texture) {\n    obj.texture.dispose();\n  }\n\n  if (obj.children) {\n    obj.children.forEach(deallocate);\n  }\n};\n\nvar emptyObject = function emptyObject(obj) {\n  while (obj.children.length) {\n    var childObj = obj.children[0];\n    obj.remove(childObj);\n    deallocate(childObj);\n  }\n};\n\nfunction threeDigest(data, scene) {\n  var _ref = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n\n  var _ref$objFilter = _ref.objFilter,\n      objFilter = _ref$objFilter === void 0 ? function () {\n    return true;\n  } : _ref$objFilter,\n      options = _objectWithoutProperties(_ref, [\"objFilter\"]);\n\n  return dataJoint(data, scene.children.filter(objFilter), function (obj) {\n    return scene.add(obj);\n  }, function (obj) {\n    scene.remove(obj);\n    emptyObject(obj);\n  }, _objectSpread2({\n    objBindAttr: '__threeObj'\n  }, options));\n}\n\nvar colorStr2Hex = function colorStr2Hex(str) {\n  return isNaN(str) ? parseInt(tinyColor(str).toHex(), 16) : str;\n};\n\nvar colorAlpha = function colorAlpha(str) {\n  return isNaN(str) ? tinyColor(str).getAlpha() : 1;\n};\n\nvar autoColorScale = scaleOrdinal(schemePaired); // Autoset attribute colorField by colorByAccessor property\n// If an object has already a color, don't set it\n// Objects can be nodes or links\n\nfunction autoColorObjects(objects, colorByAccessor, colorField) {\n  if (!colorByAccessor || typeof colorField !== 'string') return;\n  objects.filter(function (obj) {\n    return !obj[colorField];\n  }).forEach(function (obj) {\n    obj[colorField] = autoColorScale(colorByAccessor(obj));\n  });\n}\n\nfunction getDagDepths(_ref, idAccessor) {\n  var nodes = _ref.nodes,\n      links = _ref.links;\n\n  var _ref2 = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {},\n      _ref2$nodeFilter = _ref2.nodeFilter,\n      nodeFilter = _ref2$nodeFilter === void 0 ? function () {\n    return true;\n  } : _ref2$nodeFilter,\n      _ref2$onLoopError = _ref2.onLoopError,\n      onLoopError = _ref2$onLoopError === void 0 ? function (loopIds) {\n    throw \"Invalid DAG structure! Found cycle in node path: \".concat(loopIds.join(' -> '), \".\");\n  } : _ref2$onLoopError; // linked graph\n\n\n  var graph = {};\n  nodes.forEach(function (node) {\n    return graph[idAccessor(node)] = {\n      data: node,\n      out: [],\n      depth: -1,\n      skip: !nodeFilter(node)\n    };\n  });\n  links.forEach(function (_ref3) {\n    var source = _ref3.source,\n        target = _ref3.target;\n    var sourceId = getNodeId(source);\n    var targetId = getNodeId(target);\n    if (!graph.hasOwnProperty(sourceId)) throw \"Missing source node with id: \".concat(sourceId);\n    if (!graph.hasOwnProperty(targetId)) throw \"Missing target node with id: \".concat(targetId);\n    var sourceNode = graph[sourceId];\n    var targetNode = graph[targetId];\n    sourceNode.out.push(targetNode);\n\n    function getNodeId(node) {\n      return _typeof(node) === 'object' ? idAccessor(node) : node;\n    }\n  });\n  var foundLoops = [];\n  traverse(Object.values(graph));\n  var nodeDepths = Object.assign.apply(Object, [{}].concat(_toConsumableArray(Object.entries(graph).filter(function (_ref4) {\n    var _ref5 = _slicedToArray(_ref4, 2),\n        node = _ref5[1];\n\n    return !node.skip;\n  }).map(function (_ref6) {\n    var _ref7 = _slicedToArray(_ref6, 2),\n        id = _ref7[0],\n        node = _ref7[1];\n\n    return _defineProperty({}, id, node.depth);\n  }))));\n  return nodeDepths;\n\n  function traverse(nodes) {\n    var nodeStack = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];\n    var currentDepth = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n\n    for (var i = 0, l = nodes.length; i < l; i++) {\n      var node = nodes[i];\n\n      if (nodeStack.indexOf(node) !== -1) {\n        var _ret = function () {\n          var loop = [].concat(_toConsumableArray(nodeStack.slice(nodeStack.indexOf(node))), [node]).map(function (d) {\n            return idAccessor(d.data);\n          });\n\n          if (!foundLoops.some(function (foundLoop) {\n            return foundLoop.length === loop.length && foundLoop.every(function (id, idx) {\n              return id === loop[idx];\n            });\n          })) {\n            foundLoops.push(loop);\n            onLoopError(loop);\n          }\n\n          return \"continue\";\n        }();\n\n        if (_ret === \"continue\") continue;\n      }\n\n      if (currentDepth > node.depth) {\n        // Don't unnecessarily revisit chunks of the graph\n        node.depth = currentDepth;\n        traverse(node.out, [].concat(_toConsumableArray(nodeStack), [node]), currentDepth + (node.skip ? 0 : 1));\n      }\n    }\n  }\n}\n\nvar three = window.THREE ? window.THREE // Prefer consumption from global THREE, if exists\n: {\n  Group: Group,\n  Mesh: Mesh,\n  MeshLambertMaterial: MeshLambertMaterial,\n  Color: Color,\n  BufferGeometry: BufferGeometry,\n  BufferAttribute: BufferAttribute,\n  Matrix4: Matrix4,\n  Vector3: Vector3,\n  SphereBufferGeometry: SphereBufferGeometry,\n  CylinderBufferGeometry: CylinderBufferGeometry,\n  TubeBufferGeometry: TubeBufferGeometry,\n  ConeBufferGeometry: ConeBufferGeometry,\n  Line: Line,\n  LineBasicMaterial: LineBasicMaterial,\n  QuadraticBezierCurve3: QuadraticBezierCurve3,\n  CubicBezierCurve3: CubicBezierCurve3,\n  Box3: Box3\n};\nvar ngraph = {\n  graph: graph,\n  forcelayout: forcelayout\n};\nvar DAG_LEVEL_NODE_RATIO = 2; // support multiple method names for backwards threejs compatibility\n\nvar setAttributeFn = new three.BufferGeometry().setAttribute ? 'setAttribute' : 'addAttribute';\nvar applyMatrix4Fn = new three.BufferGeometry().applyMatrix4 ? 'applyMatrix4' : 'applyMatrix';\nvar ForceGraph = Kapsule({\n  props: {\n    jsonUrl: {\n      onChange: function onChange(jsonUrl, state) {\n        var _this = this;\n\n        if (jsonUrl && !state.fetchingJson) {\n          // Load data asynchronously\n          state.fetchingJson = true;\n          state.onLoading();\n          fetch(jsonUrl).then(function (r) {\n            return r.json();\n          }).then(function (json) {\n            state.fetchingJson = false;\n            state.onFinishLoading(json);\n\n            _this.graphData(json);\n          });\n        }\n      },\n      triggerUpdate: false\n    },\n    graphData: {\n      \"default\": {\n        nodes: [],\n        links: []\n      },\n      onChange: function onChange(graphData, state) {\n        if (graphData.nodes.length || graphData.links.length) {\n          console.info('force-graph loading', graphData.nodes.length + ' nodes', graphData.links.length + ' links');\n        }\n\n        state.engineRunning = false; // Pause simulation immediately\n      }\n    },\n    numDimensions: {\n      \"default\": 3,\n      onChange: function onChange(numDim, state) {\n        var chargeForce = state.d3ForceLayout.force('charge'); // Increase repulsion on 3D mode for improved spatial separation\n\n        if (chargeForce) {\n          chargeForce.strength(numDim > 2 ? -60 : -30);\n        }\n\n        if (numDim < 3) {\n          eraseDimension(state.graphData.nodes, 'z');\n        }\n\n        if (numDim < 2) {\n          eraseDimension(state.graphData.nodes, 'y');\n        }\n\n        function eraseDimension(nodes, dim) {\n          nodes.forEach(function (d) {\n            delete d[dim]; // position\n\n            delete d[\"v\".concat(dim)]; // velocity\n          });\n        }\n      }\n    },\n    dagMode: {\n      onChange: function onChange(dagMode, state) {\n        // td, bu, lr, rl, zin, zout, radialin, radialout\n        !dagMode && state.forceEngine === 'd3' && (state.graphData.nodes || []).forEach(function (n) {\n          return n.fx = n.fy = n.fz = undefined;\n        }); // unfix nodes when disabling dag mode\n      }\n    },\n    dagLevelDistance: {},\n    dagNodeFilter: {\n      \"default\": function _default(node) {\n        return true;\n      }\n    },\n    onDagError: {\n      triggerUpdate: false\n    },\n    nodeRelSize: {\n      \"default\": 4\n    },\n    // volume per val unit\n    nodeId: {\n      \"default\": 'id'\n    },\n    nodeVal: {\n      \"default\": 'val'\n    },\n    nodeResolution: {\n      \"default\": 8\n    },\n    // how many slice segments in the sphere's circumference\n    nodeColor: {\n      \"default\": 'color'\n    },\n    nodeAutoColorBy: {},\n    nodeOpacity: {\n      \"default\": 0.75\n    },\n    nodeVisibility: {\n      \"default\": true\n    },\n    nodeThreeObject: {},\n    nodeThreeObjectExtend: {\n      \"default\": false\n    },\n    linkSource: {\n      \"default\": 'source'\n    },\n    linkTarget: {\n      \"default\": 'target'\n    },\n    linkVisibility: {\n      \"default\": true\n    },\n    linkColor: {\n      \"default\": 'color'\n    },\n    linkAutoColorBy: {},\n    linkOpacity: {\n      \"default\": 0.2\n    },\n    linkWidth: {},\n    // Rounded to nearest decimal. For falsy values use dimensionless line with 1px regardless of distance.\n    linkResolution: {\n      \"default\": 6\n    },\n    // how many radial segments in each line tube's geometry\n    linkCurvature: {\n      \"default\": 0,\n      triggerUpdate: false\n    },\n    // line curvature radius (0: straight, 1: semi-circle)\n    linkCurveRotation: {\n      \"default\": 0,\n      triggerUpdate: false\n    },\n    // line curve rotation along the line axis (0: interection with XY plane, PI: upside down)\n    linkMaterial: {},\n    linkThreeObject: {},\n    linkThreeObjectExtend: {\n      \"default\": false\n    },\n    linkPositionUpdate: {\n      triggerUpdate: false\n    },\n    // custom function to call for updating the link's position. Signature: (threeObj, { start: { x, y, z},  end: { x, y, z }}, link). If the function returns a truthy value, the regular link position update will not run.\n    linkDirectionalArrowLength: {\n      \"default\": 0\n    },\n    linkDirectionalArrowColor: {},\n    linkDirectionalArrowRelPos: {\n      \"default\": 0.5,\n      triggerUpdate: false\n    },\n    // value between 0<>1 indicating the relative pos along the (exposed) line\n    linkDirectionalArrowResolution: {\n      \"default\": 8\n    },\n    // how many slice segments in the arrow's conic circumference\n    linkDirectionalParticles: {\n      \"default\": 0\n    },\n    // animate photons travelling in the link direction\n    linkDirectionalParticleSpeed: {\n      \"default\": 0.01,\n      triggerUpdate: false\n    },\n    // in link length ratio per frame\n    linkDirectionalParticleWidth: {\n      \"default\": 0.5\n    },\n    linkDirectionalParticleColor: {},\n    linkDirectionalParticleResolution: {\n      \"default\": 4\n    },\n    // how many slice segments in the particle sphere's circumference\n    forceEngine: {\n      \"default\": 'd3'\n    },\n    // d3 or ngraph\n    d3AlphaMin: {\n      \"default\": 0,\n      triggerUpdate: false\n    },\n    d3AlphaDecay: {\n      \"default\": 0.0228,\n      triggerUpdate: false,\n      onChange: function onChange(alphaDecay, state) {\n        state.d3ForceLayout.alphaDecay(alphaDecay);\n      }\n    },\n    d3AlphaTarget: {\n      \"default\": 0,\n      triggerUpdate: false,\n      onChange: function onChange(alphaTarget, state) {\n        state.d3ForceLayout.alphaTarget(alphaTarget);\n      }\n    },\n    d3VelocityDecay: {\n      \"default\": 0.4,\n      triggerUpdate: false,\n      onChange: function onChange(velocityDecay, state) {\n        state.d3ForceLayout.velocityDecay(velocityDecay);\n      }\n    },\n    ngraphPhysics: {\n      \"default\": {\n        // defaults from https://github.com/anvaka/ngraph.physics.simulator/blob/master/index.js\n        timeStep: 20,\n        gravity: -1.2,\n        theta: 0.8,\n        springLength: 30,\n        springCoefficient: 0.0008,\n        dragCoefficient: 0.02\n      }\n    },\n    warmupTicks: {\n      \"default\": 0,\n      triggerUpdate: false\n    },\n    // how many times to tick the force engine at init before starting to render\n    cooldownTicks: {\n      \"default\": Infinity,\n      triggerUpdate: false\n    },\n    cooldownTime: {\n      \"default\": 15000,\n      triggerUpdate: false\n    },\n    // ms\n    onLoading: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onFinishLoading: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onUpdate: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onFinishUpdate: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onEngineTick: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onEngineStop: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    }\n  },\n  methods: {\n    refresh: function refresh(state) {\n      state._flushObjects = true;\n\n      state._rerender();\n\n      return this;\n    },\n    // Expose d3 forces for external manipulation\n    d3Force: function d3Force(state, forceName, forceFn) {\n      if (forceFn === undefined) {\n        return state.d3ForceLayout.force(forceName); // Force getter\n      }\n\n      state.d3ForceLayout.force(forceName, forceFn); // Force setter\n\n      return this;\n    },\n    d3ReheatSimulation: function d3ReheatSimulation(state) {\n      state.d3ForceLayout.alpha(1);\n      this.resetCountdown();\n      return this;\n    },\n    // reset cooldown state\n    resetCountdown: function resetCountdown(state) {\n      state.cntTicks = 0;\n      state.startTickTime = new Date();\n      state.engineRunning = true;\n      return this;\n    },\n    tickFrame: function tickFrame(state) {\n      var isD3Sim = state.forceEngine !== 'ngraph';\n\n      if (state.engineRunning) {\n        layoutTick();\n      }\n\n      updateArrows();\n      updatePhotons();\n      return this; //\n\n      function layoutTick() {\n        if (++state.cntTicks > state.cooldownTicks || new Date() - state.startTickTime > state.cooldownTime || isD3Sim && state.d3AlphaMin > 0 && state.d3ForceLayout.alpha() < state.d3AlphaMin) {\n          state.engineRunning = false; // Stop ticking graph\n\n          state.onEngineStop();\n        } else {\n          state.layout[isD3Sim ? 'tick' : 'step'](); // Tick it\n\n          state.onEngineTick();\n        } // Update nodes position\n\n\n        state.graphData.nodes.forEach(function (node) {\n          var obj = node.__threeObj;\n          if (!obj) return;\n          var pos = isD3Sim ? node : state.layout.getNodePosition(node[state.nodeId]);\n          obj.position.x = pos.x;\n          obj.position.y = pos.y || 0;\n          obj.position.z = pos.z || 0;\n        }); // Update links position\n\n        var linkWidthAccessor = accessorFn(state.linkWidth);\n        var linkCurvatureAccessor = accessorFn(state.linkCurvature);\n        var linkCurveRotationAccessor = accessorFn(state.linkCurveRotation);\n        var linkThreeObjectExtendAccessor = accessorFn(state.linkThreeObjectExtend);\n        state.graphData.links.forEach(function (link) {\n          var lineObj = link.__lineObj;\n          if (!lineObj) return;\n          var pos = isD3Sim ? link : state.layout.getLinkPosition(state.layout.graph.getLink(link.source, link.target).id);\n          var start = pos[isD3Sim ? 'source' : 'from'];\n          var end = pos[isD3Sim ? 'target' : 'to'];\n          if (!start || !end || !start.hasOwnProperty('x') || !end.hasOwnProperty('x')) return; // skip invalid link\n\n          calcLinkCurve(link); // calculate link curve for all links, including custom replaced, so it can be used in directional functionality\n\n          var extendedObj = linkThreeObjectExtendAccessor(link);\n\n          if (state.linkPositionUpdate && state.linkPositionUpdate(extendedObj ? lineObj.children[1] : lineObj, // pass child custom object if extending the default\n          {\n            start: {\n              x: start.x,\n              y: start.y,\n              z: start.z\n            },\n            end: {\n              x: end.x,\n              y: end.y,\n              z: end.z\n            }\n          }, link) && !extendedObj) {\n            // exit if successfully custom updated position of non-extended obj\n            return;\n          }\n\n          var curveResolution = 30; // # line segments\n\n          var curve = link.__curve; // select default line obj if it's an extended group\n\n          var line = lineObj.children.length ? lineObj.children[0] : lineObj;\n\n          if (line.type === 'Line') {\n            // Update line geometry\n            if (!curve) {\n              // straight line\n              var linePos = line.geometry.getAttribute('position');\n\n              if (!linePos || !linePos.array || linePos.array.length !== 6) {\n                line.geometry[setAttributeFn]('position', linePos = new three.BufferAttribute(new Float32Array(2 * 3), 3));\n              }\n\n              linePos.array[0] = start.x;\n              linePos.array[1] = start.y || 0;\n              linePos.array[2] = start.z || 0;\n              linePos.array[3] = end.x;\n              linePos.array[4] = end.y || 0;\n              linePos.array[5] = end.z || 0;\n              linePos.needsUpdate = true;\n            } else {\n              // bezier curve line\n              line.geometry.setFromPoints(curve.getPoints(curveResolution));\n            }\n\n            line.geometry.computeBoundingSphere();\n          } else if (line.type === 'Mesh') {\n            // Update cylinder geometry\n            if (!curve) {\n              // straight tube\n              if (line.geometry.type !== 'CylinderBufferGeometry') {\n                var linkWidth = Math.ceil(linkWidthAccessor(link) * 10) / 10;\n                var r = linkWidth / 2;\n                var geometry = new three.CylinderBufferGeometry(r, r, 1, state.linkResolution, 1, false);\n                geometry[applyMatrix4Fn](new three.Matrix4().makeTranslation(0, 1 / 2, 0));\n                geometry[applyMatrix4Fn](new three.Matrix4().makeRotationX(Math.PI / 2));\n                line.geometry.dispose();\n                line.geometry = geometry;\n              }\n\n              var vStart = new three.Vector3(start.x, start.y || 0, start.z || 0);\n              var vEnd = new three.Vector3(end.x, end.y || 0, end.z || 0);\n              var distance = vStart.distanceTo(vEnd);\n              line.position.x = vStart.x;\n              line.position.y = vStart.y;\n              line.position.z = vStart.z;\n              line.scale.z = distance;\n              line.parent.localToWorld(vEnd); // lookAt requires world coords\n\n              line.lookAt(vEnd);\n            } else {\n              // curved tube\n              if (line.geometry.type !== 'TubeBufferGeometry') {\n                // reset object positioning\n                line.position.set(0, 0, 0);\n                line.rotation.set(0, 0, 0);\n                line.scale.set(1, 1, 1);\n              }\n\n              var _linkWidth = Math.ceil(linkWidthAccessor(link) * 10) / 10;\n\n              var _r = _linkWidth / 2;\n\n              var _geometry = new three.TubeBufferGeometry(curve, curveResolution, _r, state.linkResolution, false);\n\n              line.geometry.dispose();\n              line.geometry = _geometry;\n            }\n          }\n        }); //\n\n        function calcLinkCurve(link) {\n          var pos = isD3Sim ? link : state.layout.getLinkPosition(state.layout.graph.getLink(link.source, link.target).id);\n          var start = pos[isD3Sim ? 'source' : 'from'];\n          var end = pos[isD3Sim ? 'target' : 'to'];\n          if (!start || !end || !start.hasOwnProperty('x') || !end.hasOwnProperty('x')) return; // skip invalid link\n\n          var curvature = linkCurvatureAccessor(link);\n\n          if (!curvature) {\n            link.__curve = null; // Straight line\n          } else {\n            // bezier curve line (only for line types)\n            var vStart = new three.Vector3(start.x, start.y || 0, start.z || 0);\n            var vEnd = new three.Vector3(end.x, end.y || 0, end.z || 0);\n            var l = vStart.distanceTo(vEnd); // line length\n\n            var curve;\n            var curveRotation = linkCurveRotationAccessor(link);\n\n            if (l > 0) {\n              var dx = end.x - start.x;\n              var dy = end.y - start.y || 0;\n              var vLine = new three.Vector3().subVectors(vEnd, vStart);\n              var cp = vLine.clone().multiplyScalar(curvature).cross(dx !== 0 || dy !== 0 ? new three.Vector3(0, 0, 1) : new three.Vector3(0, 1, 0)) // avoid cross-product of parallel vectors (prefer Z, fallback to Y)\n              .applyAxisAngle(vLine.normalize(), curveRotation) // rotate along line axis according to linkCurveRotation\n              .add(new three.Vector3().addVectors(vStart, vEnd).divideScalar(2));\n              curve = new three.QuadraticBezierCurve3(vStart, cp, vEnd);\n            } else {\n              // Same point, draw a loop\n              var d = curvature * 70;\n              var endAngle = -curveRotation; // Rotate clockwise (from Z angle perspective)\n\n              var startAngle = endAngle + Math.PI / 2;\n              curve = new three.CubicBezierCurve3(vStart, new three.Vector3(d * Math.cos(startAngle), d * Math.sin(startAngle), 0).add(vStart), new three.Vector3(d * Math.cos(endAngle), d * Math.sin(endAngle), 0).add(vStart), vEnd);\n            }\n\n            link.__curve = curve;\n          }\n        }\n      }\n\n      function updateArrows() {\n        // update link arrow position\n        var arrowRelPosAccessor = accessorFn(state.linkDirectionalArrowRelPos);\n        var arrowLengthAccessor = accessorFn(state.linkDirectionalArrowLength);\n        var nodeValAccessor = accessorFn(state.nodeVal);\n        state.graphData.links.forEach(function (link) {\n          var arrowObj = link.__arrowObj;\n          if (!arrowObj) return;\n          var pos = isD3Sim ? link : state.layout.getLinkPosition(state.layout.graph.getLink(link.source, link.target).id);\n          var start = pos[isD3Sim ? 'source' : 'from'];\n          var end = pos[isD3Sim ? 'target' : 'to'];\n          if (!start || !end || !start.hasOwnProperty('x') || !end.hasOwnProperty('x')) return; // skip invalid link\n\n          var startR = Math.sqrt(Math.max(0, nodeValAccessor(start) || 1)) * state.nodeRelSize;\n          var endR = Math.sqrt(Math.max(0, nodeValAccessor(end) || 1)) * state.nodeRelSize;\n          var arrowLength = arrowLengthAccessor(link);\n          var arrowRelPos = arrowRelPosAccessor(link);\n          var getPosAlongLine = link.__curve ? function (t) {\n            return link.__curve.getPoint(t);\n          } // interpolate along bezier curve\n          : function (t) {\n            // straight line: interpolate linearly\n            var iplt = function iplt(dim, start, end, t) {\n              return start[dim] + (end[dim] - start[dim]) * t || 0;\n            };\n\n            return {\n              x: iplt('x', start, end, t),\n              y: iplt('y', start, end, t),\n              z: iplt('z', start, end, t)\n            };\n          };\n          var lineLen = link.__curve ? link.__curve.getLength() : Math.sqrt(['x', 'y', 'z'].map(function (dim) {\n            return Math.pow((end[dim] || 0) - (start[dim] || 0), 2);\n          }).reduce(function (acc, v) {\n            return acc + v;\n          }, 0));\n          var posAlongLine = startR + arrowLength + (lineLen - startR - endR - arrowLength) * arrowRelPos;\n          var arrowHead = getPosAlongLine(posAlongLine / lineLen);\n          var arrowTail = getPosAlongLine((posAlongLine - arrowLength) / lineLen);\n          ['x', 'y', 'z'].forEach(function (dim) {\n            return arrowObj.position[dim] = arrowTail[dim];\n          });\n\n          var headVec = _construct(three.Vector3, _toConsumableArray(['x', 'y', 'z'].map(function (c) {\n            return arrowHead[c];\n          })));\n\n          arrowObj.parent.localToWorld(headVec); // lookAt requires world coords\n\n          arrowObj.lookAt(headVec);\n        });\n      }\n\n      function updatePhotons() {\n        // update link particle positions\n        var particleSpeedAccessor = accessorFn(state.linkDirectionalParticleSpeed);\n        state.graphData.links.forEach(function (link) {\n          var cyclePhotons = link.__photonsObj && link.__photonsObj.children;\n          var singleHopPhotons = link.__singleHopPhotonsObj && link.__singleHopPhotonsObj.children;\n          if ((!singleHopPhotons || !singleHopPhotons.length) && (!cyclePhotons || !cyclePhotons.length)) return;\n          var pos = isD3Sim ? link : state.layout.getLinkPosition(state.layout.graph.getLink(link.source, link.target).id);\n          var start = pos[isD3Sim ? 'source' : 'from'];\n          var end = pos[isD3Sim ? 'target' : 'to'];\n          if (!start || !end || !start.hasOwnProperty('x') || !end.hasOwnProperty('x')) return; // skip invalid link\n\n          var particleSpeed = particleSpeedAccessor(link);\n          var getPhotonPos = link.__curve ? function (t) {\n            return link.__curve.getPoint(t);\n          } // interpolate along bezier curve\n          : function (t) {\n            // straight line: interpolate linearly\n            var iplt = function iplt(dim, start, end, t) {\n              return start[dim] + (end[dim] - start[dim]) * t || 0;\n            };\n\n            return {\n              x: iplt('x', start, end, t),\n              y: iplt('y', start, end, t),\n              z: iplt('z', start, end, t)\n            };\n          };\n          var photons = [].concat(_toConsumableArray(cyclePhotons || []), _toConsumableArray(singleHopPhotons || []));\n          photons.forEach(function (photon, idx) {\n            var singleHop = photon.parent.__linkThreeObjType === 'singleHopPhotons';\n\n            if (!photon.hasOwnProperty('__progressRatio')) {\n              photon.__progressRatio = singleHop ? 0 : idx / cyclePhotons.length;\n            }\n\n            photon.__progressRatio += particleSpeed;\n\n            if (photon.__progressRatio >= 1) {\n              if (!singleHop) {\n                photon.__progressRatio = photon.__progressRatio % 1;\n              } else {\n                // remove particle\n                photon.parent.remove(photon);\n                emptyObject(photon);\n                return;\n              }\n            }\n\n            var photonPosRatio = photon.__progressRatio;\n            var pos = getPhotonPos(photonPosRatio);\n            ['x', 'y', 'z'].forEach(function (dim) {\n              return photon.position[dim] = pos[dim];\n            });\n          });\n        });\n      }\n    },\n    emitParticle: function emitParticle(state, link) {\n      if (link) {\n        if (!link.__singleHopPhotonsObj) {\n          var obj = new three.Group();\n          obj.__linkThreeObjType = 'singleHopPhotons';\n          link.__singleHopPhotonsObj = obj;\n          state.graphScene.add(obj);\n        }\n\n        var particleWidthAccessor = accessorFn(state.linkDirectionalParticleWidth);\n        var photonR = Math.ceil(particleWidthAccessor(link) * 10) / 10 / 2;\n        var numSegments = state.linkDirectionalParticleResolution;\n        var particleGeometry = new three.SphereBufferGeometry(photonR, numSegments, numSegments);\n        var linkColorAccessor = accessorFn(state.linkColor);\n        var particleColorAccessor = accessorFn(state.linkDirectionalParticleColor);\n        var photonColor = particleColorAccessor(link) || linkColorAccessor(link) || '#f0f0f0';\n        var materialColor = new three.Color(colorStr2Hex(photonColor));\n        var opacity = state.linkOpacity * 3;\n        var particleMaterial = new three.MeshLambertMaterial({\n          color: materialColor,\n          transparent: true,\n          opacity: opacity\n        }); // add a single hop particle\n\n        link.__singleHopPhotonsObj.add(new three.Mesh(particleGeometry, particleMaterial));\n      }\n\n      return this;\n    },\n    getGraphBbox: function getGraphBbox(state) {\n      var nodeFilter = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : function () {\n        return true;\n      };\n      if (!state.initialised) return null; // recursively collect all nested geometries bboxes\n\n      var bboxes = function getBboxes(obj) {\n        var bboxes = [];\n\n        if (obj.geometry) {\n          obj.geometry.computeBoundingBox();\n          var box = new three.Box3();\n          box.copy(obj.geometry.boundingBox).applyMatrix4(obj.matrixWorld);\n          bboxes.push(box);\n        }\n\n        return bboxes.concat.apply(bboxes, _toConsumableArray((obj.children || []).filter(function (obj) {\n          return !obj.hasOwnProperty('__graphObjType') || obj.__graphObjType === 'node' && nodeFilter(obj.__data);\n        } // exclude filtered out nodes\n        ).map(getBboxes)));\n      }(state.graphScene);\n\n      if (!bboxes.length) return null; // extract global x,y,z min/max\n\n      return Object.assign.apply(Object, _toConsumableArray(['x', 'y', 'z'].map(function (c) {\n        return _defineProperty({}, c, [min(bboxes, function (bb) {\n          return bb.min[c];\n        }), max(bboxes, function (bb) {\n          return bb.max[c];\n        })]);\n      })));\n    }\n  },\n  stateInit: function stateInit() {\n    return {\n      d3ForceLayout: forceSimulation().force('link', forceLink()).force('charge', forceManyBody()).force('center', forceCenter()).force('dagRadial', null).stop(),\n      engineRunning: false\n    };\n  },\n  init: function init(threeObj, state) {\n    // Main three object to manipulate\n    state.graphScene = threeObj;\n  },\n  update: function update(state, changedProps) {\n    var hasAnyPropChanged = function hasAnyPropChanged(propList) {\n      return propList.some(function (p) {\n        return changedProps.hasOwnProperty(p);\n      });\n    };\n\n    state.engineRunning = false; // pause simulation\n\n    state.onUpdate();\n\n    if (state.nodeAutoColorBy !== null && hasAnyPropChanged(['nodeAutoColorBy', 'graphData', 'nodeColor'])) {\n      // Auto add color to uncolored nodes\n      autoColorObjects(state.graphData.nodes, accessorFn(state.nodeAutoColorBy), state.nodeColor);\n    }\n\n    if (state.linkAutoColorBy !== null && hasAnyPropChanged(['linkAutoColorBy', 'graphData', 'linkColor'])) {\n      // Auto add color to uncolored links\n      autoColorObjects(state.graphData.links, accessorFn(state.linkAutoColorBy), state.linkColor);\n    } // Digest nodes WebGL objects\n\n\n    if (state._flushObjects || hasAnyPropChanged(['graphData', 'nodeThreeObject', 'nodeThreeObjectExtend', 'nodeVal', 'nodeColor', 'nodeVisibility', 'nodeRelSize', 'nodeResolution', 'nodeOpacity'])) {\n      var customObjectAccessor = accessorFn(state.nodeThreeObject);\n      var customObjectExtendAccessor = accessorFn(state.nodeThreeObjectExtend);\n      var valAccessor = accessorFn(state.nodeVal);\n      var colorAccessor = accessorFn(state.nodeColor);\n      var visibilityAccessor = accessorFn(state.nodeVisibility);\n      var sphereGeometries = {}; // indexed by node value\n\n      var sphereMaterials = {}; // indexed by color\n\n      threeDigest(state.graphData.nodes.filter(visibilityAccessor), state.graphScene, {\n        purge: state._flushObjects || hasAnyPropChanged([// recreate objects if any of these props have changed\n        'nodeThreeObject', 'nodeThreeObjectExtend']),\n        objFilter: function objFilter(obj) {\n          return obj.__graphObjType === 'node';\n        },\n        createObj: function createObj(node) {\n          var customObj = customObjectAccessor(node);\n          var extendObj = customObjectExtendAccessor(node);\n\n          if (customObj && state.nodeThreeObject === customObj) {\n            // clone object if it's a shared object among all nodes\n            customObj = customObj.clone();\n          }\n\n          var obj;\n\n          if (customObj && !extendObj) {\n            obj = customObj;\n          } else {\n            // Add default object (sphere mesh)\n            obj = new three.Mesh();\n            obj.__graphDefaultObj = true;\n\n            if (customObj && extendObj) {\n              obj.add(customObj); // extend default with custom\n            }\n          }\n\n          obj.__graphObjType = 'node'; // Add object type\n\n          return obj;\n        },\n        updateObj: function updateObj(obj, node) {\n          if (obj.__graphDefaultObj) {\n            // bypass internal updates for custom node objects\n            var val = valAccessor(node) || 1;\n            var radius = Math.cbrt(val) * state.nodeRelSize;\n            var numSegments = state.nodeResolution;\n\n            if (obj.geometry.type !== 'SphereBufferGeometry' || obj.geometry.parameters.radius !== radius || obj.geometry.parameters.widthSegments !== numSegments) {\n              if (!sphereGeometries.hasOwnProperty(val)) {\n                sphereGeometries[val] = new three.SphereBufferGeometry(radius, numSegments, numSegments);\n              }\n\n              obj.geometry.dispose();\n              obj.geometry = sphereGeometries[val];\n            }\n\n            var color = colorAccessor(node);\n            var materialColor = new three.Color(colorStr2Hex(color || '#ffffaa'));\n            var opacity = state.nodeOpacity * colorAlpha(color);\n\n            if (obj.material.type !== 'MeshLambertMaterial' || !obj.material.color.equals(materialColor) || obj.material.opacity !== opacity) {\n              if (!sphereMaterials.hasOwnProperty(color)) {\n                sphereMaterials[color] = new three.MeshLambertMaterial({\n                  color: materialColor,\n                  transparent: true,\n                  opacity: opacity\n                });\n              }\n\n              obj.material.dispose();\n              obj.material = sphereMaterials[color];\n            }\n          }\n        }\n      });\n    } // Digest links WebGL objects\n\n\n    if (state._flushObjects || hasAnyPropChanged(['graphData', 'linkThreeObject', 'linkThreeObjectExtend', 'linkMaterial', 'linkColor', 'linkWidth', 'linkVisibility', 'linkResolution', 'linkOpacity', 'linkDirectionalArrowLength', 'linkDirectionalArrowColor', 'linkDirectionalArrowResolution', 'linkDirectionalParticles', 'linkDirectionalParticleWidth', 'linkDirectionalParticleColor', 'linkDirectionalParticleResolution'])) {\n      var _customObjectAccessor = accessorFn(state.linkThreeObject);\n\n      var _customObjectExtendAccessor = accessorFn(state.linkThreeObjectExtend);\n\n      var customMaterialAccessor = accessorFn(state.linkMaterial);\n\n      var _visibilityAccessor = accessorFn(state.linkVisibility);\n\n      var _colorAccessor = accessorFn(state.linkColor);\n\n      var widthAccessor = accessorFn(state.linkWidth);\n      var cylinderGeometries = {}; // indexed by link width\n\n      var lambertLineMaterials = {}; // for cylinder objects, indexed by link color\n\n      var basicLineMaterials = {}; // for line objects, indexed by link color\n\n      var visibleLinks = state.graphData.links.filter(_visibilityAccessor); // lines digest cycle\n\n      threeDigest(visibleLinks, state.graphScene, {\n        objBindAttr: '__lineObj',\n        purge: state._flushObjects || hasAnyPropChanged([// recreate objects if any of these props have changed\n        'linkThreeObject', 'linkThreeObjectExtend', 'linkWidth']),\n        objFilter: function objFilter(obj) {\n          return obj.__graphObjType === 'link';\n        },\n        createObj: function createObj(link) {\n          var customObj = _customObjectAccessor(link);\n\n          var extendObj = _customObjectExtendAccessor(link);\n\n          if (customObj && state.linkThreeObject === customObj) {\n            // clone object if it's a shared object among all links\n            customObj = customObj.clone();\n          }\n\n          var defaultObj;\n\n          if (!customObj || extendObj) {\n            // construct default line obj\n            var useCylinder = !!widthAccessor(link);\n\n            if (useCylinder) {\n              defaultObj = new three.Mesh();\n            } else {\n              // Use plain line (constant width)\n              var lineGeometry = new three.BufferGeometry();\n              lineGeometry[setAttributeFn]('position', new three.BufferAttribute(new Float32Array(2 * 3), 3));\n              defaultObj = new three.Line(lineGeometry);\n            }\n          }\n\n          var obj;\n\n          if (!customObj) {\n            obj = defaultObj;\n            obj.__graphDefaultObj = true;\n          } else {\n            if (!extendObj) {\n              // use custom object\n              obj = customObj;\n            } else {\n              // extend default with custom in a group\n              obj = new three.Group();\n              obj.__graphDefaultObj = true;\n              obj.add(defaultObj);\n              obj.add(customObj);\n            }\n          }\n\n          obj.renderOrder = 10; // Prevent visual glitches of dark lines on top of nodes by rendering them last\n\n          obj.__graphObjType = 'link'; // Add object type\n\n          return obj;\n        },\n        updateObj: function updateObj(updObj, link) {\n          if (updObj.__graphDefaultObj) {\n            // bypass internal updates for custom link objects\n            // select default object if it's an extended group\n            var obj = updObj.children.length ? updObj.children[0] : updObj;\n            var linkWidth = Math.ceil(widthAccessor(link) * 10) / 10;\n            var useCylinder = !!linkWidth;\n\n            if (useCylinder) {\n              var r = linkWidth / 2;\n              var numSegments = state.linkResolution;\n\n              if (obj.geometry.type !== 'CylinderBufferGeometry' || obj.geometry.parameters.radiusTop !== r || obj.geometry.parameters.radialSegments !== numSegments) {\n                if (!cylinderGeometries.hasOwnProperty(linkWidth)) {\n                  var geometry = new three.CylinderBufferGeometry(r, r, 1, numSegments, 1, false);\n                  geometry[applyMatrix4Fn](new three.Matrix4().makeTranslation(0, 1 / 2, 0));\n                  geometry[applyMatrix4Fn](new three.Matrix4().makeRotationX(Math.PI / 2));\n                  cylinderGeometries[linkWidth] = geometry;\n                }\n\n                obj.geometry.dispose();\n                obj.geometry = cylinderGeometries[linkWidth];\n              }\n            }\n\n            var customMaterial = customMaterialAccessor(link);\n\n            if (customMaterial) {\n              obj.material = customMaterial;\n            } else {\n              var color = _colorAccessor(link);\n\n              var materialColor = new three.Color(colorStr2Hex(color || '#f0f0f0'));\n              var opacity = state.linkOpacity * colorAlpha(color);\n              var materialType = useCylinder ? 'MeshLambertMaterial' : 'LineBasicMaterial';\n\n              if (obj.material.type !== materialType || !obj.material.color.equals(materialColor) || obj.material.opacity !== opacity) {\n                var lineMaterials = useCylinder ? lambertLineMaterials : basicLineMaterials;\n\n                if (!lineMaterials.hasOwnProperty(color)) {\n                  lineMaterials[color] = new three[materialType]({\n                    color: materialColor,\n                    transparent: opacity < 1,\n                    opacity: opacity,\n                    depthWrite: opacity >= 1 // Prevent transparency issues\n\n                  });\n                }\n\n                obj.material.dispose();\n                obj.material = lineMaterials[color];\n              }\n            }\n          }\n        }\n      }); // Arrows digest cycle\n\n      if (state.linkDirectionalArrowLength || changedProps.hasOwnProperty('linkDirectionalArrowLength')) {\n        var arrowLengthAccessor = accessorFn(state.linkDirectionalArrowLength);\n        var arrowColorAccessor = accessorFn(state.linkDirectionalArrowColor);\n        threeDigest(visibleLinks.filter(arrowLengthAccessor), state.graphScene, {\n          objBindAttr: '__arrowObj',\n          objFilter: function objFilter(obj) {\n            return obj.__linkThreeObjType === 'arrow';\n          },\n          createObj: function createObj() {\n            var obj = new three.Mesh(undefined, new three.MeshLambertMaterial({\n              transparent: true\n            }));\n            obj.__linkThreeObjType = 'arrow'; // Add object type\n\n            return obj;\n          },\n          updateObj: function updateObj(obj, link) {\n            var arrowLength = arrowLengthAccessor(link);\n            var numSegments = state.linkDirectionalArrowResolution;\n\n            if (obj.geometry.type !== 'ConeBufferGeometry' || obj.geometry.parameters.height !== arrowLength || obj.geometry.parameters.radialSegments !== numSegments) {\n              var coneGeometry = new three.ConeBufferGeometry(arrowLength * 0.25, arrowLength, numSegments); // Correct orientation\n\n              coneGeometry.translate(0, arrowLength / 2, 0);\n              coneGeometry.rotateX(Math.PI / 2);\n              obj.geometry.dispose();\n              obj.geometry = coneGeometry;\n            }\n\n            obj.material.color = new three.Color(arrowColorAccessor(link) || _colorAccessor(link) || '#f0f0f0');\n            obj.material.opacity = state.linkOpacity * 3;\n          }\n        });\n      } // Photon particles digest cycle\n\n\n      if (state.linkDirectionalParticles || changedProps.hasOwnProperty('linkDirectionalParticles')) {\n        var particlesAccessor = accessorFn(state.linkDirectionalParticles);\n        var particleWidthAccessor = accessorFn(state.linkDirectionalParticleWidth);\n        var particleColorAccessor = accessorFn(state.linkDirectionalParticleColor);\n        var particleMaterials = {}; // indexed by link color\n\n        var particleGeometries = {}; // indexed by particle width\n\n        threeDigest(visibleLinks.filter(particlesAccessor), state.graphScene, {\n          objBindAttr: '__photonsObj',\n          objFilter: function objFilter(obj) {\n            return obj.__linkThreeObjType === 'photons';\n          },\n          createObj: function createObj() {\n            var obj = new three.Group();\n            obj.__linkThreeObjType = 'photons'; // Add object type\n\n            return obj;\n          },\n          updateObj: function updateObj(obj, link) {\n            var numPhotons = Math.round(Math.abs(particlesAccessor(link)));\n            var curPhoton = !!obj.children.length && obj.children[0];\n            var photonR = Math.ceil(particleWidthAccessor(link) * 10) / 10 / 2;\n            var numSegments = state.linkDirectionalParticleResolution;\n            var particleGeometry;\n\n            if (curPhoton && curPhoton.geometry.parameters.radius === photonR && curPhoton.geometry.parameters.widthSegments === numSegments) {\n              particleGeometry = curPhoton.geometry;\n            } else {\n              if (!particleGeometries.hasOwnProperty(photonR)) {\n                particleGeometries[photonR] = new three.SphereBufferGeometry(photonR, numSegments, numSegments);\n              }\n\n              particleGeometry = particleGeometries[photonR];\n              curPhoton && curPhoton.geometry.dispose();\n            }\n\n            var photonColor = particleColorAccessor(link) || _colorAccessor(link) || '#f0f0f0';\n            var materialColor = new three.Color(colorStr2Hex(photonColor));\n            var opacity = state.linkOpacity * 3;\n            var particleMaterial;\n\n            if (curPhoton && curPhoton.material.color.equals(materialColor) && curPhoton.material.opacity === opacity) {\n              particleMaterial = curPhoton.material;\n            } else {\n              if (!particleMaterials.hasOwnProperty(photonColor)) {\n                particleMaterials[photonColor] = new three.MeshLambertMaterial({\n                  color: materialColor,\n                  transparent: true,\n                  opacity: opacity\n                });\n              }\n\n              particleMaterial = particleMaterials[photonColor];\n              curPhoton && curPhoton.material.dispose();\n            } // digest cycle for each photon\n\n\n            threeDigest(_toConsumableArray(new Array(numPhotons)).map(function (_, idx) {\n              return {\n                idx: idx\n              };\n            }), obj, {\n              idAccessor: function idAccessor(d) {\n                return d.idx;\n              },\n              createObj: function createObj() {\n                return new three.Mesh(particleGeometry, particleMaterial);\n              },\n              updateObj: function updateObj(obj) {\n                obj.geometry = particleGeometry;\n                obj.material = particleMaterial;\n              }\n            });\n          }\n        });\n      }\n    }\n\n    state._flushObjects = false; // reset objects refresh flag\n    // simulation engine\n\n    if (hasAnyPropChanged(['graphData', 'nodeId', 'linkSource', 'linkTarget', 'numDimensions', 'forceEngine', 'dagMode', 'dagNodeFilter', 'dagLevelDistance'])) {\n      state.engineRunning = false; // Pause simulation\n      // parse links\n\n      state.graphData.links.forEach(function (link) {\n        link.source = link[state.linkSource];\n        link.target = link[state.linkTarget];\n      }); // Feed data to force-directed layout\n\n      var isD3Sim = state.forceEngine !== 'ngraph';\n      var layout;\n\n      if (isD3Sim) {\n        // D3-force\n        (layout = state.d3ForceLayout).stop().alpha(1) // re-heat the simulation\n        .numDimensions(state.numDimensions).nodes(state.graphData.nodes); // add links (if link force is still active)\n\n        var linkForce = state.d3ForceLayout.force('link');\n\n        if (linkForce) {\n          linkForce.id(function (d) {\n            return d[state.nodeId];\n          }).links(state.graphData.links);\n        } // setup dag force constraints\n\n\n        var nodeDepths = state.dagMode && getDagDepths(state.graphData, function (node) {\n          return node[state.nodeId];\n        }, {\n          nodeFilter: state.dagNodeFilter,\n          onLoopError: state.onDagError || undefined\n        });\n        var maxDepth = Math.max.apply(Math, _toConsumableArray(Object.values(nodeDepths || [])));\n        var dagLevelDistance = state.dagLevelDistance || state.graphData.nodes.length / (maxDepth || 1) * DAG_LEVEL_NODE_RATIO * (['radialin', 'radialout'].indexOf(state.dagMode) !== -1 ? 0.7 : 1); // Fix nodes to x,y,z for dag mode\n\n        if (state.dagMode) {\n          var getFFn = function getFFn(fix, invert) {\n            return function (node) {\n              return !fix ? undefined : (nodeDepths[node[state.nodeId]] - maxDepth / 2) * dagLevelDistance * (invert ? -1 : 1);\n            };\n          };\n\n          var fxFn = getFFn(['lr', 'rl'].indexOf(state.dagMode) !== -1, state.dagMode === 'rl');\n          var fyFn = getFFn(['td', 'bu'].indexOf(state.dagMode) !== -1, state.dagMode === 'td');\n          var fzFn = getFFn(['zin', 'zout'].indexOf(state.dagMode) !== -1, state.dagMode === 'zout');\n          state.graphData.nodes.filter(state.dagNodeFilter).forEach(function (node) {\n            node.fx = fxFn(node);\n            node.fy = fyFn(node);\n            node.fz = fzFn(node);\n          });\n        } // Use radial force for radial dags\n\n\n        state.d3ForceLayout.force('dagRadial', ['radialin', 'radialout'].indexOf(state.dagMode) !== -1 ? forceRadial(function (node) {\n          var nodeDepth = nodeDepths[node[state.nodeId]] || -1;\n          return (state.dagMode === 'radialin' ? maxDepth - nodeDepth : nodeDepth) * dagLevelDistance;\n        }).strength(function (node) {\n          return state.dagNodeFilter(node) ? 1 : 0;\n        }) : null);\n      } else {\n        // ngraph\n        var _graph = ngraph.graph();\n\n        state.graphData.nodes.forEach(function (node) {\n          _graph.addNode(node[state.nodeId]);\n        });\n        state.graphData.links.forEach(function (link) {\n          _graph.addLink(link.source, link.target);\n        });\n        layout = ngraph.forcelayout(_graph, _objectSpread2({\n          dimensions: state.numDimensions\n        }, state.ngraphPhysics));\n        layout.graph = _graph; // Attach graph reference to layout\n      }\n\n      for (var i = 0; i < state.warmupTicks && !(isD3Sim && state.d3AlphaMin > 0 && state.d3ForceLayout.alpha() < state.d3AlphaMin); i++) {\n        layout[isD3Sim ? \"tick\" : \"step\"]();\n      } // Initial ticks before starting to render\n\n\n      state.layout = layout;\n      this.resetCountdown();\n    }\n\n    state.engineRunning = true; // resume simulation\n\n    state.onFinishUpdate();\n  }\n});\n\nfunction fromKapsule(kapsule) {\n  var baseClass = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : Object;\n  var initKapsuleWithSelf = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n\n  var FromKapsule = /*#__PURE__*/function (_baseClass) {\n    _inherits(FromKapsule, _baseClass);\n\n    var _super = _createSuper(FromKapsule);\n\n    function FromKapsule() {\n      var _this;\n\n      _classCallCheck(this, FromKapsule);\n\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n\n      _this = _super.call.apply(_super, [this].concat(args));\n      _this.__kapsuleInstance = kapsule().apply(void 0, [].concat(_toConsumableArray(initKapsuleWithSelf ? [_assertThisInitialized(_this)] : []), args));\n      return _this;\n    }\n\n    return FromKapsule;\n  }(baseClass); // attach kapsule props/methods to class prototype\n\n\n  Object.keys(kapsule()).forEach(function (m) {\n    return FromKapsule.prototype[m] = function () {\n      var _this$__kapsuleInstan;\n\n      var returnVal = (_this$__kapsuleInstan = this.__kapsuleInstance)[m].apply(_this$__kapsuleInstan, arguments);\n\n      return returnVal === this.__kapsuleInstance ? this // chain based on this class, not the kapsule obj\n      : returnVal;\n    };\n  });\n  return FromKapsule;\n}\n\nvar three$1 = window.THREE ? window.THREE : {\n  Group: Group\n}; // Prefer consumption from global THREE, if exists\n\nvar threeForcegraph = fromKapsule(ForceGraph, three$1.Group, true);\nexport default threeForcegraph;","map":{"version":3,"sources":["/home/telix/dictographo/frontend/node_modules/three-forcegraph/dist/three-forcegraph.module.js"],"names":["Group","Mesh","MeshLambertMaterial","Color","BufferGeometry","BufferAttribute","Matrix4","Vector3","SphereBufferGeometry","CylinderBufferGeometry","TubeBufferGeometry","ConeBufferGeometry","Line","LineBasicMaterial","QuadraticBezierCurve3","CubicBezierCurve3","Box3","forceSimulation","forceLink","forceManyBody","forceCenter","forceRadial","graph","forcelayout","Kapsule","accessorFn","min","max","dataJoint","scaleOrdinal","schemePaired","tinyColor","_typeof","obj","Symbol","iterator","constructor","prototype","_classCallCheck","instance","Constructor","TypeError","_defineProperty","key","value","Object","defineProperty","enumerable","configurable","writable","ownKeys","object","enumerableOnly","keys","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","push","apply","_objectSpread2","target","i","arguments","length","source","forEach","getOwnPropertyDescriptors","defineProperties","_inherits","subClass","superClass","create","_setPrototypeOf","_getPrototypeOf","o","setPrototypeOf","getPrototypeOf","__proto__","p","_isNativeReflectConstruct","Reflect","construct","sham","Proxy","Date","toString","call","e","_construct","Parent","args","Class","a","Function","bind","_objectWithoutPropertiesLoose","excluded","sourceKeys","indexOf","_objectWithoutProperties","sourceSymbolKeys","propertyIsEnumerable","_assertThisInitialized","self","ReferenceError","_possibleConstructorReturn","_createSuper","Derived","hasNativeReflectConstruct","_createSuperInternal","Super","result","NewTarget","_slicedToArray","arr","_arrayWithHoles","_iterableToArrayLimit","_unsupportedIterableToArray","_nonIterableRest","_toConsumableArray","_arrayWithoutHoles","_iterableToArray","_nonIterableSpread","Array","isArray","_arrayLikeToArray","iter","from","_arr","_n","_d","_e","undefined","_i","_s","next","done","err","minLen","n","slice","name","test","len","arr2","materialDispose","material","map","dispose","deallocate","geometry","texture","children","emptyObject","childObj","remove","threeDigest","data","scene","_ref","_ref$objFilter","objFilter","options","add","objBindAttr","colorStr2Hex","str","isNaN","parseInt","toHex","colorAlpha","getAlpha","autoColorScale","autoColorObjects","objects","colorByAccessor","colorField","getDagDepths","idAccessor","nodes","links","_ref2","_ref2$nodeFilter","nodeFilter","_ref2$onLoopError","onLoopError","loopIds","concat","join","node","out","depth","skip","_ref3","sourceId","getNodeId","targetId","hasOwnProperty","sourceNode","targetNode","foundLoops","traverse","values","nodeDepths","assign","entries","_ref4","_ref5","_ref6","_ref7","id","nodeStack","currentDepth","l","_ret","loop","d","some","foundLoop","every","idx","three","window","THREE","ngraph","DAG_LEVEL_NODE_RATIO","setAttributeFn","setAttribute","applyMatrix4Fn","applyMatrix4","ForceGraph","props","jsonUrl","onChange","state","_this","fetchingJson","onLoading","fetch","then","r","json","onFinishLoading","graphData","triggerUpdate","console","info","engineRunning","numDimensions","numDim","chargeForce","d3ForceLayout","force","strength","eraseDimension","dim","dagMode","forceEngine","fx","fy","fz","dagLevelDistance","dagNodeFilter","_default","onDagError","nodeRelSize","nodeId","nodeVal","nodeResolution","nodeColor","nodeAutoColorBy","nodeOpacity","nodeVisibility","nodeThreeObject","nodeThreeObjectExtend","linkSource","linkTarget","linkVisibility","linkColor","linkAutoColorBy","linkOpacity","linkWidth","linkResolution","linkCurvature","linkCurveRotation","linkMaterial","linkThreeObject","linkThreeObjectExtend","linkPositionUpdate","linkDirectionalArrowLength","linkDirectionalArrowColor","linkDirectionalArrowRelPos","linkDirectionalArrowResolution","linkDirectionalParticles","linkDirectionalParticleSpeed","linkDirectionalParticleWidth","linkDirectionalParticleColor","linkDirectionalParticleResolution","d3AlphaMin","d3AlphaDecay","alphaDecay","d3AlphaTarget","alphaTarget","d3VelocityDecay","velocityDecay","ngraphPhysics","timeStep","gravity","theta","springLength","springCoefficient","dragCoefficient","warmupTicks","cooldownTicks","Infinity","cooldownTime","onUpdate","onFinishUpdate","onEngineTick","onEngineStop","methods","refresh","_flushObjects","_rerender","d3Force","forceName","forceFn","d3ReheatSimulation","alpha","resetCountdown","cntTicks","startTickTime","tickFrame","isD3Sim","layoutTick","updateArrows","updatePhotons","layout","__threeObj","pos","getNodePosition","position","x","y","z","linkWidthAccessor","linkCurvatureAccessor","linkCurveRotationAccessor","linkThreeObjectExtendAccessor","link","lineObj","__lineObj","getLinkPosition","getLink","start","end","calcLinkCurve","extendedObj","curveResolution","curve","__curve","line","type","linePos","getAttribute","array","Float32Array","needsUpdate","setFromPoints","getPoints","computeBoundingSphere","Math","ceil","makeTranslation","makeRotationX","PI","vStart","vEnd","distance","distanceTo","scale","parent","localToWorld","lookAt","set","rotation","_linkWidth","_r","_geometry","curvature","curveRotation","dx","dy","vLine","subVectors","cp","clone","multiplyScalar","cross","applyAxisAngle","normalize","addVectors","divideScalar","endAngle","startAngle","cos","sin","arrowRelPosAccessor","arrowLengthAccessor","nodeValAccessor","arrowObj","__arrowObj","startR","sqrt","endR","arrowLength","arrowRelPos","getPosAlongLine","t","getPoint","iplt","lineLen","getLength","pow","reduce","acc","v","posAlongLine","arrowHead","arrowTail","headVec","c","particleSpeedAccessor","cyclePhotons","__photonsObj","singleHopPhotons","__singleHopPhotonsObj","particleSpeed","getPhotonPos","photons","photon","singleHop","__linkThreeObjType","__progressRatio","photonPosRatio","emitParticle","graphScene","particleWidthAccessor","photonR","numSegments","particleGeometry","linkColorAccessor","particleColorAccessor","photonColor","materialColor","opacity","particleMaterial","color","transparent","getGraphBbox","initialised","bboxes","getBboxes","computeBoundingBox","box","copy","boundingBox","matrixWorld","__graphObjType","__data","bb","stateInit","stop","init","threeObj","update","changedProps","hasAnyPropChanged","propList","customObjectAccessor","customObjectExtendAccessor","valAccessor","colorAccessor","visibilityAccessor","sphereGeometries","sphereMaterials","purge","createObj","customObj","extendObj","__graphDefaultObj","updateObj","val","radius","cbrt","parameters","widthSegments","equals","_customObjectAccessor","_customObjectExtendAccessor","customMaterialAccessor","_visibilityAccessor","_colorAccessor","widthAccessor","cylinderGeometries","lambertLineMaterials","basicLineMaterials","visibleLinks","defaultObj","useCylinder","lineGeometry","renderOrder","updObj","radiusTop","radialSegments","customMaterial","materialType","lineMaterials","depthWrite","arrowColorAccessor","height","coneGeometry","translate","rotateX","particlesAccessor","particleMaterials","particleGeometries","numPhotons","round","abs","curPhoton","_","linkForce","maxDepth","getFFn","fix","invert","fxFn","fyFn","fzFn","nodeDepth","_graph","addNode","addLink","dimensions","fromKapsule","kapsule","baseClass","initKapsuleWithSelf","FromKapsule","_baseClass","_super","_len","_key","__kapsuleInstance","m","_this$__kapsuleInstan","returnVal","three$1","threeForcegraph"],"mappings":"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","sourcesContent":["import { Group, Mesh, MeshLambertMaterial, Color, BufferGeometry, BufferAttribute, Matrix4, Vector3, SphereBufferGeometry, CylinderBufferGeometry, TubeBufferGeometry, ConeBufferGeometry, Line, LineBasicMaterial, QuadraticBezierCurve3, CubicBezierCurve3, Box3 } from 'three';\nimport { forceSimulation, forceLink, forceManyBody, forceCenter, forceRadial } from 'd3-force-3d';\nimport graph from 'ngraph.graph';\nimport forcelayout from 'ngraph.forcelayout';\nimport Kapsule from 'kapsule';\nimport accessorFn from 'accessor-fn';\nimport { min, max } from 'd3-array';\nimport dataJoint from 'data-joint';\nimport { scaleOrdinal } from 'd3-scale';\nimport { schemePaired } from 'd3-scale-chromatic';\nimport tinyColor from 'tinycolor2';\n\nfunction _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") {\n    _typeof = function (obj) {\n      return typeof obj;\n    };\n  } else {\n    _typeof = function (obj) {\n      return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n    };\n  }\n\n  return _typeof(obj);\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    if (enumerableOnly) symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    });\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread2(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      ownKeys(Object(source), true).forEach(function (key) {\n        _defineProperty(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(Object(source)).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n\n  return target;\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) _setPrototypeOf(subClass, superClass);\n}\n\nfunction _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}\n\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}\n\nfunction _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n\n  try {\n    Date.prototype.toString.call(Reflect.construct(Date, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\nfunction _construct(Parent, args, Class) {\n  if (_isNativeReflectConstruct()) {\n    _construct = Reflect.construct;\n  } else {\n    _construct = function _construct(Parent, args, Class) {\n      var a = [null];\n      a.push.apply(a, args);\n      var Constructor = Function.bind.apply(Parent, a);\n      var instance = new Constructor();\n      if (Class) _setPrototypeOf(instance, Class.prototype);\n      return instance;\n    };\n  }\n\n  return _construct.apply(null, arguments);\n}\n\nfunction _objectWithoutPropertiesLoose(source, excluded) {\n  if (source == null) return {};\n  var target = {};\n  var sourceKeys = Object.keys(source);\n  var key, i;\n\n  for (i = 0; i < sourceKeys.length; i++) {\n    key = sourceKeys[i];\n    if (excluded.indexOf(key) >= 0) continue;\n    target[key] = source[key];\n  }\n\n  return target;\n}\n\nfunction _objectWithoutProperties(source, excluded) {\n  if (source == null) return {};\n\n  var target = _objectWithoutPropertiesLoose(source, excluded);\n\n  var key, i;\n\n  if (Object.getOwnPropertySymbols) {\n    var sourceSymbolKeys = Object.getOwnPropertySymbols(source);\n\n    for (i = 0; i < sourceSymbolKeys.length; i++) {\n      key = sourceSymbolKeys[i];\n      if (excluded.indexOf(key) >= 0) continue;\n      if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;\n      target[key] = source[key];\n    }\n  }\n\n  return target;\n}\n\nfunction _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (call && (typeof call === \"object\" || typeof call === \"function\")) {\n    return call;\n  }\n\n  return _assertThisInitialized(self);\n}\n\nfunction _createSuper(Derived) {\n  var hasNativeReflectConstruct = _isNativeReflectConstruct();\n\n  return function _createSuperInternal() {\n    var Super = _getPrototypeOf(Derived),\n        result;\n\n    if (hasNativeReflectConstruct) {\n      var NewTarget = _getPrototypeOf(this).constructor;\n\n      result = Reflect.construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n\n    return _possibleConstructorReturn(this, result);\n  };\n}\n\nfunction _slicedToArray(arr, i) {\n  return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest();\n}\n\nfunction _toConsumableArray(arr) {\n  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread();\n}\n\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) return _arrayLikeToArray(arr);\n}\n\nfunction _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}\n\nfunction _iterableToArray(iter) {\n  if (typeof Symbol !== \"undefined\" && Symbol.iterator in Object(iter)) return Array.from(iter);\n}\n\nfunction _iterableToArrayLimit(arr, i) {\n  if (typeof Symbol === \"undefined\" || !(Symbol.iterator in Object(arr))) return;\n  var _arr = [];\n  var _n = true;\n  var _d = false;\n  var _e = undefined;\n\n  try {\n    for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {\n      _arr.push(_s.value);\n\n      if (i && _arr.length === i) break;\n    }\n  } catch (err) {\n    _d = true;\n    _e = err;\n  } finally {\n    try {\n      if (!_n && _i[\"return\"] != null) _i[\"return\"]();\n    } finally {\n      if (_d) throw _e;\n    }\n  }\n\n  return _arr;\n}\n\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n}\n\nfunction _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n\n  for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];\n\n  return arr2;\n}\n\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nfunction _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nvar materialDispose = function materialDispose(material) {\n  if (material instanceof Array) {\n    material.forEach(materialDispose);\n  } else {\n    if (material.map) {\n      material.map.dispose();\n    }\n\n    material.dispose();\n  }\n};\n\nvar deallocate = function deallocate(obj) {\n  if (obj.geometry) {\n    obj.geometry.dispose();\n  }\n\n  if (obj.material) {\n    materialDispose(obj.material);\n  }\n\n  if (obj.texture) {\n    obj.texture.dispose();\n  }\n\n  if (obj.children) {\n    obj.children.forEach(deallocate);\n  }\n};\n\nvar emptyObject = function emptyObject(obj) {\n  while (obj.children.length) {\n    var childObj = obj.children[0];\n    obj.remove(childObj);\n    deallocate(childObj);\n  }\n};\n\nfunction threeDigest(data, scene) {\n  var _ref = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n\n  var _ref$objFilter = _ref.objFilter,\n      objFilter = _ref$objFilter === void 0 ? function () {\n    return true;\n  } : _ref$objFilter,\n      options = _objectWithoutProperties(_ref, [\"objFilter\"]);\n\n  return dataJoint(data, scene.children.filter(objFilter), function (obj) {\n    return scene.add(obj);\n  }, function (obj) {\n    scene.remove(obj);\n    emptyObject(obj);\n  }, _objectSpread2({\n    objBindAttr: '__threeObj'\n  }, options));\n}\n\nvar colorStr2Hex = function colorStr2Hex(str) {\n  return isNaN(str) ? parseInt(tinyColor(str).toHex(), 16) : str;\n};\n\nvar colorAlpha = function colorAlpha(str) {\n  return isNaN(str) ? tinyColor(str).getAlpha() : 1;\n};\n\nvar autoColorScale = scaleOrdinal(schemePaired); // Autoset attribute colorField by colorByAccessor property\n// If an object has already a color, don't set it\n// Objects can be nodes or links\n\nfunction autoColorObjects(objects, colorByAccessor, colorField) {\n  if (!colorByAccessor || typeof colorField !== 'string') return;\n  objects.filter(function (obj) {\n    return !obj[colorField];\n  }).forEach(function (obj) {\n    obj[colorField] = autoColorScale(colorByAccessor(obj));\n  });\n}\n\nfunction getDagDepths (_ref, idAccessor) {\n  var nodes = _ref.nodes,\n      links = _ref.links;\n\n  var _ref2 = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {},\n      _ref2$nodeFilter = _ref2.nodeFilter,\n      nodeFilter = _ref2$nodeFilter === void 0 ? function () {\n    return true;\n  } : _ref2$nodeFilter,\n      _ref2$onLoopError = _ref2.onLoopError,\n      onLoopError = _ref2$onLoopError === void 0 ? function (loopIds) {\n    throw \"Invalid DAG structure! Found cycle in node path: \".concat(loopIds.join(' -> '), \".\");\n  } : _ref2$onLoopError;\n\n  // linked graph\n  var graph = {};\n  nodes.forEach(function (node) {\n    return graph[idAccessor(node)] = {\n      data: node,\n      out: [],\n      depth: -1,\n      skip: !nodeFilter(node)\n    };\n  });\n  links.forEach(function (_ref3) {\n    var source = _ref3.source,\n        target = _ref3.target;\n    var sourceId = getNodeId(source);\n    var targetId = getNodeId(target);\n    if (!graph.hasOwnProperty(sourceId)) throw \"Missing source node with id: \".concat(sourceId);\n    if (!graph.hasOwnProperty(targetId)) throw \"Missing target node with id: \".concat(targetId);\n    var sourceNode = graph[sourceId];\n    var targetNode = graph[targetId];\n    sourceNode.out.push(targetNode);\n\n    function getNodeId(node) {\n      return _typeof(node) === 'object' ? idAccessor(node) : node;\n    }\n  });\n  var foundLoops = [];\n  traverse(Object.values(graph));\n  var nodeDepths = Object.assign.apply(Object, [{}].concat(_toConsumableArray(Object.entries(graph).filter(function (_ref4) {\n    var _ref5 = _slicedToArray(_ref4, 2),\n        node = _ref5[1];\n\n    return !node.skip;\n  }).map(function (_ref6) {\n    var _ref7 = _slicedToArray(_ref6, 2),\n        id = _ref7[0],\n        node = _ref7[1];\n\n    return _defineProperty({}, id, node.depth);\n  }))));\n  return nodeDepths;\n\n  function traverse(nodes) {\n    var nodeStack = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];\n    var currentDepth = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n\n    for (var i = 0, l = nodes.length; i < l; i++) {\n      var node = nodes[i];\n\n      if (nodeStack.indexOf(node) !== -1) {\n        var _ret = function () {\n          var loop = [].concat(_toConsumableArray(nodeStack.slice(nodeStack.indexOf(node))), [node]).map(function (d) {\n            return idAccessor(d.data);\n          });\n\n          if (!foundLoops.some(function (foundLoop) {\n            return foundLoop.length === loop.length && foundLoop.every(function (id, idx) {\n              return id === loop[idx];\n            });\n          })) {\n            foundLoops.push(loop);\n            onLoopError(loop);\n          }\n\n          return \"continue\";\n        }();\n\n        if (_ret === \"continue\") continue;\n      }\n\n      if (currentDepth > node.depth) {\n        // Don't unnecessarily revisit chunks of the graph\n        node.depth = currentDepth;\n        traverse(node.out, [].concat(_toConsumableArray(nodeStack), [node]), currentDepth + (node.skip ? 0 : 1));\n      }\n    }\n  }\n}\n\nvar three = window.THREE ? window.THREE // Prefer consumption from global THREE, if exists\n: {\n  Group: Group,\n  Mesh: Mesh,\n  MeshLambertMaterial: MeshLambertMaterial,\n  Color: Color,\n  BufferGeometry: BufferGeometry,\n  BufferAttribute: BufferAttribute,\n  Matrix4: Matrix4,\n  Vector3: Vector3,\n  SphereBufferGeometry: SphereBufferGeometry,\n  CylinderBufferGeometry: CylinderBufferGeometry,\n  TubeBufferGeometry: TubeBufferGeometry,\n  ConeBufferGeometry: ConeBufferGeometry,\n  Line: Line,\n  LineBasicMaterial: LineBasicMaterial,\n  QuadraticBezierCurve3: QuadraticBezierCurve3,\n  CubicBezierCurve3: CubicBezierCurve3,\n  Box3: Box3\n};\nvar ngraph = {\n  graph: graph,\n  forcelayout: forcelayout\n};\n\nvar DAG_LEVEL_NODE_RATIO = 2; // support multiple method names for backwards threejs compatibility\n\nvar setAttributeFn = new three.BufferGeometry().setAttribute ? 'setAttribute' : 'addAttribute';\nvar applyMatrix4Fn = new three.BufferGeometry().applyMatrix4 ? 'applyMatrix4' : 'applyMatrix';\nvar ForceGraph = Kapsule({\n  props: {\n    jsonUrl: {\n      onChange: function onChange(jsonUrl, state) {\n        var _this = this;\n\n        if (jsonUrl && !state.fetchingJson) {\n          // Load data asynchronously\n          state.fetchingJson = true;\n          state.onLoading();\n          fetch(jsonUrl).then(function (r) {\n            return r.json();\n          }).then(function (json) {\n            state.fetchingJson = false;\n            state.onFinishLoading(json);\n\n            _this.graphData(json);\n          });\n        }\n      },\n      triggerUpdate: false\n    },\n    graphData: {\n      \"default\": {\n        nodes: [],\n        links: []\n      },\n      onChange: function onChange(graphData, state) {\n        if (graphData.nodes.length || graphData.links.length) {\n          console.info('force-graph loading', graphData.nodes.length + ' nodes', graphData.links.length + ' links');\n        }\n\n        state.engineRunning = false; // Pause simulation immediately\n      }\n    },\n    numDimensions: {\n      \"default\": 3,\n      onChange: function onChange(numDim, state) {\n        var chargeForce = state.d3ForceLayout.force('charge'); // Increase repulsion on 3D mode for improved spatial separation\n\n        if (chargeForce) {\n          chargeForce.strength(numDim > 2 ? -60 : -30);\n        }\n\n        if (numDim < 3) {\n          eraseDimension(state.graphData.nodes, 'z');\n        }\n\n        if (numDim < 2) {\n          eraseDimension(state.graphData.nodes, 'y');\n        }\n\n        function eraseDimension(nodes, dim) {\n          nodes.forEach(function (d) {\n            delete d[dim]; // position\n\n            delete d[\"v\".concat(dim)]; // velocity\n          });\n        }\n      }\n    },\n    dagMode: {\n      onChange: function onChange(dagMode, state) {\n        // td, bu, lr, rl, zin, zout, radialin, radialout\n        !dagMode && state.forceEngine === 'd3' && (state.graphData.nodes || []).forEach(function (n) {\n          return n.fx = n.fy = n.fz = undefined;\n        }); // unfix nodes when disabling dag mode\n      }\n    },\n    dagLevelDistance: {},\n    dagNodeFilter: {\n      \"default\": function _default(node) {\n        return true;\n      }\n    },\n    onDagError: {\n      triggerUpdate: false\n    },\n    nodeRelSize: {\n      \"default\": 4\n    },\n    // volume per val unit\n    nodeId: {\n      \"default\": 'id'\n    },\n    nodeVal: {\n      \"default\": 'val'\n    },\n    nodeResolution: {\n      \"default\": 8\n    },\n    // how many slice segments in the sphere's circumference\n    nodeColor: {\n      \"default\": 'color'\n    },\n    nodeAutoColorBy: {},\n    nodeOpacity: {\n      \"default\": 0.75\n    },\n    nodeVisibility: {\n      \"default\": true\n    },\n    nodeThreeObject: {},\n    nodeThreeObjectExtend: {\n      \"default\": false\n    },\n    linkSource: {\n      \"default\": 'source'\n    },\n    linkTarget: {\n      \"default\": 'target'\n    },\n    linkVisibility: {\n      \"default\": true\n    },\n    linkColor: {\n      \"default\": 'color'\n    },\n    linkAutoColorBy: {},\n    linkOpacity: {\n      \"default\": 0.2\n    },\n    linkWidth: {},\n    // Rounded to nearest decimal. For falsy values use dimensionless line with 1px regardless of distance.\n    linkResolution: {\n      \"default\": 6\n    },\n    // how many radial segments in each line tube's geometry\n    linkCurvature: {\n      \"default\": 0,\n      triggerUpdate: false\n    },\n    // line curvature radius (0: straight, 1: semi-circle)\n    linkCurveRotation: {\n      \"default\": 0,\n      triggerUpdate: false\n    },\n    // line curve rotation along the line axis (0: interection with XY plane, PI: upside down)\n    linkMaterial: {},\n    linkThreeObject: {},\n    linkThreeObjectExtend: {\n      \"default\": false\n    },\n    linkPositionUpdate: {\n      triggerUpdate: false\n    },\n    // custom function to call for updating the link's position. Signature: (threeObj, { start: { x, y, z},  end: { x, y, z }}, link). If the function returns a truthy value, the regular link position update will not run.\n    linkDirectionalArrowLength: {\n      \"default\": 0\n    },\n    linkDirectionalArrowColor: {},\n    linkDirectionalArrowRelPos: {\n      \"default\": 0.5,\n      triggerUpdate: false\n    },\n    // value between 0<>1 indicating the relative pos along the (exposed) line\n    linkDirectionalArrowResolution: {\n      \"default\": 8\n    },\n    // how many slice segments in the arrow's conic circumference\n    linkDirectionalParticles: {\n      \"default\": 0\n    },\n    // animate photons travelling in the link direction\n    linkDirectionalParticleSpeed: {\n      \"default\": 0.01,\n      triggerUpdate: false\n    },\n    // in link length ratio per frame\n    linkDirectionalParticleWidth: {\n      \"default\": 0.5\n    },\n    linkDirectionalParticleColor: {},\n    linkDirectionalParticleResolution: {\n      \"default\": 4\n    },\n    // how many slice segments in the particle sphere's circumference\n    forceEngine: {\n      \"default\": 'd3'\n    },\n    // d3 or ngraph\n    d3AlphaMin: {\n      \"default\": 0,\n      triggerUpdate: false\n    },\n    d3AlphaDecay: {\n      \"default\": 0.0228,\n      triggerUpdate: false,\n      onChange: function onChange(alphaDecay, state) {\n        state.d3ForceLayout.alphaDecay(alphaDecay);\n      }\n    },\n    d3AlphaTarget: {\n      \"default\": 0,\n      triggerUpdate: false,\n      onChange: function onChange(alphaTarget, state) {\n        state.d3ForceLayout.alphaTarget(alphaTarget);\n      }\n    },\n    d3VelocityDecay: {\n      \"default\": 0.4,\n      triggerUpdate: false,\n      onChange: function onChange(velocityDecay, state) {\n        state.d3ForceLayout.velocityDecay(velocityDecay);\n      }\n    },\n    ngraphPhysics: {\n      \"default\": {\n        // defaults from https://github.com/anvaka/ngraph.physics.simulator/blob/master/index.js\n        timeStep: 20,\n        gravity: -1.2,\n        theta: 0.8,\n        springLength: 30,\n        springCoefficient: 0.0008,\n        dragCoefficient: 0.02\n      }\n    },\n    warmupTicks: {\n      \"default\": 0,\n      triggerUpdate: false\n    },\n    // how many times to tick the force engine at init before starting to render\n    cooldownTicks: {\n      \"default\": Infinity,\n      triggerUpdate: false\n    },\n    cooldownTime: {\n      \"default\": 15000,\n      triggerUpdate: false\n    },\n    // ms\n    onLoading: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onFinishLoading: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onUpdate: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onFinishUpdate: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onEngineTick: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onEngineStop: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    }\n  },\n  methods: {\n    refresh: function refresh(state) {\n      state._flushObjects = true;\n\n      state._rerender();\n\n      return this;\n    },\n    // Expose d3 forces for external manipulation\n    d3Force: function d3Force(state, forceName, forceFn) {\n      if (forceFn === undefined) {\n        return state.d3ForceLayout.force(forceName); // Force getter\n      }\n\n      state.d3ForceLayout.force(forceName, forceFn); // Force setter\n\n      return this;\n    },\n    d3ReheatSimulation: function d3ReheatSimulation(state) {\n      state.d3ForceLayout.alpha(1);\n      this.resetCountdown();\n      return this;\n    },\n    // reset cooldown state\n    resetCountdown: function resetCountdown(state) {\n      state.cntTicks = 0;\n      state.startTickTime = new Date();\n      state.engineRunning = true;\n      return this;\n    },\n    tickFrame: function tickFrame(state) {\n      var isD3Sim = state.forceEngine !== 'ngraph';\n\n      if (state.engineRunning) {\n        layoutTick();\n      }\n\n      updateArrows();\n      updatePhotons();\n      return this; //\n\n      function layoutTick() {\n        if (++state.cntTicks > state.cooldownTicks || new Date() - state.startTickTime > state.cooldownTime || isD3Sim && state.d3AlphaMin > 0 && state.d3ForceLayout.alpha() < state.d3AlphaMin) {\n          state.engineRunning = false; // Stop ticking graph\n\n          state.onEngineStop();\n        } else {\n          state.layout[isD3Sim ? 'tick' : 'step'](); // Tick it\n\n          state.onEngineTick();\n        } // Update nodes position\n\n\n        state.graphData.nodes.forEach(function (node) {\n          var obj = node.__threeObj;\n          if (!obj) return;\n          var pos = isD3Sim ? node : state.layout.getNodePosition(node[state.nodeId]);\n          obj.position.x = pos.x;\n          obj.position.y = pos.y || 0;\n          obj.position.z = pos.z || 0;\n        }); // Update links position\n\n        var linkWidthAccessor = accessorFn(state.linkWidth);\n        var linkCurvatureAccessor = accessorFn(state.linkCurvature);\n        var linkCurveRotationAccessor = accessorFn(state.linkCurveRotation);\n        var linkThreeObjectExtendAccessor = accessorFn(state.linkThreeObjectExtend);\n        state.graphData.links.forEach(function (link) {\n          var lineObj = link.__lineObj;\n          if (!lineObj) return;\n          var pos = isD3Sim ? link : state.layout.getLinkPosition(state.layout.graph.getLink(link.source, link.target).id);\n          var start = pos[isD3Sim ? 'source' : 'from'];\n          var end = pos[isD3Sim ? 'target' : 'to'];\n          if (!start || !end || !start.hasOwnProperty('x') || !end.hasOwnProperty('x')) return; // skip invalid link\n\n          calcLinkCurve(link); // calculate link curve for all links, including custom replaced, so it can be used in directional functionality\n\n          var extendedObj = linkThreeObjectExtendAccessor(link);\n\n          if (state.linkPositionUpdate && state.linkPositionUpdate(extendedObj ? lineObj.children[1] : lineObj, // pass child custom object if extending the default\n          {\n            start: {\n              x: start.x,\n              y: start.y,\n              z: start.z\n            },\n            end: {\n              x: end.x,\n              y: end.y,\n              z: end.z\n            }\n          }, link) && !extendedObj) {\n            // exit if successfully custom updated position of non-extended obj\n            return;\n          }\n\n          var curveResolution = 30; // # line segments\n\n          var curve = link.__curve; // select default line obj if it's an extended group\n\n          var line = lineObj.children.length ? lineObj.children[0] : lineObj;\n\n          if (line.type === 'Line') {\n            // Update line geometry\n            if (!curve) {\n              // straight line\n              var linePos = line.geometry.getAttribute('position');\n\n              if (!linePos || !linePos.array || linePos.array.length !== 6) {\n                line.geometry[setAttributeFn]('position', linePos = new three.BufferAttribute(new Float32Array(2 * 3), 3));\n              }\n\n              linePos.array[0] = start.x;\n              linePos.array[1] = start.y || 0;\n              linePos.array[2] = start.z || 0;\n              linePos.array[3] = end.x;\n              linePos.array[4] = end.y || 0;\n              linePos.array[5] = end.z || 0;\n              linePos.needsUpdate = true;\n            } else {\n              // bezier curve line\n              line.geometry.setFromPoints(curve.getPoints(curveResolution));\n            }\n\n            line.geometry.computeBoundingSphere();\n          } else if (line.type === 'Mesh') {\n            // Update cylinder geometry\n            if (!curve) {\n              // straight tube\n              if (line.geometry.type !== 'CylinderBufferGeometry') {\n                var linkWidth = Math.ceil(linkWidthAccessor(link) * 10) / 10;\n                var r = linkWidth / 2;\n                var geometry = new three.CylinderBufferGeometry(r, r, 1, state.linkResolution, 1, false);\n                geometry[applyMatrix4Fn](new three.Matrix4().makeTranslation(0, 1 / 2, 0));\n                geometry[applyMatrix4Fn](new three.Matrix4().makeRotationX(Math.PI / 2));\n                line.geometry.dispose();\n                line.geometry = geometry;\n              }\n\n              var vStart = new three.Vector3(start.x, start.y || 0, start.z || 0);\n              var vEnd = new three.Vector3(end.x, end.y || 0, end.z || 0);\n              var distance = vStart.distanceTo(vEnd);\n              line.position.x = vStart.x;\n              line.position.y = vStart.y;\n              line.position.z = vStart.z;\n              line.scale.z = distance;\n              line.parent.localToWorld(vEnd); // lookAt requires world coords\n\n              line.lookAt(vEnd);\n            } else {\n              // curved tube\n              if (line.geometry.type !== 'TubeBufferGeometry') {\n                // reset object positioning\n                line.position.set(0, 0, 0);\n                line.rotation.set(0, 0, 0);\n                line.scale.set(1, 1, 1);\n              }\n\n              var _linkWidth = Math.ceil(linkWidthAccessor(link) * 10) / 10;\n\n              var _r = _linkWidth / 2;\n\n              var _geometry = new three.TubeBufferGeometry(curve, curveResolution, _r, state.linkResolution, false);\n\n              line.geometry.dispose();\n              line.geometry = _geometry;\n            }\n          }\n        }); //\n\n        function calcLinkCurve(link) {\n          var pos = isD3Sim ? link : state.layout.getLinkPosition(state.layout.graph.getLink(link.source, link.target).id);\n          var start = pos[isD3Sim ? 'source' : 'from'];\n          var end = pos[isD3Sim ? 'target' : 'to'];\n          if (!start || !end || !start.hasOwnProperty('x') || !end.hasOwnProperty('x')) return; // skip invalid link\n\n          var curvature = linkCurvatureAccessor(link);\n\n          if (!curvature) {\n            link.__curve = null; // Straight line\n          } else {\n            // bezier curve line (only for line types)\n            var vStart = new three.Vector3(start.x, start.y || 0, start.z || 0);\n            var vEnd = new three.Vector3(end.x, end.y || 0, end.z || 0);\n            var l = vStart.distanceTo(vEnd); // line length\n\n            var curve;\n            var curveRotation = linkCurveRotationAccessor(link);\n\n            if (l > 0) {\n              var dx = end.x - start.x;\n              var dy = end.y - start.y || 0;\n              var vLine = new three.Vector3().subVectors(vEnd, vStart);\n              var cp = vLine.clone().multiplyScalar(curvature).cross(dx !== 0 || dy !== 0 ? new three.Vector3(0, 0, 1) : new three.Vector3(0, 1, 0)) // avoid cross-product of parallel vectors (prefer Z, fallback to Y)\n              .applyAxisAngle(vLine.normalize(), curveRotation) // rotate along line axis according to linkCurveRotation\n              .add(new three.Vector3().addVectors(vStart, vEnd).divideScalar(2));\n              curve = new three.QuadraticBezierCurve3(vStart, cp, vEnd);\n            } else {\n              // Same point, draw a loop\n              var d = curvature * 70;\n              var endAngle = -curveRotation; // Rotate clockwise (from Z angle perspective)\n\n              var startAngle = endAngle + Math.PI / 2;\n              curve = new three.CubicBezierCurve3(vStart, new three.Vector3(d * Math.cos(startAngle), d * Math.sin(startAngle), 0).add(vStart), new three.Vector3(d * Math.cos(endAngle), d * Math.sin(endAngle), 0).add(vStart), vEnd);\n            }\n\n            link.__curve = curve;\n          }\n        }\n      }\n\n      function updateArrows() {\n        // update link arrow position\n        var arrowRelPosAccessor = accessorFn(state.linkDirectionalArrowRelPos);\n        var arrowLengthAccessor = accessorFn(state.linkDirectionalArrowLength);\n        var nodeValAccessor = accessorFn(state.nodeVal);\n        state.graphData.links.forEach(function (link) {\n          var arrowObj = link.__arrowObj;\n          if (!arrowObj) return;\n          var pos = isD3Sim ? link : state.layout.getLinkPosition(state.layout.graph.getLink(link.source, link.target).id);\n          var start = pos[isD3Sim ? 'source' : 'from'];\n          var end = pos[isD3Sim ? 'target' : 'to'];\n          if (!start || !end || !start.hasOwnProperty('x') || !end.hasOwnProperty('x')) return; // skip invalid link\n\n          var startR = Math.sqrt(Math.max(0, nodeValAccessor(start) || 1)) * state.nodeRelSize;\n          var endR = Math.sqrt(Math.max(0, nodeValAccessor(end) || 1)) * state.nodeRelSize;\n          var arrowLength = arrowLengthAccessor(link);\n          var arrowRelPos = arrowRelPosAccessor(link);\n          var getPosAlongLine = link.__curve ? function (t) {\n            return link.__curve.getPoint(t);\n          } // interpolate along bezier curve\n          : function (t) {\n            // straight line: interpolate linearly\n            var iplt = function iplt(dim, start, end, t) {\n              return start[dim] + (end[dim] - start[dim]) * t || 0;\n            };\n\n            return {\n              x: iplt('x', start, end, t),\n              y: iplt('y', start, end, t),\n              z: iplt('z', start, end, t)\n            };\n          };\n          var lineLen = link.__curve ? link.__curve.getLength() : Math.sqrt(['x', 'y', 'z'].map(function (dim) {\n            return Math.pow((end[dim] || 0) - (start[dim] || 0), 2);\n          }).reduce(function (acc, v) {\n            return acc + v;\n          }, 0));\n          var posAlongLine = startR + arrowLength + (lineLen - startR - endR - arrowLength) * arrowRelPos;\n          var arrowHead = getPosAlongLine(posAlongLine / lineLen);\n          var arrowTail = getPosAlongLine((posAlongLine - arrowLength) / lineLen);\n          ['x', 'y', 'z'].forEach(function (dim) {\n            return arrowObj.position[dim] = arrowTail[dim];\n          });\n\n          var headVec = _construct(three.Vector3, _toConsumableArray(['x', 'y', 'z'].map(function (c) {\n            return arrowHead[c];\n          })));\n\n          arrowObj.parent.localToWorld(headVec); // lookAt requires world coords\n\n          arrowObj.lookAt(headVec);\n        });\n      }\n\n      function updatePhotons() {\n        // update link particle positions\n        var particleSpeedAccessor = accessorFn(state.linkDirectionalParticleSpeed);\n        state.graphData.links.forEach(function (link) {\n          var cyclePhotons = link.__photonsObj && link.__photonsObj.children;\n          var singleHopPhotons = link.__singleHopPhotonsObj && link.__singleHopPhotonsObj.children;\n          if ((!singleHopPhotons || !singleHopPhotons.length) && (!cyclePhotons || !cyclePhotons.length)) return;\n          var pos = isD3Sim ? link : state.layout.getLinkPosition(state.layout.graph.getLink(link.source, link.target).id);\n          var start = pos[isD3Sim ? 'source' : 'from'];\n          var end = pos[isD3Sim ? 'target' : 'to'];\n          if (!start || !end || !start.hasOwnProperty('x') || !end.hasOwnProperty('x')) return; // skip invalid link\n\n          var particleSpeed = particleSpeedAccessor(link);\n          var getPhotonPos = link.__curve ? function (t) {\n            return link.__curve.getPoint(t);\n          } // interpolate along bezier curve\n          : function (t) {\n            // straight line: interpolate linearly\n            var iplt = function iplt(dim, start, end, t) {\n              return start[dim] + (end[dim] - start[dim]) * t || 0;\n            };\n\n            return {\n              x: iplt('x', start, end, t),\n              y: iplt('y', start, end, t),\n              z: iplt('z', start, end, t)\n            };\n          };\n          var photons = [].concat(_toConsumableArray(cyclePhotons || []), _toConsumableArray(singleHopPhotons || []));\n          photons.forEach(function (photon, idx) {\n            var singleHop = photon.parent.__linkThreeObjType === 'singleHopPhotons';\n\n            if (!photon.hasOwnProperty('__progressRatio')) {\n              photon.__progressRatio = singleHop ? 0 : idx / cyclePhotons.length;\n            }\n\n            photon.__progressRatio += particleSpeed;\n\n            if (photon.__progressRatio >= 1) {\n              if (!singleHop) {\n                photon.__progressRatio = photon.__progressRatio % 1;\n              } else {\n                // remove particle\n                photon.parent.remove(photon);\n                emptyObject(photon);\n                return;\n              }\n            }\n\n            var photonPosRatio = photon.__progressRatio;\n            var pos = getPhotonPos(photonPosRatio);\n            ['x', 'y', 'z'].forEach(function (dim) {\n              return photon.position[dim] = pos[dim];\n            });\n          });\n        });\n      }\n    },\n    emitParticle: function emitParticle(state, link) {\n      if (link) {\n        if (!link.__singleHopPhotonsObj) {\n          var obj = new three.Group();\n          obj.__linkThreeObjType = 'singleHopPhotons';\n          link.__singleHopPhotonsObj = obj;\n          state.graphScene.add(obj);\n        }\n\n        var particleWidthAccessor = accessorFn(state.linkDirectionalParticleWidth);\n        var photonR = Math.ceil(particleWidthAccessor(link) * 10) / 10 / 2;\n        var numSegments = state.linkDirectionalParticleResolution;\n        var particleGeometry = new three.SphereBufferGeometry(photonR, numSegments, numSegments);\n        var linkColorAccessor = accessorFn(state.linkColor);\n        var particleColorAccessor = accessorFn(state.linkDirectionalParticleColor);\n        var photonColor = particleColorAccessor(link) || linkColorAccessor(link) || '#f0f0f0';\n        var materialColor = new three.Color(colorStr2Hex(photonColor));\n        var opacity = state.linkOpacity * 3;\n        var particleMaterial = new three.MeshLambertMaterial({\n          color: materialColor,\n          transparent: true,\n          opacity: opacity\n        }); // add a single hop particle\n\n        link.__singleHopPhotonsObj.add(new three.Mesh(particleGeometry, particleMaterial));\n      }\n\n      return this;\n    },\n    getGraphBbox: function getGraphBbox(state) {\n      var nodeFilter = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : function () {\n        return true;\n      };\n      if (!state.initialised) return null; // recursively collect all nested geometries bboxes\n\n      var bboxes = function getBboxes(obj) {\n        var bboxes = [];\n\n        if (obj.geometry) {\n          obj.geometry.computeBoundingBox();\n          var box = new three.Box3();\n          box.copy(obj.geometry.boundingBox).applyMatrix4(obj.matrixWorld);\n          bboxes.push(box);\n        }\n\n        return bboxes.concat.apply(bboxes, _toConsumableArray((obj.children || []).filter(function (obj) {\n          return !obj.hasOwnProperty('__graphObjType') || obj.__graphObjType === 'node' && nodeFilter(obj.__data);\n        } // exclude filtered out nodes\n        ).map(getBboxes)));\n      }(state.graphScene);\n\n      if (!bboxes.length) return null; // extract global x,y,z min/max\n\n      return Object.assign.apply(Object, _toConsumableArray(['x', 'y', 'z'].map(function (c) {\n        return _defineProperty({}, c, [min(bboxes, function (bb) {\n          return bb.min[c];\n        }), max(bboxes, function (bb) {\n          return bb.max[c];\n        })]);\n      })));\n    }\n  },\n  stateInit: function stateInit() {\n    return {\n      d3ForceLayout: forceSimulation().force('link', forceLink()).force('charge', forceManyBody()).force('center', forceCenter()).force('dagRadial', null).stop(),\n      engineRunning: false\n    };\n  },\n  init: function init(threeObj, state) {\n    // Main three object to manipulate\n    state.graphScene = threeObj;\n  },\n  update: function update(state, changedProps) {\n    var hasAnyPropChanged = function hasAnyPropChanged(propList) {\n      return propList.some(function (p) {\n        return changedProps.hasOwnProperty(p);\n      });\n    };\n\n    state.engineRunning = false; // pause simulation\n\n    state.onUpdate();\n\n    if (state.nodeAutoColorBy !== null && hasAnyPropChanged(['nodeAutoColorBy', 'graphData', 'nodeColor'])) {\n      // Auto add color to uncolored nodes\n      autoColorObjects(state.graphData.nodes, accessorFn(state.nodeAutoColorBy), state.nodeColor);\n    }\n\n    if (state.linkAutoColorBy !== null && hasAnyPropChanged(['linkAutoColorBy', 'graphData', 'linkColor'])) {\n      // Auto add color to uncolored links\n      autoColorObjects(state.graphData.links, accessorFn(state.linkAutoColorBy), state.linkColor);\n    } // Digest nodes WebGL objects\n\n\n    if (state._flushObjects || hasAnyPropChanged(['graphData', 'nodeThreeObject', 'nodeThreeObjectExtend', 'nodeVal', 'nodeColor', 'nodeVisibility', 'nodeRelSize', 'nodeResolution', 'nodeOpacity'])) {\n      var customObjectAccessor = accessorFn(state.nodeThreeObject);\n      var customObjectExtendAccessor = accessorFn(state.nodeThreeObjectExtend);\n      var valAccessor = accessorFn(state.nodeVal);\n      var colorAccessor = accessorFn(state.nodeColor);\n      var visibilityAccessor = accessorFn(state.nodeVisibility);\n      var sphereGeometries = {}; // indexed by node value\n\n      var sphereMaterials = {}; // indexed by color\n\n      threeDigest(state.graphData.nodes.filter(visibilityAccessor), state.graphScene, {\n        purge: state._flushObjects || hasAnyPropChanged([// recreate objects if any of these props have changed\n        'nodeThreeObject', 'nodeThreeObjectExtend']),\n        objFilter: function objFilter(obj) {\n          return obj.__graphObjType === 'node';\n        },\n        createObj: function createObj(node) {\n          var customObj = customObjectAccessor(node);\n          var extendObj = customObjectExtendAccessor(node);\n\n          if (customObj && state.nodeThreeObject === customObj) {\n            // clone object if it's a shared object among all nodes\n            customObj = customObj.clone();\n          }\n\n          var obj;\n\n          if (customObj && !extendObj) {\n            obj = customObj;\n          } else {\n            // Add default object (sphere mesh)\n            obj = new three.Mesh();\n            obj.__graphDefaultObj = true;\n\n            if (customObj && extendObj) {\n              obj.add(customObj); // extend default with custom\n            }\n          }\n\n          obj.__graphObjType = 'node'; // Add object type\n\n          return obj;\n        },\n        updateObj: function updateObj(obj, node) {\n          if (obj.__graphDefaultObj) {\n            // bypass internal updates for custom node objects\n            var val = valAccessor(node) || 1;\n            var radius = Math.cbrt(val) * state.nodeRelSize;\n            var numSegments = state.nodeResolution;\n\n            if (obj.geometry.type !== 'SphereBufferGeometry' || obj.geometry.parameters.radius !== radius || obj.geometry.parameters.widthSegments !== numSegments) {\n              if (!sphereGeometries.hasOwnProperty(val)) {\n                sphereGeometries[val] = new three.SphereBufferGeometry(radius, numSegments, numSegments);\n              }\n\n              obj.geometry.dispose();\n              obj.geometry = sphereGeometries[val];\n            }\n\n            var color = colorAccessor(node);\n            var materialColor = new three.Color(colorStr2Hex(color || '#ffffaa'));\n            var opacity = state.nodeOpacity * colorAlpha(color);\n\n            if (obj.material.type !== 'MeshLambertMaterial' || !obj.material.color.equals(materialColor) || obj.material.opacity !== opacity) {\n              if (!sphereMaterials.hasOwnProperty(color)) {\n                sphereMaterials[color] = new three.MeshLambertMaterial({\n                  color: materialColor,\n                  transparent: true,\n                  opacity: opacity\n                });\n              }\n\n              obj.material.dispose();\n              obj.material = sphereMaterials[color];\n            }\n          }\n        }\n      });\n    } // Digest links WebGL objects\n\n\n    if (state._flushObjects || hasAnyPropChanged(['graphData', 'linkThreeObject', 'linkThreeObjectExtend', 'linkMaterial', 'linkColor', 'linkWidth', 'linkVisibility', 'linkResolution', 'linkOpacity', 'linkDirectionalArrowLength', 'linkDirectionalArrowColor', 'linkDirectionalArrowResolution', 'linkDirectionalParticles', 'linkDirectionalParticleWidth', 'linkDirectionalParticleColor', 'linkDirectionalParticleResolution'])) {\n      var _customObjectAccessor = accessorFn(state.linkThreeObject);\n\n      var _customObjectExtendAccessor = accessorFn(state.linkThreeObjectExtend);\n\n      var customMaterialAccessor = accessorFn(state.linkMaterial);\n\n      var _visibilityAccessor = accessorFn(state.linkVisibility);\n\n      var _colorAccessor = accessorFn(state.linkColor);\n\n      var widthAccessor = accessorFn(state.linkWidth);\n      var cylinderGeometries = {}; // indexed by link width\n\n      var lambertLineMaterials = {}; // for cylinder objects, indexed by link color\n\n      var basicLineMaterials = {}; // for line objects, indexed by link color\n\n      var visibleLinks = state.graphData.links.filter(_visibilityAccessor); // lines digest cycle\n\n      threeDigest(visibleLinks, state.graphScene, {\n        objBindAttr: '__lineObj',\n        purge: state._flushObjects || hasAnyPropChanged([// recreate objects if any of these props have changed\n        'linkThreeObject', 'linkThreeObjectExtend', 'linkWidth']),\n        objFilter: function objFilter(obj) {\n          return obj.__graphObjType === 'link';\n        },\n        createObj: function createObj(link) {\n          var customObj = _customObjectAccessor(link);\n\n          var extendObj = _customObjectExtendAccessor(link);\n\n          if (customObj && state.linkThreeObject === customObj) {\n            // clone object if it's a shared object among all links\n            customObj = customObj.clone();\n          }\n\n          var defaultObj;\n\n          if (!customObj || extendObj) {\n            // construct default line obj\n            var useCylinder = !!widthAccessor(link);\n\n            if (useCylinder) {\n              defaultObj = new three.Mesh();\n            } else {\n              // Use plain line (constant width)\n              var lineGeometry = new three.BufferGeometry();\n              lineGeometry[setAttributeFn]('position', new three.BufferAttribute(new Float32Array(2 * 3), 3));\n              defaultObj = new three.Line(lineGeometry);\n            }\n          }\n\n          var obj;\n\n          if (!customObj) {\n            obj = defaultObj;\n            obj.__graphDefaultObj = true;\n          } else {\n            if (!extendObj) {\n              // use custom object\n              obj = customObj;\n            } else {\n              // extend default with custom in a group\n              obj = new three.Group();\n              obj.__graphDefaultObj = true;\n              obj.add(defaultObj);\n              obj.add(customObj);\n            }\n          }\n\n          obj.renderOrder = 10; // Prevent visual glitches of dark lines on top of nodes by rendering them last\n\n          obj.__graphObjType = 'link'; // Add object type\n\n          return obj;\n        },\n        updateObj: function updateObj(updObj, link) {\n          if (updObj.__graphDefaultObj) {\n            // bypass internal updates for custom link objects\n            // select default object if it's an extended group\n            var obj = updObj.children.length ? updObj.children[0] : updObj;\n            var linkWidth = Math.ceil(widthAccessor(link) * 10) / 10;\n            var useCylinder = !!linkWidth;\n\n            if (useCylinder) {\n              var r = linkWidth / 2;\n              var numSegments = state.linkResolution;\n\n              if (obj.geometry.type !== 'CylinderBufferGeometry' || obj.geometry.parameters.radiusTop !== r || obj.geometry.parameters.radialSegments !== numSegments) {\n                if (!cylinderGeometries.hasOwnProperty(linkWidth)) {\n                  var geometry = new three.CylinderBufferGeometry(r, r, 1, numSegments, 1, false);\n                  geometry[applyMatrix4Fn](new three.Matrix4().makeTranslation(0, 1 / 2, 0));\n                  geometry[applyMatrix4Fn](new three.Matrix4().makeRotationX(Math.PI / 2));\n                  cylinderGeometries[linkWidth] = geometry;\n                }\n\n                obj.geometry.dispose();\n                obj.geometry = cylinderGeometries[linkWidth];\n              }\n            }\n\n            var customMaterial = customMaterialAccessor(link);\n\n            if (customMaterial) {\n              obj.material = customMaterial;\n            } else {\n              var color = _colorAccessor(link);\n\n              var materialColor = new three.Color(colorStr2Hex(color || '#f0f0f0'));\n              var opacity = state.linkOpacity * colorAlpha(color);\n              var materialType = useCylinder ? 'MeshLambertMaterial' : 'LineBasicMaterial';\n\n              if (obj.material.type !== materialType || !obj.material.color.equals(materialColor) || obj.material.opacity !== opacity) {\n                var lineMaterials = useCylinder ? lambertLineMaterials : basicLineMaterials;\n\n                if (!lineMaterials.hasOwnProperty(color)) {\n                  lineMaterials[color] = new three[materialType]({\n                    color: materialColor,\n                    transparent: opacity < 1,\n                    opacity: opacity,\n                    depthWrite: opacity >= 1 // Prevent transparency issues\n\n                  });\n                }\n\n                obj.material.dispose();\n                obj.material = lineMaterials[color];\n              }\n            }\n          }\n        }\n      }); // Arrows digest cycle\n\n      if (state.linkDirectionalArrowLength || changedProps.hasOwnProperty('linkDirectionalArrowLength')) {\n        var arrowLengthAccessor = accessorFn(state.linkDirectionalArrowLength);\n        var arrowColorAccessor = accessorFn(state.linkDirectionalArrowColor);\n        threeDigest(visibleLinks.filter(arrowLengthAccessor), state.graphScene, {\n          objBindAttr: '__arrowObj',\n          objFilter: function objFilter(obj) {\n            return obj.__linkThreeObjType === 'arrow';\n          },\n          createObj: function createObj() {\n            var obj = new three.Mesh(undefined, new three.MeshLambertMaterial({\n              transparent: true\n            }));\n            obj.__linkThreeObjType = 'arrow'; // Add object type\n\n            return obj;\n          },\n          updateObj: function updateObj(obj, link) {\n            var arrowLength = arrowLengthAccessor(link);\n            var numSegments = state.linkDirectionalArrowResolution;\n\n            if (obj.geometry.type !== 'ConeBufferGeometry' || obj.geometry.parameters.height !== arrowLength || obj.geometry.parameters.radialSegments !== numSegments) {\n              var coneGeometry = new three.ConeBufferGeometry(arrowLength * 0.25, arrowLength, numSegments); // Correct orientation\n\n              coneGeometry.translate(0, arrowLength / 2, 0);\n              coneGeometry.rotateX(Math.PI / 2);\n              obj.geometry.dispose();\n              obj.geometry = coneGeometry;\n            }\n\n            obj.material.color = new three.Color(arrowColorAccessor(link) || _colorAccessor(link) || '#f0f0f0');\n            obj.material.opacity = state.linkOpacity * 3;\n          }\n        });\n      } // Photon particles digest cycle\n\n\n      if (state.linkDirectionalParticles || changedProps.hasOwnProperty('linkDirectionalParticles')) {\n        var particlesAccessor = accessorFn(state.linkDirectionalParticles);\n        var particleWidthAccessor = accessorFn(state.linkDirectionalParticleWidth);\n        var particleColorAccessor = accessorFn(state.linkDirectionalParticleColor);\n        var particleMaterials = {}; // indexed by link color\n\n        var particleGeometries = {}; // indexed by particle width\n\n        threeDigest(visibleLinks.filter(particlesAccessor), state.graphScene, {\n          objBindAttr: '__photonsObj',\n          objFilter: function objFilter(obj) {\n            return obj.__linkThreeObjType === 'photons';\n          },\n          createObj: function createObj() {\n            var obj = new three.Group();\n            obj.__linkThreeObjType = 'photons'; // Add object type\n\n            return obj;\n          },\n          updateObj: function updateObj(obj, link) {\n            var numPhotons = Math.round(Math.abs(particlesAccessor(link)));\n            var curPhoton = !!obj.children.length && obj.children[0];\n            var photonR = Math.ceil(particleWidthAccessor(link) * 10) / 10 / 2;\n            var numSegments = state.linkDirectionalParticleResolution;\n            var particleGeometry;\n\n            if (curPhoton && curPhoton.geometry.parameters.radius === photonR && curPhoton.geometry.parameters.widthSegments === numSegments) {\n              particleGeometry = curPhoton.geometry;\n            } else {\n              if (!particleGeometries.hasOwnProperty(photonR)) {\n                particleGeometries[photonR] = new three.SphereBufferGeometry(photonR, numSegments, numSegments);\n              }\n\n              particleGeometry = particleGeometries[photonR];\n              curPhoton && curPhoton.geometry.dispose();\n            }\n\n            var photonColor = particleColorAccessor(link) || _colorAccessor(link) || '#f0f0f0';\n            var materialColor = new three.Color(colorStr2Hex(photonColor));\n            var opacity = state.linkOpacity * 3;\n            var particleMaterial;\n\n            if (curPhoton && curPhoton.material.color.equals(materialColor) && curPhoton.material.opacity === opacity) {\n              particleMaterial = curPhoton.material;\n            } else {\n              if (!particleMaterials.hasOwnProperty(photonColor)) {\n                particleMaterials[photonColor] = new three.MeshLambertMaterial({\n                  color: materialColor,\n                  transparent: true,\n                  opacity: opacity\n                });\n              }\n\n              particleMaterial = particleMaterials[photonColor];\n              curPhoton && curPhoton.material.dispose();\n            } // digest cycle for each photon\n\n\n            threeDigest(_toConsumableArray(new Array(numPhotons)).map(function (_, idx) {\n              return {\n                idx: idx\n              };\n            }), obj, {\n              idAccessor: function idAccessor(d) {\n                return d.idx;\n              },\n              createObj: function createObj() {\n                return new three.Mesh(particleGeometry, particleMaterial);\n              },\n              updateObj: function updateObj(obj) {\n                obj.geometry = particleGeometry;\n                obj.material = particleMaterial;\n              }\n            });\n          }\n        });\n      }\n    }\n\n    state._flushObjects = false; // reset objects refresh flag\n    // simulation engine\n\n    if (hasAnyPropChanged(['graphData', 'nodeId', 'linkSource', 'linkTarget', 'numDimensions', 'forceEngine', 'dagMode', 'dagNodeFilter', 'dagLevelDistance'])) {\n      state.engineRunning = false; // Pause simulation\n      // parse links\n\n      state.graphData.links.forEach(function (link) {\n        link.source = link[state.linkSource];\n        link.target = link[state.linkTarget];\n      }); // Feed data to force-directed layout\n\n      var isD3Sim = state.forceEngine !== 'ngraph';\n      var layout;\n\n      if (isD3Sim) {\n        // D3-force\n        (layout = state.d3ForceLayout).stop().alpha(1) // re-heat the simulation\n        .numDimensions(state.numDimensions).nodes(state.graphData.nodes); // add links (if link force is still active)\n\n        var linkForce = state.d3ForceLayout.force('link');\n\n        if (linkForce) {\n          linkForce.id(function (d) {\n            return d[state.nodeId];\n          }).links(state.graphData.links);\n        } // setup dag force constraints\n\n\n        var nodeDepths = state.dagMode && getDagDepths(state.graphData, function (node) {\n          return node[state.nodeId];\n        }, {\n          nodeFilter: state.dagNodeFilter,\n          onLoopError: state.onDagError || undefined\n        });\n        var maxDepth = Math.max.apply(Math, _toConsumableArray(Object.values(nodeDepths || [])));\n        var dagLevelDistance = state.dagLevelDistance || state.graphData.nodes.length / (maxDepth || 1) * DAG_LEVEL_NODE_RATIO * (['radialin', 'radialout'].indexOf(state.dagMode) !== -1 ? 0.7 : 1); // Fix nodes to x,y,z for dag mode\n\n        if (state.dagMode) {\n          var getFFn = function getFFn(fix, invert) {\n            return function (node) {\n              return !fix ? undefined : (nodeDepths[node[state.nodeId]] - maxDepth / 2) * dagLevelDistance * (invert ? -1 : 1);\n            };\n          };\n\n          var fxFn = getFFn(['lr', 'rl'].indexOf(state.dagMode) !== -1, state.dagMode === 'rl');\n          var fyFn = getFFn(['td', 'bu'].indexOf(state.dagMode) !== -1, state.dagMode === 'td');\n          var fzFn = getFFn(['zin', 'zout'].indexOf(state.dagMode) !== -1, state.dagMode === 'zout');\n          state.graphData.nodes.filter(state.dagNodeFilter).forEach(function (node) {\n            node.fx = fxFn(node);\n            node.fy = fyFn(node);\n            node.fz = fzFn(node);\n          });\n        } // Use radial force for radial dags\n\n\n        state.d3ForceLayout.force('dagRadial', ['radialin', 'radialout'].indexOf(state.dagMode) !== -1 ? forceRadial(function (node) {\n          var nodeDepth = nodeDepths[node[state.nodeId]] || -1;\n          return (state.dagMode === 'radialin' ? maxDepth - nodeDepth : nodeDepth) * dagLevelDistance;\n        }).strength(function (node) {\n          return state.dagNodeFilter(node) ? 1 : 0;\n        }) : null);\n      } else {\n        // ngraph\n        var _graph = ngraph.graph();\n\n        state.graphData.nodes.forEach(function (node) {\n          _graph.addNode(node[state.nodeId]);\n        });\n        state.graphData.links.forEach(function (link) {\n          _graph.addLink(link.source, link.target);\n        });\n        layout = ngraph.forcelayout(_graph, _objectSpread2({\n          dimensions: state.numDimensions\n        }, state.ngraphPhysics));\n        layout.graph = _graph; // Attach graph reference to layout\n      }\n\n      for (var i = 0; i < state.warmupTicks && !(isD3Sim && state.d3AlphaMin > 0 && state.d3ForceLayout.alpha() < state.d3AlphaMin); i++) {\n        layout[isD3Sim ? \"tick\" : \"step\"]();\n      } // Initial ticks before starting to render\n\n\n      state.layout = layout;\n      this.resetCountdown();\n    }\n\n    state.engineRunning = true; // resume simulation\n\n    state.onFinishUpdate();\n  }\n});\n\nfunction fromKapsule (kapsule) {\n  var baseClass = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : Object;\n  var initKapsuleWithSelf = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n\n  var FromKapsule = /*#__PURE__*/function (_baseClass) {\n    _inherits(FromKapsule, _baseClass);\n\n    var _super = _createSuper(FromKapsule);\n\n    function FromKapsule() {\n      var _this;\n\n      _classCallCheck(this, FromKapsule);\n\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n\n      _this = _super.call.apply(_super, [this].concat(args));\n      _this.__kapsuleInstance = kapsule().apply(void 0, [].concat(_toConsumableArray(initKapsuleWithSelf ? [_assertThisInitialized(_this)] : []), args));\n      return _this;\n    }\n\n    return FromKapsule;\n  }(baseClass); // attach kapsule props/methods to class prototype\n\n\n  Object.keys(kapsule()).forEach(function (m) {\n    return FromKapsule.prototype[m] = function () {\n      var _this$__kapsuleInstan;\n\n      var returnVal = (_this$__kapsuleInstan = this.__kapsuleInstance)[m].apply(_this$__kapsuleInstan, arguments);\n\n      return returnVal === this.__kapsuleInstance ? this // chain based on this class, not the kapsule obj\n      : returnVal;\n    };\n  });\n  return FromKapsule;\n}\n\nvar three$1 = window.THREE ? window.THREE : {\n  Group: Group\n}; // Prefer consumption from global THREE, if exists\nvar threeForcegraph = fromKapsule(ForceGraph, three$1.Group, true);\n\nexport default threeForcegraph;\n"]},"metadata":{},"sourceType":"module"}